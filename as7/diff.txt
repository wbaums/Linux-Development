1,3219c1,6
< Only in diffutils-3.0-patch: ABOUT-NLS
< Only in diffutils-3.0-patch: aclocal.m4
< diff -pru diffutils-3.0/AUTHORS diffutils-3.0-patch/AUTHORS
< --- diffutils-3.0/AUTHORS	2020-03-01 22:03:00.296713000 -0800
< +++ diffutils-3.0-patch/AUTHORS	2020-03-01 14:52:55.430185000 -0800
< @@ -33,7 +33,7 @@ Patrick D'Cruze
<  Eli Zaretskii
<  
<  
< -Copyright (C) 2001, 2006, 2009-2013, 2015-2017 Free Software Foundation, Inc.
< +Copyright (C) 2001, 2006, 2009-2010 Free Software Foundation, Inc.
<  
<  This file is part of GNU diffutils.
<  
< Only in diffutils-3.0-patch: autom4te.cache
< diff -pru diffutils-3.0/bootstrap diffutils-3.0-patch/bootstrap
< --- diffutils-3.0/bootstrap	2020-03-01 22:03:00.310714000 -0800
< +++ diffutils-3.0-patch/bootstrap	2020-03-01 14:52:55.462189000 -0800
< @@ -1,10 +1,10 @@
<  #! /bin/sh
<  # Print a version string.
< -scriptversion=2017-01-09.19; # UTC
< +scriptversion=2010-04-30.16; # UTC
<  
<  # Bootstrap this package from checked-out sources.
<  
< -# Copyright (C) 2003-2017 Free Software Foundation, Inc.
< +# Copyright (C) 2003-2010 Free Software Foundation, Inc.
<  
<  # This program is free software: you can redistribute it and/or modify
<  # it under the terms of the GNU General Public License as published by
< @@ -36,41 +36,30 @@ nl='
<  LC_ALL=C
<  export LC_ALL
<  
< -# Ensure that CDPATH is not set.  Otherwise, the output from cd
< -# would cause trouble in at least one use below.
< -(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
< -
<  local_gl_dir=gl
<  
< -# Honor $PERL, but work even if there is none.
< -PERL="${PERL-perl}"
< -
< -me=$0
< +# Temporary directory names.
< +bt='._bootmp'
< +bt_regex=`echo "$bt"| sed 's/\./[.]/g'`
< +bt2=${bt}2
<  
<  usage() {
<    cat <<EOF
< -Usage: $me [OPTION]...
< +Usage: $0 [OPTION]...
<  Bootstrap this package from the checked-out sources.
<  
<  Options:
< - --gnulib-srcdir=DIRNAME  specify the local directory where gnulib
< + --gnulib-srcdir=DIRNAME  Specify the local directory where gnulib
<                            sources reside.  Use this if you already
<                            have gnulib sources on your machine, and
<                            do not want to waste your bandwidth downloading
< -                          them again.  Defaults to \$GNULIB_SRCDIR
< - --bootstrap-sync         if this bootstrap script is not identical to
< -                          the version in the local gnulib sources,
< -                          update this script, and then restart it with
< -                          /bin/sh or the shell \$CONFIG_SHELL
< - --no-bootstrap-sync      do not check whether bootstrap is out of sync
< - --copy                   copy files instead of creating symbolic links
< - --force                  attempt to bootstrap even if the sources seem
< -                          not to have been checked out
< - --no-git                 do not use git to update gnulib.  Requires that
< -                          --gnulib-srcdir point to a correct gnulib snapshot
< - --skip-po                do not download po files
< +                          them again.  Defaults to \$GNULIB_SRCDIR.
< + --copy                   Copy files instead of creating symbolic links.
< + --force                  Attempt to bootstrap even if the sources seem
< +                          not to have been checked out.
< + --skip-po                Do not download po files.
<  
< -If the file $me.conf exists in the same directory as this script, its
< +If the file $0.conf exists in the same directory as this script, its
<  contents are read as shell variables to configure the bootstrap.
<  
<  For build prerequisites, environment variables like \$AUTOCONF and \$AMTAR
< @@ -80,33 +69,6 @@ Running without arguments will suffice i
<  EOF
<  }
<  
< -# warnf_ FORMAT-STRING ARG1...
< -warnf_ ()
< -{
< -  warnf_format_=$1
< -  shift
< -  nl='
< -'
< -  case $* in
< -    *$nl*) me_=$(printf "$me"|tr "$nl|" '??')
< -       printf "$warnf_format_" "$@" | sed "s|^|$me_: |" ;;
< -    *) printf "$me: $warnf_format_" "$@" ;;
< -  esac >&2
< -}
< -
< -# warn_ WORD1...
< -warn_ ()
< -{
< -  # If IFS does not start with ' ', set it and emit the warning in a subshell.
< -  case $IFS in
< -    ' '*) warnf_ '%s\n' "$*";;
< -    *)    (IFS=' '; warn_ "$@");;
< -  esac
< -}
< -
< -# die WORD1...
< -die() { warn_ "$@"; exit 1; }
< -
<  # Configuration.
<  
<  # Name of the Makefile.am
< @@ -118,13 +80,6 @@ gnulib_modules=
<  # Any gnulib files needed that are not in modules.
<  gnulib_files=
<  
< -: ${AUTOPOINT=autopoint}
< -: ${AUTORECONF=autoreconf}
< -
< -# A function to be called right after gnulib-tool is run.
< -# Override it via your own definition in bootstrap.conf.
< -bootstrap_post_import_hook() { :; }
< -
<  # A function to be called after everything else in this script.
<  # Override it via your own definition in bootstrap.conf.
<  bootstrap_epilogue() { :; }
< @@ -135,34 +90,26 @@ bootstrap_epilogue() { :; }
<  # options because the latest/%s directory and the .po files within are
<  # all symlinks.
<  po_download_command_format=\
< -"rsync --delete --exclude '*.s1' -Lrtvz \
< - 'translationproject.org::tp/latest/%s/' '%s'"
< +"rsync -Lrtvz 'translationproject.org::tp/latest/%s/' '%s'"
<  
< -# Fallback for downloading .po files (if rsync fails).
< -po_download_command_format2=\
< -"wget --mirror -nd -q -np -A.po -P '%s' \
< - http://translationproject.org/latest/%s/"
< -
< -# Prefer a non-empty tarname (4th argument of AC_INIT if given), else
< -# fall back to the package name (1st argument with munging)
<  extract_package_name='
< -  /^AC_INIT(\[*/{
< -     s///
< -     /^[^,]*,[^,]*,[^,]*,[ []*\([^][ ,)]\)/{
< -       s//\1/
< -       s/[],)].*//
< +  /^AC_INIT(/{
< +     /.*,.*,.*, */{
< +       s///
< +       s/[][]//g
< +       s/)$//
<         p
<         q
<       }
< -     s/[],)].*//
< +     s/AC_INIT(\[*//
< +     s/]*,.*//
<       s/^GNU //
<       y/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/
< -     s/[^abcdefghijklmnopqrstuvwxyz0123456789_]/-/g
< +     s/[^A-Za-z0-9_]/-/g
<       p
<    }
<  '
< -package=$(sed -n "$extract_package_name" configure.ac) \
< -  || die 'cannot find package name in configure.ac'
< +package=`sed -n "$extract_package_name" configure.ac` || exit
<  gnulib_name=lib$package
<  
<  build_aux=build-aux
< @@ -170,7 +117,18 @@ source_base=lib
<  m4_base=m4
<  doc_base=doc
<  tests_base=tests
< -gnulib_extra_files=''
< +
< +# Extra files from gnulib, which override files from other sources.
< +gnulib_extra_files="
< +        $build_aux/install-sh
< +        $build_aux/missing
< +        $build_aux/mdate-sh
< +        $build_aux/texinfo.tex
< +        $build_aux/depcomp
< +        $build_aux/config.guess
< +        $build_aux/config.sub
< +        doc/INSTALL
< +"
<  
<  # Additional gnulib-tool options to use.  Use "\newline" to break lines.
<  gnulib_tool_option_extras=
< @@ -205,35 +163,12 @@ copy=false
<  # on which version control system (if any) is used in the source directory.
<  vc_ignore=auto
<  
< -# Set this to true in bootstrap.conf to enable --bootstrap-sync by
< -# default.
< -bootstrap_sync=false
< -
< -# Use git to update gnulib sources
< -use_git=true
< -
< -check_exists() {
< -  if test "$1" = "--verbose"; then
< -    ($2 --version </dev/null) >/dev/null 2>&1
< -    if test $? -ge 126; then
< -      # If not found, run with diagnostics as one may be
< -      # presented with env variables to set to find the right version
< -      ($2 --version </dev/null)
< -    fi
< -  else
< -    ($1 --version </dev/null) >/dev/null 2>&1
< -  fi
< -
< -  test $? -lt 126
< -}
< -
<  # find_tool ENVVAR NAMES...
<  # -------------------------
<  # Search for a required program.  Use the value of ENVVAR, if set,
< -# otherwise find the first of the NAMES that can be run.
< -# If found, set ENVVAR to the program name, die otherwise.
< -#
< -# FIXME: code duplication, see also gnu-web-doc-update.
< +# otherwise find the first of the NAMES that can be run (i.e.,
< +# supports --version).  If found, set ENVVAR to the program name,
< +# die otherwise.
<  find_tool ()
<  {
<    find_tool_envvar=$1
< @@ -241,21 +176,31 @@ find_tool ()
<    find_tool_names=$@
<    eval "find_tool_res=\$$find_tool_envvar"
<    if test x"$find_tool_res" = x; then
< -    for i; do
< -      if check_exists $i; then
< -        find_tool_res=$i
< -        break
< +    for i
< +    do
< +      if ($i --version </dev/null) >/dev/null 2>&1; then
< +       find_tool_res=$i
< +       break
<        fi
<      done
< +  else
< +    find_tool_error_prefix="\$$find_tool_envvar: "
<    fi
<    if test x"$find_tool_res" = x; then
< -    warn_ "one of these is required: $find_tool_names;"
< -    die   "alternatively set $find_tool_envvar to a compatible tool"
< +    echo >&2 "$0: one of these is required: $find_tool_names"
< +    exit 1
<    fi
< +  ($find_tool_res --version </dev/null) >/dev/null 2>&1 || {
< +    echo >&2 "$0: ${find_tool_error_prefix}cannot run $find_tool_res --version"
< +    exit 1
< +  }
<    eval "$find_tool_envvar=\$find_tool_res"
<    eval "export $find_tool_envvar"
<  }
<  
< +# Find sha1sum, named gsha1sum on MacPorts, and shasum on MacOS 10.6.
< +find_tool SHA1SUM sha1sum gsha1sum shasum
< +
<  # Override the default configuration, if necessary.
<  # Make sure that bootstrap.conf is sourced from the current directory
<  # if we were invoked as "sh bootstrap".
< @@ -264,17 +209,6 @@ case "$0" in
<    *) test -r "$0.conf" && . ./"$0.conf" ;;
<  esac
<  
< -# Extra files from gnulib, which override files from other sources.
< -test -z "${gnulib_extra_files}" && \
< -  gnulib_extra_files="
< -        build-aux/install-sh
< -        build-aux/mdate-sh
< -        build-aux/texinfo.tex
< -        build-aux/depcomp
< -        build-aux/config.guess
< -        build-aux/config.sub
< -        doc/INSTALL
< -"
<  
<  if test "$vc_ignore" = auto; then
<    vc_ignore=
< @@ -293,70 +227,33 @@ do
<      usage
<      exit;;
<    --gnulib-srcdir=*)
< -    GNULIB_SRCDIR=${option#--gnulib-srcdir=};;
< +    GNULIB_SRCDIR=`expr "X$option" : 'X--gnulib-srcdir=\(.*\)'`;;
<    --skip-po)
<      SKIP_PO=t;;
<    --force)
<      checkout_only_file=;;
<    --copy)
<      copy=true;;
< -  --bootstrap-sync)
< -    bootstrap_sync=true;;
< -  --no-bootstrap-sync)
< -    bootstrap_sync=false;;
< -  --no-git)
< -    use_git=false;;
<    *)
< -    die "$option: unknown option";;
< +    echo >&2 "$0: $option: unknown option"
< +    exit 1;;
<    esac
<  done
<  
< -$use_git || test -d "$GNULIB_SRCDIR" \
< -  || die "Error: --no-git requires --gnulib-srcdir"
< -
<  if test -n "$checkout_only_file" && test ! -r "$checkout_only_file"; then
< -  die "Bootstrapping from a non-checked-out distribution is risky."
< +  echo "$0: Bootstrapping from a non-checked-out distribution is risky." >&2
< +  exit 1
<  fi
<  
< -# Strip blank and comment lines to leave significant entries.
< -gitignore_entries() {
< -  sed '/^#/d; /^$/d' "$@"
< -}
< -
< -# If $STR is not already on a line by itself in $FILE, insert it at the start.
< -# Entries are inserted at the start of the ignore list to ensure existing
< -# entries starting with ! are not overridden.  Such entries support
< -# whitelisting exceptions after a more generic blacklist pattern.
< -insert_if_absent() {
< +# If $STR is not already on a line by itself in $FILE, insert it,
< +# sorting the new contents of the file and replacing $FILE with the result.
< +insert_sorted_if_absent() {
<    file=$1
<    str=$2
<    test -f $file || touch $file
< -  test -r $file || die "Error: failed to read ignore file: $file"
< -  duplicate_entries=$(gitignore_entries $file | sort | uniq -d)
< -  if [ "$duplicate_entries" ] ; then
< -    die "Error: Duplicate entries in $file: " $duplicate_entries
< -  fi
< -  linesold=$(gitignore_entries $file | wc -l)
< -  linesnew=$( { echo "$str"; cat $file; } | gitignore_entries | sort -u | wc -l)
< -  if [ $linesold != $linesnew ] ; then
< -    { echo "$str" | cat - $file > $file.bak && mv $file.bak $file; } \
< -      || die "insert_if_absent $file $str: failed"
< -  fi
< -}
< -
< -# Adjust $PATTERN for $VC_IGNORE_FILE and insert it with
< -# insert_if_absent.
< -insert_vc_ignore() {
< -  vc_ignore_file="$1"
< -  pattern="$2"
< -  case $vc_ignore_file in
< -  *.gitignore)
< -    # A .gitignore entry that does not start with '/' applies
< -    # recursively to subdirectories, so prepend '/' to every
< -    # .gitignore entry.
< -    pattern=$(echo "$pattern" | sed s,^,/,);;
< -  esac
< -  insert_if_absent "$vc_ignore_file" "$pattern"
< +  echo "$str" | sort -u - $file | cmp - $file > /dev/null \
< +    || echo "$str" | sort -u - $file -o $file \
< +    || exit 1
<  }
<  
<  # Die if there is no AC_CONFIG_AUX_DIR($build_aux) line in configure.ac.
< @@ -365,8 +262,11 @@ grep '^[	 ]*AC_CONFIG_AUX_DIR(\['"$build
<      >/dev/null && found_aux_dir=yes
<  grep '^[	 ]*AC_CONFIG_AUX_DIR('"$build_aux"')' configure.ac \
<      >/dev/null && found_aux_dir=yes
< -test $found_aux_dir = yes \
< -  || die "configure.ac lacks 'AC_CONFIG_AUX_DIR([$build_aux])'; add it"
< +if test $found_aux_dir = no; then
< +  echo "$0: expected line not found in configure.ac. Add the following:" >&2
< +  echo "  AC_CONFIG_AUX_DIR([$build_aux])" >&2
< +  exit 1
< +fi
<  
<  # If $build_aux doesn't exist, create it now, otherwise some bits
<  # below will malfunction.  If creating it, also mark it as ignored.
< @@ -374,7 +274,7 @@ if test ! -d $build_aux; then
<    mkdir $build_aux
<    for dot_ig in x $vc_ignore; do
<      test $dot_ig = x && continue
< -    insert_vc_ignore $dot_ig $build_aux
< +    insert_sorted_if_absent $dot_ig $build_aux
<    done
<  fi
<  
< @@ -418,100 +318,47 @@ sort_ver() { # sort -V is not generally
<    done
<  }
<  
< -get_version_sed='
< -# Move version to start of line.
< -s/.*[v ]\([0-9]\)/\1/
< -
< -# Skip lines that do not start with version.
< -/^[0-9]/!d
< -
< -# Remove characters after the version.
< -s/[^.a-z0-9-].*//
< -
< -# The first component must be digits only.
< -s/^\([0-9]*\)[a-z-].*/\1/
< -
< -#the following essentially does s/5.005/5.5/
< -s/\.0*\([1-9]\)/.\1/g
< -p
< -q'
< -
<  get_version() {
<    app=$1
<  
< -  $app --version >/dev/null 2>&1 || { $app --version; return 1; }
< +  $app --version >/dev/null 2>&1 || return 1
<  
< -  $app --version 2>&1 | sed -n "$get_version_sed"
< +  $app --version 2>&1 |
< +  sed -n '# extract version within line
< +          s/.*[v ]\{1,\}\([0-9]\{1,\}\.[.a-z0-9-]*\).*/\1/
< +          t done
< +
< +          # extract version at start of line
< +          s/^\([0-9]\{1,\}\.[.a-z0-9-]*\).*/\1/
< +          t done
< +
< +          d
< +
< +          :done
< +          #the following essentially does s/5.005/5.5/
< +          s/\.0*\([1-9]\)/.\1/g
< +          p
< +          q'
<  }
<  
<  check_versions() {
<    ret=0
<  
<    while read app req_ver; do
< -    # We only need libtoolize from the libtool package.
< -    if test "$app" = libtool; then
< -      app=libtoolize
< -    fi
< -    # Exempt git if --no-git is in effect.
< -    if test "$app" = git; then
< -      $use_git || continue
< -    fi
<      # Honor $APP variables ($TAR, $AUTOCONF, etc.)
< -    appvar=$(echo $app | LC_ALL=C tr '[a-z]-' '[A-Z]_')
< +    appvar=`echo $app | tr '[a-z]' '[A-Z]'`
<      test "$appvar" = TAR && appvar=AMTAR
< -    case $appvar in
< -        GZIP) ;; # Do not use $GZIP:  it contains gzip options.
< -        PERL::*) ;; # Keep perl modules as-is
< -        *) eval "app=\${$appvar-$app}" ;;
< -    esac
< -
< -    # Handle the still-experimental Automake-NG programs specially.
< -    # They remain named as the mainstream Automake programs ("automake",
< -    # and "aclocal") to avoid gratuitous incompatibilities with
< -    # pre-existing usages (by, say, autoreconf, or custom autogen.sh
< -    # scripts), but correctly identify themselves (as being part of
< -    # "GNU automake-ng") when asked their version.
< -    case $app in
< -      automake-ng|aclocal-ng)
< -        app=${app%-ng}
< -        ($app --version | grep '(GNU automake-ng)') >/dev/null 2>&1 || {
< -          warn_ "Error: '$app' not found or not from Automake-NG"
< -          ret=1
< -          continue
< -        } ;;
< -      # Another check is for perl modules.  These can be written as
< -      # e.g. perl::XML::XPath in case of XML::XPath module, etc.
< -      perl::*)
< -        # Extract module name
< -        app="${app#perl::}"
< -        if ! $PERL -m"$app" -e 'exit 0' >/dev/null 2>&1; then
< -          warn_ "Error: perl module '$app' not found"
< -          ret=1
< -        fi
< -        continue
< -        ;;
< -    esac
< -    if [ "$req_ver" = "-" ]; then
< -      # Merely require app to exist; not all prereq apps are well-behaved
< -      # so we have to rely on $? rather than get_version.
< -      if ! check_exists --verbose $app; then
< -        warn_ "Error: '$app' not found"
< -        ret=1
< -      fi
< -    else
< -      # Require app to produce a new enough version string.
< -      inst_ver=$(get_version $app)
< -      if [ ! "$inst_ver" ]; then
< -        warn_ "Error: '$app' not found"
< +    eval "app=\${$appvar-$app}"
< +    inst_ver=$(get_version $app)
< +    if [ ! "$inst_ver" ]; then
< +      echo "Error: '$app' not found" >&2
< +      ret=1
< +    elif [ ! "$req_ver" = "-" ]; then
< +      latest_ver=$(sort_ver $req_ver $inst_ver | cut -d' ' -f2)
< +      if [ ! "$latest_ver" = "$inst_ver" ]; then
< +        echo "Error: '$app' version == $inst_ver is too old" >&2
< +        echo "       '$app' version >= $req_ver is required" >&2
<          ret=1
< -      else
< -        latest_ver=$(sort_ver $req_ver $inst_ver | cut -d' ' -f2)
< -        if [ ! "$latest_ver" = "$inst_ver" ]; then
< -          warnf_ '%s\n'                                        \
< -              "Error: '$app' version == $inst_ver is too old"  \
< -              "       '$app' version >= $req_ver is required"
< -          ret=1
< -        fi
<        fi
<      fi
<    done
< @@ -522,82 +369,31 @@ check_versions() {
<  print_versions() {
<    echo "Program    Min_version"
<    echo "----------------------"
< -  printf %s "$buildreq"
< +  printf "$buildreq"
<    echo "----------------------"
<    # can't depend on column -t
<  }
<  
< -# Find sha1sum, named gsha1sum on MacPorts, shasum on Mac OS X 10.6.
< -# Also find the compatible sha1 utility on the BSDs
< -if test x"$SKIP_PO" = x; then
< -  find_tool SHA1SUM sha1sum gsha1sum shasum sha1
< -fi
< -
< -use_libtool=0
< -# We'd like to use grep -E, to see if any of LT_INIT,
< -# AC_PROG_LIBTOOL, AM_PROG_LIBTOOL is used in configure.ac,
< -# but that's not portable enough (e.g., for Solaris).
< -grep '^[	 ]*A[CM]_PROG_LIBTOOL' configure.ac >/dev/null \
< -  && use_libtool=1
< -grep '^[	 ]*LT_INIT' configure.ac >/dev/null \
< -  && use_libtool=1
< -if test $use_libtool = 1; then
< -  find_tool LIBTOOLIZE glibtoolize libtoolize
< -fi
< -
< -# gnulib-tool requires at least automake and autoconf.
< -# If either is not listed, add it (with minimum version) as a prerequisite.
< -case $buildreq in
< -  *automake*) ;;
< -  *) buildreq="automake 1.9
< -$buildreq" ;;
< -esac
< -case $buildreq in
< -  *autoconf*) ;;
< -  *) buildreq="autoconf 2.59
< -$buildreq" ;;
< -esac
< -
< -# When we can deduce that gnulib-tool will require patch,
< -# and when patch is not already listed as a prerequisite, add it, too.
< -if test -d "$local_gl_dir" \
< -    && ! find "$local_gl_dir" -name '*.diff' -exec false {} +; then
< -  case $buildreq in
< -    *patch*) ;;
< -    *) buildreq="patch -
< -$buildreq" ;;
< -  esac
< -fi
< -
<  if ! printf "$buildreq" | check_versions; then
< -  echo >&2
< -  if test -f README-prereq; then
< -    die "See README-prereq for how to get the prerequisite programs"
< -  else
< -    die "Please install the prerequisite programs"
< -  fi
< -fi
< -
< -# Warn the user if autom4te appears to be broken; this causes known
< -# issues with at least gettext 0.18.3.
< -probe=$(echo 'm4_quote([hi])' | autom4te -l M4sugar -t 'm4_quote:$%' -)
< -if test "x$probe" != xhi; then
< -  warn_ "WARNING: your autom4te wrapper eats stdin;"
< -  warn_ "if bootstrap fails, consider upgrading your autotools"
< +  test -f README-prereq &&
< +  echo "See README-prereq for notes on obtaining these prerequisite programs:" >&2
< +  echo
< +  print_versions
< +  exit 1
<  fi
<  
<  echo "$0: Bootstrapping from checked-out $package sources..."
<  
<  # See if we can use gnulib's git-merge-changelog merge driver.
< -if $use_git && test -d .git && check_exists git; then
< +if test -d .git && (git --version) >/dev/null 2>/dev/null ; then
<    if git config merge.merge-changelog.driver >/dev/null ; then
<      :
< -  elif check_exists git-merge-changelog; then
< -    echo "$0: initializing git-merge-changelog driver"
< +  elif (git-merge-changelog --version) >/dev/null 2>/dev/null ; then
< +    echo "initializing git-merge-changelog driver"
<      git config merge.merge-changelog.name 'GNU-style ChangeLog merge driver'
<      git config merge.merge-changelog.driver 'git-merge-changelog %O %A %B'
<    else
< -    echo "$0: consider installing git-merge-changelog from gnulib"
< +    echo "consider installing git-merge-changelog from gnulib"
<    fi
<  fi
<  
< @@ -612,29 +408,23 @@ git_modules_config () {
<    test -f .gitmodules && git config --file .gitmodules "$@"
<  }
<  
< -if $use_git; then
< -  gnulib_path=$(git_modules_config submodule.gnulib.path)
< -  test -z "$gnulib_path" && gnulib_path=gnulib
< -fi
< +gnulib_path=`git_modules_config submodule.gnulib.path`
<  
< -# Get gnulib files.  Populate $GNULIB_SRCDIR, possibly updating a
< -# submodule, for use in the rest of the script.
< +# Get gnulib files.
<  
<  case ${GNULIB_SRCDIR--} in
<  -)
< -  # Note that $use_git is necessarily true in this case.
<    if git_modules_config submodule.gnulib.url >/dev/null; then
<      echo "$0: getting gnulib files..."
< -    git submodule init -- "$gnulib_path" || exit $?
< -    git submodule update -- "$gnulib_path" || exit $?
< +    git submodule init || exit $?
< +    git submodule update || exit $?
<  
<    elif [ ! -d "$gnulib_path" ]; then
<      echo "$0: getting gnulib files..."
<  
<      trap cleanup_gnulib 1 2 13 15
<  
< -    shallow=
< -    git clone -h 2>&1 | grep -- --depth > /dev/null && shallow='--depth 2'
< +    git clone -h|grep -- --depth > /dev/null && shallow='--depth 2' || shallow=
<      git clone $shallow git://git.sv.gnu.org/gnulib "$gnulib_path" ||
<        cleanup_gnulib
<  
< @@ -643,8 +433,8 @@ case ${GNULIB_SRCDIR--} in
<    GNULIB_SRCDIR=$gnulib_path
<    ;;
<  *)
< -  # Use GNULIB_SRCDIR directly or as a reference.
< -  if $use_git && test -d "$GNULIB_SRCDIR"/.git && \
< +  # Use GNULIB_SRCDIR as a reference.
< +  if test -d "$GNULIB_SRCDIR"/.git && \
<          git_modules_config submodule.gnulib.url >/dev/null; then
<      echo "$0: getting gnulib files..."
<      if git submodule -h|grep -- --reference > /dev/null; then
< @@ -655,14 +445,13 @@ case ${GNULIB_SRCDIR--} in
<        # This fallback allows at least git 1.5.5.
<        if test -f "$gnulib_path"/gnulib-tool; then
<          # Since file already exists, assume submodule init already complete.
< -        git submodule update -- "$gnulib_path" || exit $?
< +        git submodule update || exit $?
<        else
<          # Older git can't clone into an empty directory.
<          rmdir "$gnulib_path" 2>/dev/null
<          git clone --reference "$GNULIB_SRCDIR" \
<            "$(git_modules_config submodule.gnulib.url)" "$gnulib_path" \
< -          && git submodule init -- "$gnulib_path" \
< -          && git submodule update -- "$gnulib_path" \
< +          && git submodule init && git submodule update \
<            || exit $?
<        fi
<      fi
< @@ -671,59 +460,37 @@ case ${GNULIB_SRCDIR--} in
<    ;;
<  esac
<  
< -# $GNULIB_SRCDIR now points to the version of gnulib to use, and
< -# we no longer need to use git or $gnulib_path below here.
< -
< -if $bootstrap_sync; then
< -  cmp -s "$0" "$GNULIB_SRCDIR/build-aux/bootstrap" || {
< -    echo "$0: updating bootstrap and restarting..."
< -    case $(sh -c 'echo "$1"' -- a) in
< -      a) ignored=--;;
< -      *) ignored=ignored;;
< -    esac
< -    exec sh -c \
< -      'cp "$1" "$2" && shift && exec "${CONFIG_SHELL-/bin/sh}" "$@"' \
< -      $ignored "$GNULIB_SRCDIR/build-aux/bootstrap" \
< -      "$0" "$@" --no-bootstrap-sync
< -  }
< -fi
< -
<  gnulib_tool=$GNULIB_SRCDIR/gnulib-tool
< -<$gnulib_tool || exit $?
< +<$gnulib_tool || exit
<  
<  # Get translations.
<  
<  download_po_files() {
<    subdir=$1
<    domain=$2
< -  echo "$me: getting translations into $subdir for $domain..."
< -  cmd=$(printf "$po_download_command_format" "$domain" "$subdir")
< -  eval "$cmd" && return
< -  # Fallback to HTTP.
< -  cmd=$(printf "$po_download_command_format2" "$subdir" "$domain")
< +  echo "$0: getting translations into $subdir for $domain..."
< +  cmd=`printf "$po_download_command_format" "$domain" "$subdir"`
<    eval "$cmd"
<  }
<  
< -# Mirror .po files to $po_dir/.reference and copy only the new
< +# Download .po files to $po_dir/.reference and copy only the new
<  # or modified ones into $po_dir.  Also update $po_dir/LINGUAS.
< -# Note po files that exist locally only are left in $po_dir but will
< -# not be included in LINGUAS and hence will not be distributed.
<  update_po_files() {
<    # Directory containing primary .po files.
<    # Overwrite them only when we're sure a .po file is new.
<    po_dir=$1
<    domain=$2
<  
< -  # Mirror *.po files into this dir.
< +  # Download *.po files into this dir.
<    # Usually contains *.s1 checksum files.
<    ref_po_dir="$po_dir/.reference"
<  
<    test -d $ref_po_dir || mkdir $ref_po_dir || return
<    download_po_files $ref_po_dir $domain \
<      && ls "$ref_po_dir"/*.po 2>/dev/null |
< -      sed 's|.*/||; s|\.po$||' > "$po_dir/LINGUAS" || return
< +      sed 's|.*/||; s|\.po$||' > "$po_dir/LINGUAS"
<  
< -  langs=$(cd $ref_po_dir && echo *.po | sed 's/\.po//g')
< +  langs=`cd $ref_po_dir && echo *.po|sed 's/\.po//g'`
<    test "$langs" = '*' && langs=x
<    for po in $langs; do
<      case $po in x) continue;; esac
< @@ -731,10 +498,11 @@ update_po_files() {
<      cksum_file="$ref_po_dir/$po.s1"
<      if ! test -f "$cksum_file" ||
<          ! test -f "$po_dir/$po.po" ||
< -        ! $SHA1SUM -c "$cksum_file" < "$new_po" > /dev/null 2>&1; then
< -      echo "$me: updated $po_dir/$po.po..."
< +        ! $SHA1SUM -c --status "$cksum_file" \
< +            < "$new_po" > /dev/null; then
< +      echo "updated $po_dir/$po.po..."
<        cp "$new_po" "$po_dir/$po.po" \
< -          && $SHA1SUM < "$new_po" > "$cksum_file" || return
< +          && $SHA1SUM < "$new_po" > "$cksum_file"
<      fi
<    done
<  }
< @@ -759,174 +527,231 @@ symlink_to_dir()
<  
<      # If the destination directory doesn't exist, create it.
<      # This is required at least for "lib/uniwidth/cjk.h".
< -    dst_dir=$(dirname "$dst")
< +    dst_dir=`dirname "$dst"`
<      if ! test -d "$dst_dir"; then
<        mkdir -p "$dst_dir"
<  
<        # If we've just created a directory like lib/uniwidth,
<        # tell version control system(s) it's ignorable.
<        # FIXME: for now, this does only one level
< -      parent=$(dirname "$dst_dir")
< +      parent=`dirname "$dst_dir"`
<        for dot_ig in x $vc_ignore; do
<          test $dot_ig = x && continue
<          ig=$parent/$dot_ig
< -        insert_vc_ignore $ig "${dst_dir##*/}"
< +        insert_sorted_if_absent $ig `echo "$dst_dir"|sed 's,.*/,,'`
<        done
<      fi
<  
<      if $copy; then
<        {
<          test ! -h "$dst" || {
< -          echo "$me: rm -f $dst" &&
< +          echo "$0: rm -f $dst" &&
<            rm -f "$dst"
<          }
<        } &&
<        test -f "$dst" &&
<        cmp -s "$src" "$dst" || {
< -        echo "$me: cp -fp $src $dst" &&
< +        echo "$0: cp -fp $src $dst" &&
<          cp -fp "$src" "$dst"
<        }
<      else
< -      # Leave any existing symlink alone, if it already points to the source,
< -      # so that broken build tools that care about symlink times
< -      # aren't confused into doing unnecessary builds.  Conversely, if the
< -      # existing symlink's timestamp is older than the source, make it afresh,
< -      # so that broken tools aren't confused into skipping needed builds.  See
< -      # <http://lists.gnu.org/archive/html/bug-gnulib/2011-05/msg00326.html>.
<        test -h "$dst" &&
< -      src_ls=$(ls -diL "$src" 2>/dev/null) && set $src_ls && src_i=$1 &&
< -      dst_ls=$(ls -diL "$dst" 2>/dev/null) && set $dst_ls && dst_i=$1 &&
< -      test "$src_i" = "$dst_i" &&
< -      both_ls=$(ls -dt "$src" "$dst") &&
< -      test "X$both_ls" = "X$dst$nl$src" || {
< +      src_ls=`ls -diL "$src" 2>/dev/null` && set $src_ls && src_i=$1 &&
< +      dst_ls=`ls -diL "$dst" 2>/dev/null` && set $dst_ls && dst_i=$1 &&
< +      test "$src_i" = "$dst_i" || {
<          dot_dots=
<          case $src in
<          /*) ;;
<          *)
<            case /$dst/ in
<            *//* | */../* | */./* | /*/*/*/*/*/)
< -             die "invalid symlink calculation: $src -> $dst";;
< -          /*/*/*/*/)    dot_dots=../../../;;
< -          /*/*/*/)      dot_dots=../../;;
< -          /*/*/)        dot_dots=../;;
< +             echo >&2 "$0: invalid symlink calculation: $src -> $dst"
< +             exit 1;;
< +          /*/*/*/*/)	dot_dots=../../../;;
< +          /*/*/*/)	dot_dots=../../;;
< +          /*/*/)	dot_dots=../;;
<            esac;;
<          esac
<  
< -        echo "$me: ln -fs $dot_dots$src $dst" &&
< +        echo "$0: ln -fs $dot_dots$src $dst" &&
<          ln -fs "$dot_dots$src" "$dst"
<        }
<      fi
<    }
<  }
<  
< -version_controlled_file() {
< -  parent=$1
< -  file=$2
< -  if test -d .git; then
< -    git rm -n "$file" > /dev/null 2>&1
< -  elif test -d .svn; then
< -    svn log -r HEAD "$file" > /dev/null 2>&1
< -  elif test -d CVS; then
< -    grep -F "/${file##*/}/" "$parent/CVS/Entries" 2>/dev/null |
< -             grep '^/[^/]*/[0-9]' > /dev/null
< -  else
< -    warn_ "no version control for $file?"
< -    false
< -  fi
< -}
< -
< -# NOTE: we have to be careful to run both autopoint and libtoolize
< -# before gnulib-tool, since gnulib-tool is likely to provide newer
< -# versions of files "installed" by these two programs.
< -# Then, *after* gnulib-tool (see below), we have to be careful to
< -# run autoreconf in such a way that it does not run either of these
< -# two just-pre-run programs.
< -
< -# Import from gettext.
< -with_gettext=yes
< -grep '^[	 ]*AM_GNU_GETTEXT_VERSION(' configure.ac >/dev/null || \
< -    with_gettext=no
< -
< -if test $with_gettext = yes || test $use_libtool = 1; then
< +cp_mark_as_generated()
< +{
< +  cp_src=$1
< +  cp_dst=$2
<  
< -  tempbase=.bootstrap$$
< -  trap "rm -f $tempbase.0 $tempbase.1" 1 2 13 15
< +  if cmp -s "$cp_src" "$GNULIB_SRCDIR/$cp_dst"; then
< +    symlink_to_dir "$GNULIB_SRCDIR" "$cp_dst"
< +  elif cmp -s "$cp_src" "$local_gl_dir/$cp_dst"; then
< +    symlink_to_dir $local_gl_dir "$cp_dst"
< +  else
< +    case $cp_dst in
< +      *.[ch])             c1='/* '; c2=' */';;
< +      *.texi)             c1='@c '; c2=     ;;
< +      *.m4|*/Make*|Make*) c1='# ' ; c2=     ;;
< +      *)                  c1=     ; c2=     ;;
< +    esac
<  
< -  > $tempbase.0 > $tempbase.1 &&
< -  find . ! -type d -print | sort > $tempbase.0 || exit
< +    # If the destination directory doesn't exist, create it.
< +    # This is required at least for "lib/uniwidth/cjk.h".
< +    dst_dir=`dirname "$cp_dst"`
< +    test -d "$dst_dir" || mkdir -p "$dst_dir"
<  
< -  if test $with_gettext = yes; then
< -    # Released autopoint has the tendency to install macros that have been
< -    # obsoleted in current gnulib, so run this before gnulib-tool.
< -    echo "$0: $AUTOPOINT --force"
< -    $AUTOPOINT --force || exit
< +    if test -z "$c1"; then
< +      cmp -s "$cp_src" "$cp_dst" || {
< +        # Copy the file first to get proper permissions if it
< +        # doesn't already exist.  Then overwrite the copy.
< +        echo "$0: cp -f $cp_src $cp_dst" &&
< +        rm -f "$cp_dst" &&
< +        cp "$cp_src" "$cp_dst-t" &&
< +        sed "s!$bt_regex/!!g" "$cp_src" > "$cp_dst-t" &&
< +        mv -f "$cp_dst-t" "$cp_dst"
< +      }
< +    else
< +      # Copy the file first to get proper permissions if it
< +      # doesn't already exist.  Then overwrite the copy.
< +      cp "$cp_src" "$cp_dst-t" &&
< +      (
< +        echo "$c1-*- buffer-read-only: t -*- vi: set ro:$c2" &&
< +        echo "${c1}DO NOT EDIT! GENERATED AUTOMATICALLY!$c2" &&
< +        sed "s!$bt_regex/!!g" "$cp_src"
< +      ) > $cp_dst-t &&
< +      if cmp -s "$cp_dst-t" "$cp_dst"; then
< +        rm -f "$cp_dst-t"
< +      else
< +        echo "$0: cp $cp_src $cp_dst # with edits" &&
< +        mv -f "$cp_dst-t" "$cp_dst"
< +      fi
< +    fi
<    fi
< +}
<  
< -  # Autoreconf runs aclocal before libtoolize, which causes spurious
< -  # warnings if the initial aclocal is confused by the libtoolized
< -  # (or worse out-of-date) macro directory.
< -  # libtoolize 1.9b added the --install option; but we support back
< -  # to libtoolize 1.5.22, where the install action was default.
< -  if test $use_libtool = 1; then
< -    install=
< -    case $($LIBTOOLIZE --help) in
< -      *--install*) install=--install ;;
< -    esac
< -    echo "running: $LIBTOOLIZE $install --copy"
< -    $LIBTOOLIZE $install --copy
< +version_controlled_file() {
< +  dir=$1
< +  file=$2
< +  found=no
< +  if test -d CVS; then
< +    grep -F "/$file/" $dir/CVS/Entries 2>/dev/null |
< +             grep '^/[^/]*/[0-9]' > /dev/null && found=yes
< +  elif test -d .git; then
< +    git rm -n "$dir/$file" > /dev/null 2>&1 && found=yes
< +  elif test -d .svn; then
< +    svn log -r HEAD "$dir/$file" > /dev/null 2>&1 && found=yes
< +  else
< +    echo "$0: no version control for $dir/$file?" >&2
<    fi
< +  test $found = yes
< +}
<  
< -  find . ! -type d -print | sort >$tempbase.1
< -  old_IFS=$IFS
< -  IFS=$nl
< -  for file in $(comm -13 $tempbase.0 $tempbase.1); do
< -    IFS=$old_IFS
< -    parent=${file%/*}
< -    version_controlled_file "$parent" "$file" || {
< -      for dot_ig in x $vc_ignore; do
< -        test $dot_ig = x && continue
< -        ig=$parent/$dot_ig
< -        insert_vc_ignore "$ig" "${file##*/}"
< +slurp() {
< +  for dir in . `(cd $1 && find * -type d -print)`; do
< +    copied=
< +    sep=
< +    for file in `ls -a $1/$dir`; do
< +      case $file in
< +      .|..) continue;;
< +      .*) continue;; # FIXME: should all file names starting with "." be ignored?
< +      esac
< +      test -d $1/$dir/$file && continue
< +      for excluded_file in $excluded_files; do
< +        test "$dir/$file" = "$excluded_file" && continue 2
<        done
< -    }
< +      if test $file = Makefile.am && test "X$gnulib_mk" != XMakefile.am; then
< +        copied=$copied${sep}$gnulib_mk; sep=$nl
< +        remove_intl='/^[^#].*\/intl/s/^/#/;'"s!$bt_regex/!!g"
< +        sed "$remove_intl" $1/$dir/$file | cmp - $dir/$gnulib_mk > /dev/null || {
< +          echo "$0: Copying $1/$dir/$file to $dir/$gnulib_mk ..." &&
< +          rm -f $dir/$gnulib_mk &&
< +          sed "$remove_intl" $1/$dir/$file >$dir/$gnulib_mk
< +        }
< +      elif { test "${2+set}" = set && test -r $2/$dir/$file; } ||
< +           version_controlled_file $dir $file; then
< +        echo "$0: $dir/$file overrides $1/$dir/$file"
< +      else
< +        copied=$copied$sep$file; sep=$nl
< +        if test $file = gettext.m4; then
< +          echo "$0: patching m4/gettext.m4 to remove need for intl/* ..."
< +          rm -f $dir/$file
< +          sed '
< +            /^AC_DEFUN(\[AM_INTL_SUBDIR],/,/^]/c\
< +              AC_DEFUN([AM_INTL_SUBDIR], [])
< +            /^AC_DEFUN(\[gt_INTL_SUBDIR_CORE],/,/^]/c\
< +              AC_DEFUN([gt_INTL_SUBDIR_CORE], [])
< +            $a\
< +              AC_DEFUN([gl_LOCK_EARLY], [])
< +          ' $1/$dir/$file >$dir/$file
< +        else
< +          cp_mark_as_generated $1/$dir/$file $dir/$file
< +        fi
< +      fi || exit
< +    done
< +
< +    for dot_ig in x $vc_ignore; do
< +      test $dot_ig = x && continue
< +      ig=$dir/$dot_ig
< +      if test -n "$copied"; then
< +        insert_sorted_if_absent $ig "$copied"
< +        # If an ignored file name ends with .in.h, then also add
< +        # the name with just ".h".  Many gnulib headers are generated,
< +        # e.g., stdint.in.h -> stdint.h, dirent.in.h ->..., etc.
< +        # Likewise for .gperf -> .h, .y -> .c, and .sin -> .sed
< +        f=`echo "$copied"|sed 's/\.in\.h$/.h/;s/\.sin$/.sed/;s/\.y$/.c/;s/\.gperf$/.h/'`
< +        insert_sorted_if_absent $ig "$f"
< +
< +        # For files like sys_stat.in.h and sys_time.in.h, record as
< +        # ignorable the directory we might eventually create: sys/.
< +        f=`echo "$copied"|sed 's/sys_.*\.in\.h$/sys/'`
< +        insert_sorted_if_absent $ig "$f"
< +      fi
< +    done
<    done
< -  IFS=$old_IFS
< +}
<  
< -  rm -f $tempbase.0 $tempbase.1
< -  trap - 1 2 13 15
< -fi
< +
< +# Create boot temporary directories to import from gnulib and gettext.
< +rm -fr $bt $bt2 &&
< +mkdir $bt $bt2 || exit
<  
<  # Import from gnulib.
<  
<  gnulib_tool_options="\
<   --import\
<   --no-changelog\
< - --aux-dir $build_aux\
< - --doc-base $doc_base\
< + --aux-dir $bt/$build_aux\
< + --doc-base $bt/$doc_base\
<   --lib $gnulib_name\
< - --m4-base $m4_base/\
< - --source-base $source_base/\
< - --tests-base $tests_base\
< + --m4-base $bt/$m4_base/\
< + --source-base $bt/$source_base/\
< + --tests-base $bt/$tests_base\
<   --local-dir $local_gl_dir\
<   $gnulib_tool_option_extras\
<  "
< -if test $use_libtool = 1; then
< -  case "$gnulib_tool_options " in
< -    *' --libtool '*) ;;
< -    *) gnulib_tool_options="$gnulib_tool_options --libtool" ;;
< -  esac
< -fi
<  echo "$0: $gnulib_tool $gnulib_tool_options --import ..."
< -$gnulib_tool $gnulib_tool_options --import $gnulib_modules \
< -  || die "gnulib-tool failed"
< +$gnulib_tool $gnulib_tool_options --import $gnulib_modules &&
< +slurp $bt || exit
<  
<  for file in $gnulib_files; do
< -  symlink_to_dir "$GNULIB_SRCDIR" $file \
< -    || die "failed to symlink $file"
< +  symlink_to_dir "$GNULIB_SRCDIR" $file || exit
<  done
<  
< -bootstrap_post_import_hook \
< -  || die "bootstrap_post_import_hook failed"
< +
< +# Import from gettext.
< +with_gettext=yes
< +grep '^[	 ]*AM_GNU_GETTEXT_VERSION(' configure.ac >/dev/null || \
< +    with_gettext=no
< +
< +if test $with_gettext = yes; then
< +  echo "$0: (cd $bt2; ${AUTOPOINT-autopoint}) ..."
< +  cp configure.ac $bt2 &&
< +  (cd $bt2 && ${AUTOPOINT-autopoint} && rm configure.ac) &&
< +  slurp $bt2 $bt || exit
< +fi
< +rm -fr $bt $bt2 || exit
<  
<  # Remove any dangling symlink matching "*.m4" or "*.[ch]" in some
<  # gnulib-populated directories.  Such .m4 files would cause aclocal to fail.
< @@ -940,32 +765,45 @@ find "$m4_base" "$source_base" \
<    -depth \( -name '*.m4' -o -name '*.[ch]' \) \
<    -type l -xtype l -delete > /dev/null 2>&1
<  
< -# Invoke autoreconf with --force --install to ensure upgrades of tools
< -# such as ylwrap.
< -AUTORECONFFLAGS="--verbose --install --force -I $m4_base $ACLOCAL_FLAGS"
< -
< -# Some systems (RHEL 5) are using ancient autotools, for which the
< -# --no-recursive option had not been invented.  Detect that lack and
< -# omit the option when it's not supported.  FIXME in 2017: remove this
< -# hack when RHEL 5 autotools are updated, or when they become irrelevant.
< -case $($AUTORECONF --help) in
< -  *--no-recursive*) AUTORECONFFLAGS="$AUTORECONFFLAGS --no-recursive";;
< -esac
< +# Reconfigure, getting other files.
< +
< +# Skip autoheader if it's not needed.
< +grep -E '^[	 ]*AC_CONFIG_HEADERS?\>' configure.ac >/dev/null ||
< +  AUTOHEADER=true
< +
< +for command in \
< +  libtool \
< +  "${ACLOCAL-aclocal} --force -I m4" \
< +  "${AUTOCONF-autoconf} --force" \
< +  "${AUTOHEADER-autoheader} --force" \
< +  "${AUTOMAKE-automake} --add-missing --copy --force-missing"
< +do
< +  if test "$command" = libtool; then
< +    use_libtool=0
< +    # We'd like to use grep -E, to see if any of LT_INIT,
< +    # AC_PROG_LIBTOOL, AM_PROG_LIBTOOL is used in configure.ac,
< +    # but that's not portable enough (e.g., for Solaris).
< +    grep '^[	 ]*A[CM]_PROG_LIBTOOL' configure.ac >/dev/null \
< +      && use_libtool=1
< +    grep '^[	 ]*LT_INIT' configure.ac >/dev/null \
< +      && use_libtool=1
< +    test $use_libtool = 0 \
< +      && continue
< +    command="${LIBTOOLIZE-libtoolize} -c -f"
< +  fi
< +  echo "$0: $command ..."
< +  $command || exit
< +done
<  
< -# Tell autoreconf not to invoke autopoint or libtoolize; they were run above.
< -echo "running: AUTOPOINT=true LIBTOOLIZE=true $AUTORECONF $AUTORECONFFLAGS"
< -AUTOPOINT=true LIBTOOLIZE=true $AUTORECONF $AUTORECONFFLAGS \
< -  || die "autoreconf failed"
<  
<  # Get some extra files from gnulib, overriding existing files.
<  for file in $gnulib_extra_files; do
<    case $file in
<    */INSTALL) dst=INSTALL;;
< -  build-aux/*) dst=$build_aux/${file#build-aux/};;
< +  build-aux/*) dst=$build_aux/`expr "$file" : 'build-aux/\(.*\)'`;;
<    *) dst=$file;;
<    esac
< -  symlink_to_dir "$GNULIB_SRCDIR" $file $dst \
< -    || die "failed to symlink $file"
< +  symlink_to_dir "$GNULIB_SRCDIR" $file $dst || exit
<  done
<  
<  if test $with_gettext = yes; then
< @@ -981,19 +819,7 @@ if test $with_gettext = yes; then
<        a\
<            '"$XGETTEXT_OPTIONS"' $${end_of_xgettext_options+}
<      }
< -  ' po/Makevars.template >po/Makevars \
< -    || die 'cannot generate po/Makevars'
< -
< -  # If the 'gettext' module is in use, grab the latest Makefile.in.in.
< -  # If only the 'gettext-h' module is in use, assume autopoint already
< -  # put the correct version of this file into place.
< -  case $gnulib_modules in
< -  *gettext-h*) ;;
< -  *gettext*)
< -    cp $GNULIB_SRCDIR/build-aux/po/Makefile.in.in po/Makefile.in.in \
< -      || die "cannot create po/Makefile.in.in"
< -    ;;
< -  esac
< +  ' po/Makevars.template >po/Makevars || exit 1
<  
<    if test -d runtime-po; then
<      # Similarly for runtime-po/Makevars, but not quite the same.
< @@ -1007,8 +833,7 @@ if test $with_gettext = yes; then
<          a\
<              '"$XGETTEXT_OPTIONS_RUNTIME"' $${end_of_xgettext_options+}
<        }
< -    ' po/Makevars.template >runtime-po/Makevars \
< -    || die 'cannot generate runtime-po/Makevars'
< +    ' po/Makevars.template >runtime-po/Makevars || exit 1
<  
<      # Copy identical files from po to runtime-po.
<      (cd po && cp -p Makefile.in.in *-quot *.header *.sed *.sin ../runtime-po)
< @@ -1023,6 +848,6 @@ echo "$0: done.  Now you can run './conf
<  # eval: (add-hook 'write-file-hooks 'time-stamp)
<  # time-stamp-start: "scriptversion="
<  # time-stamp-format: "%:y-%02m-%02d.%02H"
< -# time-stamp-time-zone: "UTC0"
< +# time-stamp-time-zone: "UTC"
<  # time-stamp-end: "; # UTC"
<  # End:
< diff -pru diffutils-3.0/bootstrap.conf diffutils-3.0-patch/bootstrap.conf
< --- diffutils-3.0/bootstrap.conf	2020-03-01 22:03:00.311715000 -0800
< +++ diffutils-3.0-patch/bootstrap.conf	2020-03-01 14:52:55.464191000 -0800
< @@ -1,6 +1,6 @@
<  # Bootstrap configuration.
<  
< -# Copyright (C) 2006-2013, 2015-2017 Free Software Foundation, Inc.
< +# Copyright (C) 2006-2010 Free Software Foundation, Inc.
<  
<  # This program is free software: you can redistribute it and/or modify
<  # it under the terms of the GNU General Public License as published by
< @@ -19,8 +19,6 @@
<  # gnulib modules used by this package.
<  gnulib_modules='
<  announce-gen
< -argmatch
< -binary-io
<  c-stack
<  config-h
<  diffseq
< @@ -29,15 +27,15 @@ do-release-commit-and-tag
<  dup2
<  error
<  exclude
< +exit
<  exitfail
<  extensions
<  fcntl
<  fdl
<  file-type
< -filenamecat
<  fnmatch-gnu
<  getopt
< -gettext-h
< +gettext
<  gettime
<  git-version-gen
<  gitlog-to-changelog
< @@ -48,9 +46,6 @@ gnupload
<  hard-locale
<  inttostr
<  inttypes
< -isblank
< -largefile
< -lstat
<  maintainer-makefile
<  manywarnings
<  mbrtowc
< @@ -58,34 +53,26 @@ mkstemp
<  mktime
<  progname
<  propername
< -rawmemchr
< -readme-release
<  regex
<  sh-quote
< -signal
< -stat
<  stat-macros
<  stat-time
< -stdint
<  strcase
<  strftime
<  strptime
<  strtoumax
<  sys_wait
< -system-quote
< +timegm
<  unistd
<  unlocked-io
<  update-copyright
< -vararrays
<  verify
<  version-etc
<  version-etc-fsf
<  wcwidth
<  xalloc
<  xfreopen
< -xreadlink
<  xstrtoumax
< -xvasprintf
<  '
<  
<  # Additional xgettext options to use.  Use "\\\newline" to break lines.
< @@ -97,21 +84,45 @@ XGETTEXT_OPTIONS=$XGETTEXT_OPTIONS'\\\
<   --flag=try_help:1:c-format\\\
<  '
<  
< -gnulib_tool_option_extras="--tests-base=gnulib-tests --with-tests
< -  --avoid=localename
< -  --avoid=lock
< -  --symlink
< -  --makefile-name=gnulib.mk
< -"
< +# If "AM_GNU_GETTEXT(external" or "AM_GNU_GETTEXT([external]"
< +# appears in configure.ac, exclude some unnecessary files.
< +# Without grep's -E option (not portable enough, pre-configure),
< +# the following test is ugly.  Also, this depends on the existence
< +# of configure.ac, not the obsolescent-named configure.in.  But if
< +# you're using this infrastructure, you should care about such things.
< +
< +gettext_external=0
< +grep '^[	 ]*AM_GNU_GETTEXT(external\>' configure.ac > /dev/null &&
< +  gettext_external=1
< +grep '^[	 ]*AM_GNU_GETTEXT(\[external\]' configure.ac > /dev/null &&
< +  gettext_external=1
< +
< +if test $gettext_external = 1; then
< +  # Gettext supplies these files, but we don't need them since
< +  # we don't have an intl subdirectory.
< +  excluded_files='
< +      m4/glibc2.m4
< +      m4/intdiv0.m4
< +      m4/lcmessage.m4
< +      m4/lock.m4
< +      m4/printf-posix.m4
< +      m4/size_max.m4
< +      m4/uintmax_t.m4
< +      m4/ulonglong.m4
< +      m4/visibility.m4
< +      m4/xsize.m4
< +'
< +fi
< +
< +gnulib_tool_option_extras="--tests-base=$bt/gnulib-tests --with-tests"
<  
<  # Build prerequisites
<  buildreq="\
<  autoconf   2.61
< -automake   1.12.2
< +automake   1.11
<  autopoint  -
< -gettext    0.19.2
< +gettext    -
<  git        1.4.4
< -gperf      -
<  gzip       -
<  help2man   -
<  makeinfo   -
< @@ -120,38 +131,13 @@ rsync      -
<  tar        -
<  "
<  
< -bootstrap_post_import_hook()
< -{
< -  # Automake requires that ChangeLog exist.
< -  touch ChangeLog || exit 1
< -}
< +# Automake requires that ChangeLog exist.
< +touch ChangeLog || exit 1
<  
<  bootstrap_epilogue()
<  {
< -  perl -pi -e "s/\@PACKAGE\@/$package/g" README-release
< -
< -  # Since this is a "GNU" package, replace this line
< -  #   if LC_ALL=C grep 'GNU @PACKAGE@' $(top_srcdir)/* 2>/dev/null \
< -  #      | grep -v 'libtool:' >/dev/null; then
< -  # with this:
< -  #   if true; then
< -  # Why?  That pipeline searches all files in $(top_srcdir), and if you
< -  # happen to have large files (or apparently large sparse files), the
< -  # first grep may well run out of memory.
< -  perl -pi -e 's/if LC_ALL=C grep .GNU .PACKAGE.*; then/if true; then/' \
< -    po/Makefile.in.in
< -
< -  # Install our git hooks, as long as "cp" accepts the --backup option,
< -  # so that we can back up any existing files.
< -  case $(cp --help) in *--backup*) backup=1;; *) backup=0;; esac
< -  if test $backup = 1; then
< -    hooks=$(cd scripts/git-hooks && git ls-files)
< -    for f in $hooks; do
< -      # If it is identical, skip it.
< -      cmp scripts/git-hooks/$f .git/hooks/$f > /dev/null \
< -        && continue
< -      cp --backup=numbered scripts/git-hooks/$f .git/hooks
< -      chmod a-w .git/hooks/$f
< -    done
< -  fi
< +  # Change paths in gnulib-tests/gnulib.mk from "../.." to "..".
< +  m=gnulib-tests/gnulib.mk
< +  sed 's,\.\./\.\.,..,g' $m > $m-t
< +  mv -f $m-t $m
<  }
< Only in diffutils-3.0-patch: build-aux
< diff -pru diffutils-3.0/cfg.mk diffutils-3.0-patch/cfg.mk
< --- diffutils-3.0/cfg.mk	2020-03-01 22:03:00.312717000 -0800
< +++ diffutils-3.0-patch/cfg.mk	2020-03-01 14:52:55.466190000 -0800
< @@ -1,5 +1,5 @@
<  # Customize maint.mk                           -*- makefile -*-
< -# Copyright (C) 2003-2013, 2015-2017 Free Software Foundation, Inc.
< +# Copyright (C) 2003-2010 Free Software Foundation, Inc.
<  
<  # This program is free software: you can redistribute it and/or modify
<  # it under the terms of the GNU General Public License as published by
< @@ -14,28 +14,22 @@
<  # You should have received a copy of the GNU General Public License
<  # along with this program.  If not, see <http://www.gnu.org/licenses/>.
<  
< -# Use the direct link.  This is guaranteed to work immediately, while
< -# it can take a while for the faster mirror links to become usable.
< -url_dir_list = http://ftp.gnu.org/gnu/$(PACKAGE)
< -
<  # Used in maint.mk's web-manual rule
<  manual_title = Comparing and Merging Files
<  
<  # Tests not to run as part of "make distcheck".
<  local-checks-to-skip =		\
<    sc_error_message_period	\
< -  sc_error_message_uppercase
< +  sc_error_message_uppercase	\
< +  sc_texinfo_acronym
<  
<  # Tools used to bootstrap this package, used for "announcement".
<  bootstrap-tools = autoconf,automake,gnulib
<  
< -# Override the default Cc: used in generating an announcement.
< -announcement_Cc_ = $(translation_project_), $(PACKAGE)-devel@gnu.org
< -
<  # Now that we have better tests, make this the default.
<  export VERBOSE = yes
<  
< -old_NEWS_hash = 773368daadfe6d96f43de867c87f45e7
< +old_NEWS_hash = 5ce999f299bd2e9f44cbfef49015b45f
<  
<  # Tell maint.mk's syntax-check rules that diff gets config.h directly or
<  # via diff.h or system.h.
< @@ -45,7 +39,7 @@ update-copyright-env = \
<    UPDATE_COPYRIGHT_USE_INTERVALS=1 \
<    UPDATE_COPYRIGHT_MAX_LINE_LENGTH=79
<  
< --include $(srcdir)/dist-check.mk
< +include $(srcdir)/dist-check.mk
<  
<  _cf_state_dir ?= .config-state
<  _date_time := $(shell date +%F.%T)
< @@ -66,10 +60,5 @@ config-save:
<  	$(MAKE) --quiet config-compare > /dev/null 2>&1 \
<  	  && { echo no change; exit 1; } || :
<  	mkdir -p $(_cf_state_dir)/$(_date_time)
< -	ln -nsf $(_date_time) $(_cf_state_dir)/latest
< +	ln -nsf $(date_time) $(_cf_state_dir)/latest
<  	cp lib/config.h config.status $(_cf_state_dir)/latest
< -
< -exclude_file_name_regexp--sc_space_tab = ^gl/lib/.*\.c\.diff$$
< -
< -# Tell gnulib's tight_scope rule that we mark externs with XTERN
< -export _gl_TS_extern = extern|XTERN
< Only in diffutils-3.0-patch: ChangeLog
< diff -pru diffutils-3.0/ChangeLog-2008 diffutils-3.0-patch/ChangeLog-2008
< --- diffutils-3.0/ChangeLog-2008	2020-03-01 22:03:00.301720000 -0800
< +++ diffutils-3.0-patch/ChangeLog-2008	2020-03-01 14:52:55.434190000 -0800
< @@ -1068,7 +1068,7 @@
<  	(Standards conformance): New chapter.
<  	(Binary): Differing binary files are trouble unless the user asked for
<  	brief output.
< -	(Detailed Context): Prefer ISO timestamp format in discussion.
< +	(Detailed Context): Prefer ISO time stamp format in discussion.
<  	(Detailed Unified, Pagination): Likewise.
<  	(Less Context): Likewise.  Also use short option.
<  	(Alternate Names): Separate option from arg.
< @@ -1189,7 +1189,7 @@
<  	likewise for -u and -U 3.
<  	Use specify_style and specify_value.
<  	(SIGCHLD): Do not define; now done in a header.
< -	Use new style timestamp format for -u / -U.
< +	Use new style time stamp format for -u / -U.
<  	Reject numeric-string options if operating in POSIX 1003.1-2001 mode.
<  	Avoid overflow problems with tab width.
<  	Simplify from-file and to-file code.
< @@ -1956,7 +1956,7 @@
<  	(TIMESPEC_NS): New macro.
<  	(nstrftime): New decl.
<  	(print_context_label): Use nstrftime and time_format to format times.
< -	Print numeric timestamp value if localtime fails.
< +	Print numeric time stamp value if localtime fails.
<  	(print_context_function): New function.
<  	(pr_context_hunk, pr_unidiff_hunk): Use it.
<  	(find_function): Use size_t for sizes, not int.
< @@ -2538,7 +2538,7 @@ Thu Sep 22 16:47:00 1994  Paul Eggert  <
<  	(binprefix): Removed.
<  	(distfiles): Add stamp-h.in.
<  	(clean): Clean stamp-h.
< -	(config.hin, config.h): Use timestamp files.
< +	(config.hin, config.h): Use time stamp files.
<  	(cmp_o): Add $(LIBOBJS).
<  	(install): Install info files from srcdir if they're not in `.'.
<  
< @@ -4265,8 +4265,8 @@ Thu Nov  3 16:30:24 1988  Randall Smith
<  
<  	-----
<  
< -	Copyright (C) 1988-1994, 1997-2002, 2004, 2006, 2009-2013, 2015-2017
< -	Free Software Foundation, Inc.
< +	Copyright (C) 1988-1994, 1997-2002, 2004, 2006, 2009-2010 Free Software
< +	Foundation, Inc.
<  
<  	Copying and distribution of this file, with or without
<  	modification, are permitted provided the copyright notice and this
< Only in diffutils-3.0-patch: config.log
< Only in diffutils-3.0-patch: config.status
< Only in diffutils-3.0-patch: configure
< diff -pru diffutils-3.0/configure.ac diffutils-3.0-patch/configure.ac
< --- diffutils-3.0/configure.ac	2020-03-01 22:03:00.313716000 -0800
< +++ diffutils-3.0-patch/configure.ac	2020-03-01 14:52:55.468189000 -0800
< @@ -1,7 +1,7 @@
<  # Configure template for GNU Diffutils.
<  
< -# Copyright (C) 1994-1995, 1998, 2001-2002, 2004, 2006, 2009-2013, 2015-2017
< -# Free Software Foundation, Inc.
< +# Copyright (C) 1994-1995, 1998, 2001-2002, 2004, 2006, 2009-2010 Free Software
< +# Foundation, Inc.
<  
<  # This program is free software: you can redistribute it and/or modify
<  # it under the terms of the GNU General Public License as published by
< @@ -26,19 +26,19 @@ AC_CONFIG_SRCDIR([src/diff.c])
<  AC_CONFIG_AUX_DIR([build-aux])
<  AC_CONFIG_MACRO_DIR([m4])
<  
< -AM_INIT_AUTOMAKE([1.11 dist-xz no-dist-gzip subdir-objects
< -                       color-tests parallel-tests])
< +AM_INIT_AUTOMAKE([1.11 dist-xz color-tests parallel-tests])
<  AM_SILENT_RULES([yes]) # make --enable-silent-rules the default.
<  
<  AC_CONFIG_HEADER([lib/config.h:lib/config.hin])
<  
<  AC_PROG_AWK
<  AC_PROG_CC
< -AM_PROG_CC_C_O
< +AM_PROG_CC_STDC
<  AM_MISSING_PROG([HELP2MAN], [help2man])
<  AC_PROG_RANLIB
<  gl_EARLY
<  gl_USE_SYSTEM_EXTENSIONS
< +AC_SYS_LARGEFILE
<  gl_INIT
<  
<  AC_ARG_ENABLE([gcc-warnings],
< @@ -49,11 +49,7 @@ AC_ARG_ENABLE([gcc-warnings],
<       *)      AC_MSG_ERROR([bad value $enableval for gcc-warnings option]) ;;
<     esac
<     gl_gcc_warnings=$enableval],
< -  [if test -d "$srcdir"/.git; then
< -     gl_gcc_warnings=yes
< -   else
< -     gl_gcc_warnings=no
< -   fi]
< +  [gl_gcc_warnings=no]
<  )
<  
<  if test "$gl_gcc_warnings" = yes; then
< @@ -101,7 +97,6 @@ if test "$gl_gcc_warnings" = yes; then
<    gl_WARN_ADD([-Wno-sign-compare])     # Too many warnings for now
<    gl_WARN_ADD([-Wno-pointer-sign])     # Too many warnings for now
<    gl_WARN_ADD([-Wno-unused-parameter]) # Too many warnings for now
< -  gl_WARN_ADD([-Wno-format-nonliteral])
<  
<    # In spite of excluding -Wlogical-op above, it is enabled, as of
<    # gcc 4.5.0 20090517, and it provokes warnings in cat.c, dd.c, truncate.c
< @@ -109,7 +104,6 @@ if test "$gl_gcc_warnings" = yes; then
<  
<    gl_WARN_ADD([-fdiagnostics-show-option])
<    gl_WARN_ADD([-funit-at-a-time])
< -  gl_WARN_ADD([-fno-common])
<  
<    AC_SUBST([WARN_CFLAGS])
<  
< @@ -124,7 +118,6 @@ if test "$gl_gcc_warnings" = yes; then
<    nw="$nw -Wunused-macros"
<    nw="$nw -Wmissing-prototypes"
<    nw="$nw -Wold-style-definition"
< -  nw="$nw -Wsuggest-attribute=pure"
<    gl_MANYWARN_COMPLEMENT([GNULIB_WARN_CFLAGS], [$WARN_CFLAGS], [$nw])
<    AC_SUBST([GNULIB_WARN_CFLAGS])
<  fi
< @@ -151,21 +144,8 @@ fi
<  AC_FUNC_CLOSEDIR_VOID
<  AC_FUNC_FORK
<  
< -# When .tarball-version exists, we're building from a tarball
< -# and must not make man/*.1 files depend on the generated src/version.c,
< -# because that would induce a requirement to run the help2man perl script.
< -# We are not yet prepared to make perl a build-from-tarball requirement.
< -# Hence, here we detect .tarball-version existence.  When not present,
< -# we define a variable to be used in man/Makefile.am to induce the
< -# proper dependency (so that man/*.1 will be rebuilt upon any version change),
< -# but not when built from a tarball.
< -AC_SUBST([SRC_VERSION_C])
< -test -f $srcdir/.tarball-version \
< -  && SRC_VERSION_C= \
< -  || SRC_VERSION_C=../src/version.c
< -
<  AM_GNU_GETTEXT([external], [need-ngettext])
< -AM_GNU_GETTEXT_VERSION([0.19.2])
< +AM_GNU_GETTEXT_VERSION([0.17])
<  XGETTEXT="AWK='$AWK' \$(SHELL) \$(top_srcdir)/exgettext $XGETTEXT"
<  
<  AC_CONFIG_FILES([
< @@ -176,5 +156,6 @@ AC_CONFIG_FILES([
<    gnulib-tests/Makefile
<    man/Makefile
<    po/Makefile.in
< +  ms/Makefile
<  ])
<  AC_OUTPUT
< diff -pru diffutils-3.0/dist-check.mk diffutils-3.0-patch/dist-check.mk
< --- diffutils-3.0/dist-check.mk	2020-03-01 22:03:00.314716000 -0800
< +++ diffutils-3.0-patch/dist-check.mk	2020-03-01 14:52:55.469193000 -0800
< @@ -161,7 +161,6 @@ my-distcheck: $(DIST_ARCHIVES) $(local-c
<  	)
<  	(cd $(t) && mv $(distdir) $(distdir).old	\
<  	  && $(amtar_extract_) - ) < $(preferred_tarball_)
< -	find $(t)/$(distdir).old $(t)/$(distdir) -name .deps | xargs rm -rf
<  	diff -ur $(t)/$(distdir).old $(t)/$(distdir)
<  	-rm -rf $(t)
<  	rmdir $(tmpdir)/$(PACKAGE) $(tmpdir)
< diff -pru diffutils-3.0/doc/diagmeet.note diffutils-3.0-patch/doc/diagmeet.note
< --- diffutils-3.0/doc/diagmeet.note	2020-03-01 22:03:00.317716000 -0800
< +++ diffutils-3.0-patch/doc/diagmeet.note	2020-03-01 14:56:59.447581000 -0800
< @@ -1,5 +1,5 @@
<  Here is a comparison matrix which shows a case in which
< -it is possible for the forward and backward scan in 'diag'
< +it is possible for the forward and backward scan in `diag'
<  to meet along a nonzero length of diagonal simultaneous
<  (so that bdiag[d] and fdiag[d] are not equal)
<  even though there is no snake on that diagonal at the meeting point.
< Only in diffutils-3.0-patch/doc: diff.info
< Only in diffutils-3.0-patch/doc: diff.texi
< Only in diffutils-3.0/doc: diffutils.texi
< Only in diffutils-3.0-patch/doc: fdl.texi
< Only in diffutils-3.0-patch/doc: gendocs_template
< Only in diffutils-3.0-patch/doc: .gitignore
< Only in diffutils-3.0-patch/doc: Makefile
< diff -pru diffutils-3.0/doc/Makefile.am diffutils-3.0-patch/doc/Makefile.am
< --- diffutils-3.0/doc/Makefile.am	2020-03-01 22:03:00.316716000 -0800
< +++ diffutils-3.0-patch/doc/Makefile.am	2020-03-01 14:52:55.471190000 -0800
< @@ -1,6 +1,6 @@
<  # Makefile for GNU diffutils documentation.
<  
< -# Copyright (C) 2001-2002, 2009-2013, 2015-2017 Free Software Foundation, Inc.
< +# Copyright (C) 2001-2002, 2009-2010 Free Software Foundation, Inc.
<  
<  # This program is free software: you can redistribute it and/or modify
<  # it under the terms of the GNU General Public License as published by
< @@ -17,7 +17,7 @@
<  
<  AM_MAKEINFOFLAGS = --no-split
<  
< -info_TEXINFOS = diffutils.texi
< -diffutils_TEXINFOS = fdl.texi
< +info_TEXINFOS = diff.texi
< +diff_TEXINFOS = fdl.texi
<  
<  EXTRA_DIST = diagmeet.note
< Only in diffutils-3.0-patch/doc: Makefile.in
< Only in diffutils-3.0-patch/doc: stamp-vti
< Only in diffutils-3.0-patch/doc: version.texi
< diff -pru diffutils-3.0/exgettext diffutils-3.0-patch/exgettext
< --- diffutils-3.0/exgettext	2020-03-01 22:03:00.371720000 -0800
< +++ diffutils-3.0-patch/exgettext	2020-03-01 14:52:55.481195000 -0800
< @@ -1,8 +1,7 @@
<  #! /bin/sh
<  # Wrapper around gettext for programs using the msgid convention.
<  
< -# Copyright (C) 1998, 2001, 2004, 2009-2013, 2015-2017 Free Software
< -# Foundation, Inc.
< +# Copyright (C) 1998, 2001, 2004, 2009-2010 Free Software Foundation, Inc.
<  
<  # Written by Paul Eggert <eggert@twinsun.com>.
<  
< Only in diffutils-3.0-patch: get-patch.txt
< diff -pru diffutils-3.0/.git/config diffutils-3.0-patch/.git/config
< --- diffutils-3.0/.git/config	2020-03-01 22:03:00.260709000 -0800
< +++ diffutils-3.0-patch/.git/config	2020-03-01 21:37:41.114555000 -0800
< @@ -9,3 +9,6 @@
<  [branch "master"]
<  	remote = origin
<  	merge = refs/heads/master
< +[submodule "gnulib"]
< +	active = true
< +	url = git://git.sv.gnu.org/gnulib.git
< diff -pru diffutils-3.0/.git/HEAD diffutils-3.0-patch/.git/HEAD
< --- diffutils-3.0/.git/HEAD	2020-03-01 22:03:00.186703000 -0800
< +++ diffutils-3.0-patch/.git/HEAD	2020-03-01 14:52:55.637205000 -0800
< @@ -1 +1 @@
< -ref: refs/heads/master
< +022cd5c5eb647a22a4daa5fe5cbc10af6d5a1112
< Binary files diffutils-3.0/.git/index and diffutils-3.0-patch/.git/index differ
< diff -pru diffutils-3.0/.git/logs/HEAD diffutils-3.0-patch/.git/logs/HEAD
< --- diffutils-3.0/.git/logs/HEAD	2020-03-01 22:03:00.241707000 -0800
< +++ diffutils-3.0-patch/.git/logs/HEAD	2020-03-01 14:52:55.638204000 -0800
< @@ -1 +1,2 @@
< -0000000000000000000000000000000000000000 487e009ed7294021dcc0b66c2b5a5046aea51ab4 William Meyer Baumbacher <classwba@lnxsrv10.seas.ucla.edu> 1583128980 -0800	clone: from /u/cs/fac/eggert/src/gnu/diffutils
< +0000000000000000000000000000000000000000 487e009ed7294021dcc0b66c2b5a5046aea51ab4 William Meyer Baumbacher <classwba@lnxsrv10.seas.ucla.edu> 1583103118 -0800	clone: from /u/cs/fac/eggert/src/gnu/diffutils
< +487e009ed7294021dcc0b66c2b5a5046aea51ab4 022cd5c5eb647a22a4daa5fe5cbc10af6d5a1112 William Meyer Baumbacher <classwba@lnxsrv10.seas.ucla.edu> 1583103175 -0800	checkout: moving from master to v3.0
< diff -pru diffutils-3.0/.git/logs/refs/heads/master diffutils-3.0-patch/.git/logs/refs/heads/master
< --- diffutils-3.0/.git/logs/refs/heads/master	2020-03-01 22:03:00.255708000 -0800
< +++ diffutils-3.0-patch/.git/logs/refs/heads/master	2020-03-01 14:51:58.848994000 -0800
< @@ -1 +1 @@
< -0000000000000000000000000000000000000000 487e009ed7294021dcc0b66c2b5a5046aea51ab4 William Meyer Baumbacher <classwba@lnxsrv10.seas.ucla.edu> 1583128980 -0800	clone: from /u/cs/fac/eggert/src/gnu/diffutils
< +0000000000000000000000000000000000000000 487e009ed7294021dcc0b66c2b5a5046aea51ab4 William Meyer Baumbacher <classwba@lnxsrv10.seas.ucla.edu> 1583103118 -0800	clone: from /u/cs/fac/eggert/src/gnu/diffutils
< diff -pru diffutils-3.0/.git/logs/refs/remotes/origin/HEAD diffutils-3.0-patch/.git/logs/refs/remotes/origin/HEAD
< --- diffutils-3.0/.git/logs/refs/remotes/origin/HEAD	2020-03-01 22:03:00.184701000 -0800
< +++ diffutils-3.0-patch/.git/logs/refs/remotes/origin/HEAD	2020-03-01 14:51:58.751985000 -0800
< @@ -1 +1 @@
< -0000000000000000000000000000000000000000 487e009ed7294021dcc0b66c2b5a5046aea51ab4 William Meyer Baumbacher <classwba@lnxsrv10.seas.ucla.edu> 1583128980 -0800	clone: from /u/cs/fac/eggert/src/gnu/diffutils
< +0000000000000000000000000000000000000000 487e009ed7294021dcc0b66c2b5a5046aea51ab4 William Meyer Baumbacher <classwba@lnxsrv10.seas.ucla.edu> 1583103118 -0800	clone: from /u/cs/fac/eggert/src/gnu/diffutils
< Only in diffutils-3.0-patch/.git: modules
< diff -pru diffutils-3.0/.gitignore diffutils-3.0-patch/.gitignore
< --- diffutils-3.0/.gitignore	2020-03-01 22:03:00.293715000 -0800
< +++ diffutils-3.0-patch/.gitignore	2020-03-01 14:52:55.426188000 -0800
< @@ -5,24 +5,17 @@
<  .deps
<  .dirstamp
<  .gdb-history
< -/ABOUT-NLS
<  /GNUmakefile
<  /INSTALL
< -/README-release
<  /aclocal.m4
< -/build-aux
<  /config.cache
<  /config.log
<  /config.status
<  /configure
< +/diffutils-*.tar.gz
<  /diffutils-*.tar.xz
<  /doc/.gitignore
< -/doc/diffutils.aux
< -/doc/diffutils.cp
< -/doc/diffutils.cps
< -/doc/diffutils.info
< -/doc/diffutils.log
< -/doc/diffutils.toc
< +/doc/diff.info
<  /doc/stamp-vti
<  /doc/version.texi
<  /gnulib-tests
< @@ -30,39 +23,15 @@
<  /gnulib-tests/locale/
<  /gnulib-tests/uniwidth/
<  /lib/.gitignore
< -/lib/alloca.h
<  /lib/c++defs.h
<  /lib/charset.alias
<  /lib/config.h
<  /lib/config.hin
<  /lib/configmake.h
< -/lib/fcntl.h
< -/lib/iconv*.h
< -/lib/inttypes.h
< -/lib/langinfo.h
< -/lib/locale.h
< -/lib/ref-add.sed
< -/lib/ref-del.sed
< -/lib/signal.h
<  /lib/stamp-h1
< -/lib/stdio.h
< -/lib/stdlib.h
< -/lib/string.h
< -/lib/strings.h
< -/lib/sys/
< -/lib/time.h
< -/lib/unistd.h
< -/lib/unistr
< -/lib/unistr.h
< -/lib/unitypes.h
<  /lib/uniwidth
< -/lib/uniwidth.h
< -/lib/unused-parameter.h
<  /lib/warn-on-use.h
< -/lib/wchar.h
< -/lib/wctype.h
<  /m4/.gitignore
< -/m4/gnulib-cache.m4
<  /maint.mk
<  /po/*.pot
<  /po/*.sed
< @@ -94,6 +63,4 @@ src/diff
<  src/diff3
<  src/paths.h
<  src/sdiff
< -src/version.[ch]
<  tests/*.log
< -tests/*.trs
< Only in diffutils-3.0-patch/gl/lib: regcomp.c.diff
< Only in diffutils-3.0-patch/gl/lib: regexec.c.diff
< Only in diffutils-3.0-patch/gl/lib: regex_internal.c.diff
< Only in diffutils-3.0-patch/gl/lib: regex_internal.h.diff
< Only in diffutils-3.0-patch/gnulib: build-aux
< Only in diffutils-3.0-patch/gnulib: ChangeLog
< Only in diffutils-3.0-patch/gnulib: check-module
< Only in diffutils-3.0-patch/gnulib: config
< Only in diffutils-3.0-patch/gnulib: COPYING
< Only in diffutils-3.0-patch/gnulib: .cvsignore
< Only in diffutils-3.0-patch/gnulib: DEPENDENCIES
< Only in diffutils-3.0-patch/gnulib: doc
< Only in diffutils-3.0-patch/gnulib: .git
< Only in diffutils-3.0-patch/gnulib: .gitattributes
< Only in diffutils-3.0-patch/gnulib: .gitignore
< Only in diffutils-3.0-patch/gnulib: gnulib-tool
< Only in diffutils-3.0-patch/gnulib: lib
< Only in diffutils-3.0-patch/gnulib: m4
< Only in diffutils-3.0-patch/gnulib: Makefile
< Only in diffutils-3.0-patch/gnulib: modules
< Only in diffutils-3.0-patch/gnulib: MODULES.html.sh
< Only in diffutils-3.0-patch/gnulib: NEWS
< Only in diffutils-3.0-patch/gnulib: posix-modules
< Only in diffutils-3.0-patch/gnulib: README
< Only in diffutils-3.0-patch/gnulib: tests
< Only in diffutils-3.0-patch/gnulib: top
< Only in diffutils-3.0-patch/gnulib: users.txt
< Only in diffutils-3.0-patch/gnulib-tests: argmatch.c
< Only in diffutils-3.0-patch/gnulib-tests: argmatch.h
< Only in diffutils-3.0-patch/gnulib-tests: arg-nonnull.h
< Only in diffutils-3.0-patch/gnulib-tests: binary-io.h
< Only in diffutils-3.0-patch/gnulib-tests: c++defs.h
< Only in diffutils-3.0-patch/gnulib-tests: .deps
< Only in diffutils-3.0-patch/gnulib-tests: .gitignore
< Only in diffutils-3.0-patch/gnulib-tests: gnulib.mk
< Only in diffutils-3.0-patch/gnulib-tests: hash-pjw.c
< Only in diffutils-3.0-patch/gnulib-tests: hash-pjw.h
< Only in diffutils-3.0-patch/gnulib-tests: init.sh
< Only in diffutils-3.0-patch/gnulib-tests: locale
< Only in diffutils-3.0-patch/gnulib-tests: macros.h
< Only in diffutils-3.0-patch/gnulib-tests: Makefile
< Only in diffutils-3.0-patch/gnulib-tests: Makefile.in
< Only in diffutils-3.0-patch/gnulib-tests: pathmax.h
< Only in diffutils-3.0-patch/gnulib-tests: putenv.c
< Only in diffutils-3.0-patch/gnulib-tests: same-inode.h
< Only in diffutils-3.0-patch/gnulib-tests: setenv.c
< Only in diffutils-3.0-patch/gnulib-tests: signature.h
< Only in diffutils-3.0-patch/gnulib-tests: sleep.c
< Only in diffutils-3.0-patch/gnulib-tests: symlink.c
< Only in diffutils-3.0-patch/gnulib-tests: test-alloca-opt.c
< Only in diffutils-3.0-patch/gnulib-tests: test-argmatch.c
< Only in diffutils-3.0-patch/gnulib-tests: test-binary-io.c
< Only in diffutils-3.0-patch/gnulib-tests: test-binary-io.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-bitrotate.c
< Only in diffutils-3.0-patch/gnulib-tests: test-btowc1.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-btowc2.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-btowc.c
< Only in diffutils-3.0-patch/gnulib-tests: test-c-ctype.c
< Only in diffutils-3.0-patch/gnulib-tests: test-c-stack2.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-c-stack.c
< Only in diffutils-3.0-patch/gnulib-tests: test-c-stack.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-c-strcasecmp.c
< Only in diffutils-3.0-patch/gnulib-tests: test-c-strcase.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-c-strncasecmp.c
< Only in diffutils-3.0-patch/gnulib-tests: test-dirname.c
< Only in diffutils-3.0-patch/gnulib-tests: test-dup2.c
< Only in diffutils-3.0-patch/gnulib-tests: test-environ.c
< Only in diffutils-3.0-patch/gnulib-tests: test-errno.c
< Only in diffutils-3.0-patch/gnulib-tests: test-exclude1.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-exclude2.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-exclude3.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-exclude4.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-exclude5.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-exclude6.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-exclude7.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-exclude.c
< Only in diffutils-3.0-patch/gnulib-tests: test-fcntl.c
< Only in diffutils-3.0-patch/gnulib-tests: test-fcntl-h.c
< Only in diffutils-3.0-patch/gnulib-tests: test-fnmatch.c
< Only in diffutils-3.0-patch/gnulib-tests: test-freopen.c
< Only in diffutils-3.0-patch/gnulib-tests: test-freopen-safer.c
< Only in diffutils-3.0-patch/gnulib-tests: test-getdtablesize.c
< Only in diffutils-3.0-patch/gnulib-tests: test-getopt.c
< Only in diffutils-3.0-patch/gnulib-tests: test-getopt.h
< Only in diffutils-3.0-patch/gnulib-tests: test-getopt_long.h
< Only in diffutils-3.0-patch/gnulib-tests: test-gettimeofday.c
< Only in diffutils-3.0-patch/gnulib-tests: test-hash.c
< Only in diffutils-3.0-patch/gnulib-tests: test-iconv.c
< Only in diffutils-3.0-patch/gnulib-tests: test-iconv-h.c
< Only in diffutils-3.0-patch/gnulib-tests: test-inttypes.c
< Only in diffutils-3.0-patch/gnulib-tests: test-langinfo.c
< Only in diffutils-3.0-patch/gnulib-tests: test-lstat.c
< Only in diffutils-3.0-patch/gnulib-tests: test-lstat.h
< Only in diffutils-3.0-patch/gnulib-tests: test-malloca.c
< Only in diffutils-3.0-patch/gnulib-tests: test-mbrtowc1.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-mbrtowc2.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-mbrtowc3.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-mbrtowc4.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-mbrtowc.c
< Only in diffutils-3.0-patch/gnulib-tests: test-mbscasecmp.c
< Only in diffutils-3.0-patch/gnulib-tests: test-mbscasecmp.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-mbsinit.c
< Only in diffutils-3.0-patch/gnulib-tests: test-mbsinit.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-mbsrtowcs1.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-mbsrtowcs2.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-mbsrtowcs3.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-mbsrtowcs4.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-mbsrtowcs.c
< Only in diffutils-3.0-patch/gnulib-tests: test-mbsstr1.c
< Only in diffutils-3.0-patch/gnulib-tests: test-mbsstr2.c
< Only in diffutils-3.0-patch/gnulib-tests: test-mbsstr2.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-mbsstr3.c
< Only in diffutils-3.0-patch/gnulib-tests: test-mbsstr3.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-memchr.c
< Only in diffutils-3.0-patch/gnulib-tests: test-nl_langinfo.c
< Only in diffutils-3.0-patch/gnulib-tests: test-nl_langinfo.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-open.c
< Only in diffutils-3.0-patch/gnulib-tests: test-open.h
< Only in diffutils-3.0-patch/gnulib-tests: test-quotearg.c
< Only in diffutils-3.0-patch/gnulib-tests: test-quotearg.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-setenv.c
< Only in diffutils-3.0-patch/gnulib-tests: test-sigaction.c
< Only in diffutils-3.0-patch/gnulib-tests: test-signal.c
< Only in diffutils-3.0-patch/gnulib-tests: test-sleep.c
< Only in diffutils-3.0-patch/gnulib-tests: test-stat.c
< Only in diffutils-3.0-patch/gnulib-tests: test-stat.h
< Only in diffutils-3.0-patch/gnulib-tests: test-stat-time.c
< Only in diffutils-3.0-patch/gnulib-tests: test-stdbool.c
< Only in diffutils-3.0-patch/gnulib-tests: test-stddef.c
< Only in diffutils-3.0-patch/gnulib-tests: test-stdint.c
< Only in diffutils-3.0-patch/gnulib-tests: test-stdio.c
< Only in diffutils-3.0-patch/gnulib-tests: test-stdlib.c
< Only in diffutils-3.0-patch/gnulib-tests: test-strerror.c
< Only in diffutils-3.0-patch/gnulib-tests: test-striconv.c
< Only in diffutils-3.0-patch/gnulib-tests: test-string.c
< Only in diffutils-3.0-patch/gnulib-tests: test-strings.c
< Only in diffutils-3.0-patch/gnulib-tests: test-symlink.c
< Only in diffutils-3.0-patch/gnulib-tests: test-symlink.h
< Only in diffutils-3.0-patch/gnulib-tests: test-sys_stat.c
< Only in diffutils-3.0-patch/gnulib-tests: test-sys_time.c
< Only in diffutils-3.0-patch/gnulib-tests: test-sys_wait.c
< Only in diffutils-3.0-patch/gnulib-tests: test-time.c
< Only in diffutils-3.0-patch/gnulib-tests: test-unistd.c
< Only in diffutils-3.0-patch/gnulib-tests: test-unsetenv.c
< Only in diffutils-3.0-patch/gnulib-tests: test-update-copyright.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-usleep.c
< Only in diffutils-3.0-patch/gnulib-tests: test-vc-list-files-cvs.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-vc-list-files-git.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-version-etc.c
< Only in diffutils-3.0-patch/gnulib-tests: test-version-etc.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-wchar.c
< Only in diffutils-3.0-patch/gnulib-tests: test-wcrtomb.c
< Only in diffutils-3.0-patch/gnulib-tests: test-wcrtomb.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-wctype.c
< Only in diffutils-3.0-patch/gnulib-tests: test-wcwidth.c
< Only in diffutils-3.0-patch/gnulib-tests: test-xalloc-die.c
< Only in diffutils-3.0-patch/gnulib-tests: test-xalloc-die.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-xstrtol.c
< Only in diffutils-3.0-patch/gnulib-tests: test-xstrtol.sh
< Only in diffutils-3.0-patch/gnulib-tests: test-xstrtoul.c
< Only in diffutils-3.0-patch/gnulib-tests: test-xstrtoumax.c
< Only in diffutils-3.0-patch/gnulib-tests: test-xstrtoumax.sh
< Only in diffutils-3.0-patch/gnulib-tests: uniwidth
< Only in diffutils-3.0-patch/gnulib-tests: unsetenv.c
< Only in diffutils-3.0-patch/gnulib-tests: usleep.c
< Only in diffutils-3.0-patch/gnulib-tests: warn-on-use.h
< Only in diffutils-3.0-patch/gnulib-tests: wctob.c
< Only in diffutils-3.0-patch/gnulib-tests: zerosize-ptr.h
< Only in diffutils-3.0-patch: GNUmakefile
< Only in diffutils-3.0: HACKING
< Only in diffutils-3.0-patch: INSTALL
< Only in diffutils-3.0-patch/lib: alloca.c
< Only in diffutils-3.0-patch/lib: alloca.h
< Only in diffutils-3.0-patch/lib: alloca.in.h
< Only in diffutils-3.0-patch/lib: arg-nonnull.h
< Only in diffutils-3.0-patch/lib: basename.c
< Only in diffutils-3.0-patch/lib: basename-lgpl.c
< Only in diffutils-3.0-patch/lib: basename-lgpl.o
< Only in diffutils-3.0-patch/lib: basename.o
< Only in diffutils-3.0-patch/lib: bitrotate.h
< Only in diffutils-3.0-patch/lib: btowc.c
< Only in diffutils-3.0-patch/lib: c-ctype.c
< Only in diffutils-3.0-patch/lib: c-ctype.h
< Only in diffutils-3.0-patch/lib: c-ctype.o
< Only in diffutils-3.0-patch/lib: c++defs.h
< Only in diffutils-3.0-patch/lib: charset.alias
< diff -pru diffutils-3.0/lib/cmpbuf.c diffutils-3.0-patch/lib/cmpbuf.c
< --- diffutils-3.0/lib/cmpbuf.c	2020-03-01 22:03:00.379720000 -0800
< +++ diffutils-3.0-patch/lib/cmpbuf.c	2020-03-01 14:52:55.545196000 -0800
< @@ -1,7 +1,7 @@
<  /* Buffer primitives for comparison operations.
<  
< -   Copyright (C) 1993, 1995, 1998, 2001-2002, 2006, 2009-2013, 2015-2017 Free
< -   Software Foundation, Inc.
< +   Copyright (C) 1993, 1995, 1998, 2001-2002, 2006, 2009-2010 Free Software
< +   Foundation, Inc.
<  
<     This program is free software: you can redistribute it and/or modify
<     it under the terms of the GNU General Public License as published by
< @@ -20,14 +20,28 @@
<  
<  #include <errno.h>
<  #include <limits.h>
< +
<  #include <signal.h>
< +#ifndef SA_RESTART
< +# ifdef SA_INTERRUPT /* e.g. SunOS 4.1.x */
< +#  define SA_RESTART SA_INTERRUPT
< +# else
< +#  define SA_RESTART 0
< +# endif
< +#endif
< +
<  #include <unistd.h>
< -#include <stdint.h>
<  #include <inttypes.h>
<  #include <sys/types.h>
<  #include "cmpbuf.h"
<  #include "intprops.h"
<  
< +#ifndef PTRDIFF_MAX
< +# define PTRDIFF_MAX TYPE_MAXIMUM (ptrdiff_t)
< +#endif
< +#ifndef SIZE_MAX
< +# define SIZE_MAX TYPE_MAXIMUM (size_t)
< +#endif
<  #ifndef SSIZE_MAX
<  # define SSIZE_MAX TYPE_MAXIMUM (ssize_t)
<  #endif
< diff -pru diffutils-3.0/lib/cmpbuf.h diffutils-3.0-patch/lib/cmpbuf.h
< --- diffutils-3.0/lib/cmpbuf.h	2020-03-01 22:03:00.380722000 -0800
< +++ diffutils-3.0-patch/lib/cmpbuf.h	2020-03-01 14:52:55.547197000 -0800
< @@ -1,6 +1,6 @@
<  /* Buffer primitives for comparison operations.
<  
< -   Copyright (C) 2002, 2009-2013, 2015-2017 Free Software Foundation, Inc.
< +   Copyright (C) 2002, 2009-2010 Free Software Foundation, Inc.
<  
<     This program is free software: you can redistribute it and/or modify
<     it under the terms of the GNU General Public License as published by
< @@ -16,4 +16,4 @@
<     along with this program.  If not, see <http://www.gnu.org/licenses/>.  */
<  
<  size_t block_read (int, char *, size_t);
< -size_t buffer_lcm (size_t, size_t, size_t) _GL_ATTRIBUTE_CONST;
< +size_t buffer_lcm (size_t, size_t, size_t);
< Only in diffutils-3.0-patch/lib: cmpbuf.o
< Only in diffutils-3.0-patch/lib: config.charset
< Only in diffutils-3.0-patch/lib: config.h
< Only in diffutils-3.0-patch/lib: config.hin
< Only in diffutils-3.0-patch/lib: configmake.h
< Only in diffutils-3.0-patch/lib: c-stack.c
< Only in diffutils-3.0-patch/lib: c-stack.h
< Only in diffutils-3.0-patch/lib: c-stack.o
< Only in diffutils-3.0-patch/lib: c-strcasecmp.c
< Only in diffutils-3.0-patch/lib: c-strcasecmp.o
< Only in diffutils-3.0-patch/lib: c-strcase.h
< Only in diffutils-3.0-patch/lib: c-strncasecmp.c
< Only in diffutils-3.0-patch/lib: c-strncasecmp.o
< Only in diffutils-3.0-patch/lib: .deps
< Only in diffutils-3.0-patch/lib: diffseq.h
< Only in diffutils-3.0-patch/lib: dirname.c
< Only in diffutils-3.0-patch/lib: dirname.h
< Only in diffutils-3.0-patch/lib: dirname-lgpl.c
< Only in diffutils-3.0-patch/lib: dirname-lgpl.o
< Only in diffutils-3.0-patch/lib: dirname.o
< Only in diffutils-3.0-patch/lib: dup2.c
< Only in diffutils-3.0-patch/lib: errno.in.h
< Only in diffutils-3.0-patch/lib: error.c
< Only in diffutils-3.0-patch/lib: error.h
< Only in diffutils-3.0-patch/lib: exclude.c
< Only in diffutils-3.0-patch/lib: exclude.h
< Only in diffutils-3.0-patch/lib: exclude.o
< Only in diffutils-3.0-patch/lib: exitfail.c
< Only in diffutils-3.0-patch/lib: exitfail.h
< Only in diffutils-3.0-patch/lib: exitfail.o
< Only in diffutils-3.0-patch/lib: fcntl.c
< Only in diffutils-3.0-patch/lib: fcntl.h
< Only in diffutils-3.0-patch/lib: fcntl.in.h
< Only in diffutils-3.0-patch/lib: fcntl.o
< Only in diffutils-3.0-patch/lib: file-type.c
< Only in diffutils-3.0-patch/lib: file-type.h
< Only in diffutils-3.0-patch/lib: file-type.o
< Only in diffutils-3.0-patch/lib: fnmatch.c
< Only in diffutils-3.0-patch/lib: fnmatch.in.h
< Only in diffutils-3.0-patch/lib: fnmatch_loop.c
< Only in diffutils-3.0-patch/lib: freopen.c
< Only in diffutils-3.0-patch/lib: freopen-safer.c
< Only in diffutils-3.0-patch/lib: freopen-safer.o
< Only in diffutils-3.0-patch/lib: getdtablesize.c
< Only in diffutils-3.0-patch/lib: getopt1.c
< Only in diffutils-3.0-patch/lib: getopt.c
< Only in diffutils-3.0-patch/lib: getopt.in.h
< Only in diffutils-3.0-patch/lib: getopt_int.h
< Only in diffutils-3.0-patch/lib: gettext.h
< Only in diffutils-3.0-patch/lib: gettime.c
< Only in diffutils-3.0-patch/lib: gettime.o
< Only in diffutils-3.0-patch/lib: gettimeofday.c
< Only in diffutils-3.0-patch/lib: .gitignore
< Only in diffutils-3.0-patch/lib: gnulib.mk
< Only in diffutils-3.0-patch/lib: hard-locale.c
< Only in diffutils-3.0-patch/lib: hard-locale.h
< Only in diffutils-3.0-patch/lib: hard-locale.o
< Only in diffutils-3.0-patch/lib: hash.c
< Only in diffutils-3.0-patch/lib: hash.h
< Only in diffutils-3.0-patch/lib: hash.o
< Only in diffutils-3.0-patch/lib: iconv.h
< Only in diffutils-3.0-patch/lib: iconv.in.h
< Only in diffutils-3.0-patch/lib: iconv_open-aix.gperf
< Only in diffutils-3.0-patch/lib: iconv_open-aix.h
< Only in diffutils-3.0-patch/lib: iconv_open.c
< Only in diffutils-3.0-patch/lib: iconv_open-hpux.gperf
< Only in diffutils-3.0-patch/lib: iconv_open-hpux.h
< Only in diffutils-3.0-patch/lib: iconv_open-irix.gperf
< Only in diffutils-3.0-patch/lib: iconv_open-irix.h
< Only in diffutils-3.0-patch/lib: iconv_open-osf.gperf
< Only in diffutils-3.0-patch/lib: iconv_open-osf.h
< Only in diffutils-3.0-patch/lib: iconv_open-solaris.gperf
< Only in diffutils-3.0-patch/lib: iconv_open-solaris.h
< Only in diffutils-3.0-patch/lib: ignore-value.h
< Only in diffutils-3.0-patch/lib: imaxtostr.c
< Only in diffutils-3.0-patch/lib: imaxtostr.o
< Only in diffutils-3.0-patch/lib: intprops.h
< Only in diffutils-3.0-patch/lib: inttostr.c
< Only in diffutils-3.0-patch/lib: inttostr.h
< Only in diffutils-3.0-patch/lib: inttypes.h
< Only in diffutils-3.0-patch/lib: inttypes.in.h
< Only in diffutils-3.0-patch/lib: langinfo.h
< Only in diffutils-3.0-patch/lib: langinfo.in.h
< Only in diffutils-3.0-patch/lib: libdiffutils.a
< Only in diffutils-3.0-patch/lib: localcharset.c
< Only in diffutils-3.0-patch/lib: localcharset.h
< Only in diffutils-3.0-patch/lib: localcharset.o
< Only in diffutils-3.0-patch/lib: lstat.c
< Only in diffutils-3.0-patch/lib: Makefile
< diff -pru diffutils-3.0/lib/Makefile.am diffutils-3.0-patch/lib/Makefile.am
< --- diffutils-3.0/lib/Makefile.am	2020-03-01 22:03:00.378720000 -0800
< +++ diffutils-3.0-patch/lib/Makefile.am	2020-03-01 14:52:55.544196000 -0800
< @@ -1,7 +1,6 @@
<  # Automakefile for GNU Diffutils library.
<  
< -# Copyright (C) 2001-2002, 2004, 2006, 2009-2013, 2015-2017 Free Software
< -# Foundation, Inc.
< +# Copyright (C) 2001-2002, 2004, 2006, 2009-2010 Free Software Foundation, Inc.
<  
<  # This program is free software: you can redistribute it and/or modify
<  # it under the terms of the GNU General Public License as published by
< @@ -16,17 +15,6 @@
<  # You should have received a copy of the GNU General Public License
<  # along with this program.  If not, see <http://www.gnu.org/licenses/>.
<  
< -AM_CFLAGS =
< -BUILT_SOURCES =
< -CLEANFILES =
< -EXTRA_DIST =
< -MOSTLYCLEANDIRS =
< -MOSTLYCLEANFILES =
< -MAINTAINERCLEANFILES =
< -SUFFIXES =
< -noinst_LIBRARIES =
< -noinst_HEADERS =
< -
<  include gnulib.mk
<  
<  noinst_HEADERS += cmpbuf.h prepargs.h
< Only in diffutils-3.0-patch/lib: Makefile.in
< Only in diffutils-3.0-patch/lib: malloca.c
< Only in diffutils-3.0-patch/lib: malloca.h
< Only in diffutils-3.0-patch/lib: malloca.o
< Only in diffutils-3.0-patch/lib: malloca.valgrind
< Only in diffutils-3.0-patch/lib: malloc.c
< Only in diffutils-3.0-patch/lib: mbchar.c
< Only in diffutils-3.0-patch/lib: mbchar.h
< Only in diffutils-3.0-patch/lib: mbchar.o
< Only in diffutils-3.0-patch/lib: mbiter.h
< Only in diffutils-3.0-patch/lib: mbrlen.c
< Only in diffutils-3.0-patch/lib: mbrtowc.c
< Only in diffutils-3.0-patch/lib: mbscasecmp.c
< Only in diffutils-3.0-patch/lib: mbscasecmp.o
< Only in diffutils-3.0-patch/lib: mbsinit.c
< Only in diffutils-3.0-patch/lib: mbslen.c
< Only in diffutils-3.0-patch/lib: mbslen.o
< Only in diffutils-3.0-patch/lib: mbsrtowcs.c
< Only in diffutils-3.0-patch/lib: mbsrtowcs-state.c
< Only in diffutils-3.0-patch/lib: mbsstr.c
< Only in diffutils-3.0-patch/lib: mbsstr.o
< Only in diffutils-3.0-patch/lib: mbuiter.h
< Only in diffutils-3.0-patch/lib: memchr.c
< Only in diffutils-3.0-patch/lib: memchr.valgrind
< Only in diffutils-3.0-patch/lib: mkstemp.c
< Only in diffutils-3.0-patch/lib: mktime.c
< Only in diffutils-3.0-patch/lib: mktime-internal.h
< Only in diffutils-3.0-patch/lib: nl_langinfo.c
< Only in diffutils-3.0-patch/lib: offtostr.c
< Only in diffutils-3.0-patch/lib: offtostr.o
< Only in diffutils-3.0-patch/lib: open.c
< diff -pru diffutils-3.0/lib/prepargs.c diffutils-3.0-patch/lib/prepargs.c
< --- diffutils-3.0/lib/prepargs.c	2020-03-01 22:03:00.381722000 -0800
< +++ diffutils-3.0-patch/lib/prepargs.c	2020-03-01 14:52:55.548197000 -0800
< @@ -1,7 +1,6 @@
<  /* Parse arguments from a string and prepend them to an argv.
<  
< -   Copyright (C) 1999-2002, 2006, 2009-2013, 2015-2017 Free Software
< -   Foundation, Inc.
< +   Copyright (C) 1999-2002, 2006, 2009-2010 Free Software Foundation, Inc.
<  
<     This program is free software: you can redistribute it and/or modify
<     it under the terms of the GNU General Public License as published by
< Only in diffutils-3.0-patch/lib: prepargs.o
< Only in diffutils-3.0-patch/lib: progname.c
< Only in diffutils-3.0-patch/lib: progname.h
< Only in diffutils-3.0-patch/lib: progname.o
< Only in diffutils-3.0-patch/lib: propername.c
< Only in diffutils-3.0-patch/lib: propername.h
< Only in diffutils-3.0-patch/lib: propername.o
< Only in diffutils-3.0-patch/lib: quotearg.c
< Only in diffutils-3.0-patch/lib: quotearg.h
< Only in diffutils-3.0-patch/lib: quotearg.o
< Only in diffutils-3.0-patch/lib: quote.c
< Only in diffutils-3.0-patch/lib: quote.h
< Only in diffutils-3.0-patch/lib: quote.o
< Only in diffutils-3.0-patch/lib: ref-add.sed
< Only in diffutils-3.0-patch/lib: ref-add.sin
< Only in diffutils-3.0-patch/lib: ref-del.sed
< Only in diffutils-3.0-patch/lib: ref-del.sin
< Only in diffutils-3.0-patch/lib: regcomp.c
< Only in diffutils-3.0-patch/lib: regex.c
< Only in diffutils-3.0-patch/lib: regexec.c
< Only in diffutils-3.0-patch/lib: regex.h
< Only in diffutils-3.0-patch/lib: regex_internal.c
< Only in diffutils-3.0-patch/lib: regex_internal.h
< Only in diffutils-3.0-patch/lib: regex.o
< Only in diffutils-3.0-patch/lib: sh-quote.c
< Only in diffutils-3.0-patch/lib: sh-quote.h
< Only in diffutils-3.0-patch/lib: sh-quote.o
< Only in diffutils-3.0-patch/lib: sigaction.c
< Only in diffutils-3.0-patch/lib: sig-handler.h
< Only in diffutils-3.0-patch/lib: signal.h
< Only in diffutils-3.0-patch/lib: signal.in.h
< Only in diffutils-3.0-patch/lib: sigprocmask.c
< Only in diffutils-3.0-patch/lib: stamp-h1
< Only in diffutils-3.0-patch/lib: stat.c
< Only in diffutils-3.0-patch/lib: stat-macros.h
< Only in diffutils-3.0-patch/lib: stat-time.h
< Only in diffutils-3.0-patch/lib: stdarg.in.h
< Only in diffutils-3.0-patch/lib: stdbool.in.h
< Only in diffutils-3.0-patch/lib: stddef.in.h
< Only in diffutils-3.0-patch/lib: stdint.in.h
< Only in diffutils-3.0-patch/lib: stdio--.h
< Only in diffutils-3.0-patch/lib: stdio.h
< Only in diffutils-3.0-patch/lib: stdio.in.h
< Only in diffutils-3.0-patch/lib: stdio-safer.h
< Only in diffutils-3.0-patch/lib: stdio-write.c
< Only in diffutils-3.0-patch/lib: stdlib.h
< Only in diffutils-3.0-patch/lib: stdlib.in.h
< Only in diffutils-3.0-patch/lib: strcasecmp.c
< Only in diffutils-3.0-patch/lib: streq.h
< Only in diffutils-3.0-patch/lib: strerror.c
< Only in diffutils-3.0-patch/lib: strftime.c
< Only in diffutils-3.0-patch/lib: strftime.h
< Only in diffutils-3.0-patch/lib: strftime.o
< Only in diffutils-3.0-patch/lib: striconv.c
< Only in diffutils-3.0-patch/lib: striconv.h
< Only in diffutils-3.0-patch/lib: striconv.o
< Only in diffutils-3.0-patch/lib: string.h
< Only in diffutils-3.0-patch/lib: string.in.h
< Only in diffutils-3.0-patch/lib: strings.h
< Only in diffutils-3.0-patch/lib: strings.in.h
< Only in diffutils-3.0-patch/lib: stripslash.c
< Only in diffutils-3.0-patch/lib: stripslash.o
< Only in diffutils-3.0-patch/lib: str-kmp.h
< Only in diffutils-3.0-patch/lib: strncasecmp.c
< Only in diffutils-3.0-patch/lib: strndup.c
< Only in diffutils-3.0-patch/lib: strnlen1.c
< Only in diffutils-3.0-patch/lib: strnlen1.h
< Only in diffutils-3.0-patch/lib: strnlen1.o
< Only in diffutils-3.0-patch/lib: strnlen.c
< Only in diffutils-3.0-patch/lib: strptime.c
< Only in diffutils-3.0-patch/lib: strtoimax.c
< Only in diffutils-3.0-patch/lib: strtol.c
< Only in diffutils-3.0-patch/lib: strtoll.c
< Only in diffutils-3.0-patch/lib: strtoul.c
< Only in diffutils-3.0-patch/lib: strtoull.c
< Only in diffutils-3.0-patch/lib: strtoumax.c
< Only in diffutils-3.0-patch/lib: sys
< Only in diffutils-3.0-patch/lib: sys_stat.in.h
< Only in diffutils-3.0-patch/lib: sys_time.in.h
< Only in diffutils-3.0-patch/lib: sys_wait.in.h
< Only in diffutils-3.0-patch/lib: tempname.c
< Only in diffutils-3.0-patch/lib: tempname.h
< Only in diffutils-3.0-patch/lib: tempname.o
< Only in diffutils-3.0-patch/lib: timegm.c
< Only in diffutils-3.0-patch/lib: time.h
< Only in diffutils-3.0-patch/lib: time.in.h
< Only in diffutils-3.0-patch/lib: time_r.c
< Only in diffutils-3.0-patch/lib: timespec.h
< Only in diffutils-3.0-patch/lib: trim.c
< Only in diffutils-3.0-patch/lib: trim.h
< Only in diffutils-3.0-patch/lib: trim.o
< Only in diffutils-3.0-patch/lib: uinttostr.c
< Only in diffutils-3.0-patch/lib: uinttostr.o
< Only in diffutils-3.0-patch/lib: umaxtostr.c
< Only in diffutils-3.0-patch/lib: umaxtostr.o
< Only in diffutils-3.0-patch/lib: unistd.h
< Only in diffutils-3.0-patch/lib: unistd.in.h
< Only in diffutils-3.0-patch/lib: unitypes.h
< Only in diffutils-3.0-patch/lib: uniwidth
< Only in diffutils-3.0-patch/lib: uniwidth.h
< Only in diffutils-3.0-patch/lib: unlocked-io.h
< Only in diffutils-3.0-patch/lib: verify.h
< Only in diffutils-3.0-patch/lib: version-etc.c
< Only in diffutils-3.0-patch/lib: version-etc-fsf.c
< Only in diffutils-3.0-patch/lib: version-etc-fsf.o
< Only in diffutils-3.0-patch/lib: version-etc.h
< Only in diffutils-3.0-patch/lib: version-etc.o
< Only in diffutils-3.0-patch/lib: warn-on-use.h
< Only in diffutils-3.0-patch/lib: wchar.h
< Only in diffutils-3.0-patch/lib: wchar.in.h
< Only in diffutils-3.0-patch/lib: wcrtomb.c
< Only in diffutils-3.0-patch/lib: wctype.h
< Only in diffutils-3.0-patch/lib: wctype.in.h
< Only in diffutils-3.0-patch/lib: wcwidth.c
< Only in diffutils-3.0-patch/lib: xalloc-die.c
< Only in diffutils-3.0-patch/lib: xalloc-die.o
< Only in diffutils-3.0-patch/lib: xalloc.h
< Only in diffutils-3.0-patch/lib: xfreopen.c
< Only in diffutils-3.0-patch/lib: xfreopen.h
< Only in diffutils-3.0-patch/lib: xfreopen.o
< Only in diffutils-3.0-patch/lib: xmalloc.c
< Only in diffutils-3.0-patch/lib: xmalloc.o
< Only in diffutils-3.0-patch/lib: xstriconv.c
< Only in diffutils-3.0-patch/lib: xstriconv.h
< Only in diffutils-3.0-patch/lib: xstriconv.o
< Only in diffutils-3.0-patch/lib: xstrndup.c
< Only in diffutils-3.0-patch/lib: xstrndup.h
< Only in diffutils-3.0-patch/lib: xstrndup.o
< Only in diffutils-3.0-patch/lib: xstrtol.c
< Only in diffutils-3.0-patch/lib: xstrtol-error.c
< Only in diffutils-3.0-patch/lib: xstrtol-error.o
< Only in diffutils-3.0-patch/lib: xstrtol.h
< Only in diffutils-3.0-patch/lib: xstrtol.o
< Only in diffutils-3.0-patch/lib: xstrtoul.c
< Only in diffutils-3.0-patch/lib: xstrtoul.o
< Only in diffutils-3.0-patch/lib: xstrtoumax.c
< Only in diffutils-3.0-patch/lib: xstrtoumax.o
< Only in diffutils-3.0-patch: m4
< Only in diffutils-3.0-patch: maint.mk
< Only in diffutils-3.0-patch: Makefile
< diff -pru diffutils-3.0/Makefile.am diffutils-3.0-patch/Makefile.am
< --- diffutils-3.0/Makefile.am	2020-03-01 22:03:00.304714000 -0800
< +++ diffutils-3.0-patch/Makefile.am	2020-03-01 14:52:55.436188000 -0800
< @@ -1,7 +1,6 @@
<  # Main Automakefile for GNU diffutils.
<  
< -# Copyright (C) 2001-2002, 2004, 2006, 2009-2013, 2015-2017 Free Software
< -# Foundation, Inc.
< +# Copyright (C) 2001-2002, 2004, 2006, 2009-2010 Free Software Foundation, Inc.
<  
<  # This program is free software: you can redistribute it and/or modify
<  # it under the terms of the GNU General Public License as published by
< @@ -19,7 +18,7 @@
<  ALL_RECURSIVE_TARGETS =
<  
<  EXTRA_DIST = bootstrap exgettext ChangeLog-2008 cfg.mk dist-check.mk
< -SUBDIRS = lib src tests doc man po gnulib-tests
< +SUBDIRS = lib src tests doc man po ms gnulib-tests
<  
<  ACLOCAL_AMFLAGS = -I m4
<  AM_CFLAGS = $(WARN_CFLAGS) $(WERROR_CFLAGS)
< @@ -34,25 +33,11 @@ gen_start_date = '2009-11-11 15:00'
<  gen-ChangeLog:
<  	$(AM_V_GEN)if test -d .git; then				\
<  	  $(top_srcdir)/build-aux/gitlog-to-changelog			\
< -	    --since=$(gen_start_date) > $(distdir)/cl-t &&		\
< -	    { rm -f $(distdir)/ChangeLog &&				\
< -	      mv $(distdir)/cl-t $(distdir)/ChangeLog; }		\
< +	    --since=$(gen_start_date) > $(distdir)/cl-t;		\
< +	  rm -f $(distdir)/ChangeLog;					\
< +	  mv $(distdir)/cl-t $(distdir)/ChangeLog;			\
<  	fi
<  
<  ALL_RECURSIVE_TARGETS += distcheck-hook
<  distcheck-hook:
<  	$(MAKE) my-distcheck
< -
< -# Some of our git hook scripts are supposed to be identical to git's samples.
< -# See if they are still in sync.
< -.PHONY: check-git-hook-script-sync
< -check-git-hook-script-sync:
< -	@fail=0;							\
< -	t=$$(mktemp -d)							\
< -	  && cd $$t && git init -q && cd .git/hooks			\
< -	  && for i in pre-commit pre-applypatch applypatch-msg; do	\
< -	       diff -u $(abs_top_srcdir)/scripts/git-hooks/$$i $$i.sample	\
< -		 || fail=1;						\
< -	     done;							\
< -	rm -rf $$t;							\
< -	test $$fail = 0
< Only in diffutils-3.0-patch: Makefile.in
< Only in diffutils-3.0-patch/man: cmp.1
< Only in diffutils-3.0/man: cmp.x
< Only in diffutils-3.0-patch/man: diff.1
< Only in diffutils-3.0-patch/man: diff3.1
< Only in diffutils-3.0/man: diff3.x
< Only in diffutils-3.0/man: diff.x
< Only in diffutils-3.0/man: help2man
< Only in diffutils-3.0-patch/man: Makefile
< diff -pru diffutils-3.0/man/Makefile.am diffutils-3.0-patch/man/Makefile.am
< --- diffutils-3.0/man/Makefile.am	2020-03-01 22:03:00.384721000 -0800
< +++ diffutils-3.0-patch/man/Makefile.am	2020-03-01 14:52:55.552197000 -0800
< @@ -1,6 +1,6 @@
<  # Automakefile for GNU diffutils man pages
<  
< -# Copyright (C) 2002, 2009-2013, 2015-2017 Free Software Foundation, Inc.
< +# Copyright (C) 2002, 2009-2010 Free Software Foundation, Inc.
<  
<  # This program is free software: you can redistribute it and/or modify
<  # it under the terms of the GNU General Public License as published by
< @@ -16,24 +16,17 @@
<  # along with this program.  If not, see <http://www.gnu.org/licenses/>.
<  
<  dist_man1_MANS = cmp.1 diff.1 diff3.1 sdiff.1
< -EXTRA_DIST = $(dist_man1_MANS:%.1=%.x) help2man
<  MAINTAINERCLEANFILES = $(dist_man1_MANS)
<  
<  S = $(top_srcdir)/src
< -cmp.1: $S/cmp.c cmp.x
< -diff.1: $S/diff.c diff.x
< -diff3.1: $S/diff3.c diff3.x
< -sdiff.1: $S/sdiff.c sdiff.x
< -
< -# Directory in which just-built programs reside.  It is used
< -# to ensure help2man invokes them via the use of PATH below.
< -bin_dir = ../src
< -
< -# Depend on the former to get version number changes.
< -$(dist_man1_MANS): $(SRC_VERSION_C) help2man
< -	$(AM_V_GEN)base=`expr $@ : '\(.*\).1'`				\
< -	  && test -x $(bin_dir)/$$base					\
< -	  && (echo '[NAME]' && sed 's@/\* *@@; s/-/\\-/; q' $S/$$base.c) \
< -	     | PATH="$(bin_dir)$(PATH_SEPARATOR)$$PATH"			\
< -	       $(srcdir)/help2man -i - -i $(srcdir)/$$base.x		\
< -		 -S '$(PACKAGE) $(VERSION)' $$base > $@-t && mv $@-t $@
< +cmp.1: $S/cmp.c
< +diff.1: $S/diff.c
< +diff3.1: $S/diff3.c
< +sdiff.1: $S/sdiff.c
< +
< +# Depend on configure.ac to get version number changes.
< +$(dist_man1_MANS): $(top_srcdir)/configure.ac
< +	$(AM_V_GEN)base=`expr $@ : '\(.*\).1'` && \
< +	  (echo '[NAME]' && sed 's@/\* *@@; s/-/\\-/; q' $S/$$base.c) | \
< +	  $(HELP2MAN) -i - -S '$(PACKAGE) $(VERSION)' ../src/$$base | \
< +	  sed 's/^\.B info .*/.B info diff/' >$@
< Only in diffutils-3.0-patch/man: Makefile.in
< Only in diffutils-3.0-patch/man: sdiff.1
< Only in diffutils-3.0/man: sdiff.x
< Only in diffutils-3.0-patch: ms
< diff -pru diffutils-3.0/NEWS diffutils-3.0-patch/NEWS
< --- diffutils-3.0/NEWS	2020-03-01 22:03:00.305714000 -0800
< +++ diffutils-3.0-patch/NEWS	2020-03-01 14:56:04.338521000 -0800
< @@ -1,131 +1,5 @@
<  GNU diffutils NEWS                                    -*- outline -*-
<  
< -* Noteworthy changes in release ?.? (????-??-??) [?]
< -
< -
< -* Noteworthy changes in release 3.6 (2017-05-21) [stable]
< -
< -** New features
< -
< -  When one file is a prefix of the other, cmp now appends the shorter
< -  file's size to the EOF diagnostic.
< -
< -** Bug fixes
< -
< -  Using an invalid regular expression with --ignore-matching-lines=RE (-I)
< -  no longer causes stack overflow.  Before, with an invocation like the
< -  following, diff would diagnose the error, but would still proceed to
< -  blow the stack: diff -Ia -I\\ <(echo) <(echo b)
< -  [bug introduced in 2.9]
< -
< -  diff no longer mishandles line numbers exceeding 2**31 on Mingw-w64.
< -
< -  the ---presume-output-tty (ostensibly test-only) option would cause
< -  diff --color to read an uninitialized variable
< -  [bug introduced in 3.4]
< -
< -** Performance changes
< -
< -  diff's default algorithm has been tweaked to deal better with larger
< -  files, reversing some of the changes made in diffutils-3.4.
< -
< -
< -* Noteworthy changes in release 3.5 (2016-08-20) [stable]
< -
< -** Bug fixes
< -
< -  diff3 no longer malfunctions due to use-after-free
< -  [bug introduced in 3.4]
< -
< -  diff --color no longer colorizes when TERM=dumb
< -
< -
< -* Noteworthy changes in release 3.4 (2016-08-08) [stable]
< -
< -** New features
< -
< -   diff accepts two new options --color and --palette to generate
< -   and configure colored output.  --color takes an optional argument
< -   specifying when to colorize a line: --color=always, --color=auto,
< -   --color=never.  --palette is used to configure which colors are used.
< -
< -** Bug fixes
< -
< -  When binary files differ, diff now exits with status 1 as POSIX requires.
< -  Formerly it exited with status 2.
< -
< -  Unless the --ignore-file-name-case option is used, diff now
< -  considers file names to be equal only if they are byte-for-byte
< -  equivalent.  This fixes a bug where diff in an English locale might
< -  consider two Asian file names to be the same merely because they
< -  contain no English characters.
< -
< -  diff -B no longer generates incorrect output if the two inputs
< -  each end with a one-byte incomplete line.
< -
< -  diff --brief no longer reports a difference for unusual identical files.
< -  For example, when comparing a file like /proc/cmdline (for which the linux
< -  kernel reports st_size of 0 even though it is not an empty file) to a
< -  copy of that file's contents residing on a "normal" file system:
< -    $ f=/proc/cmdline; cp $f k; diff --brief $f k
< -    Files /proc/cmdline and k differ
< -
< -** Performance changes
< -
< -  diff's default algorithm has been adjusted to output higher-quality
< -  results at somewhat greater computational cost, as CPUs have gotten
< -  faster since the algorithm was last tweaked in diffutils-2.6 (1993).
< -
< -
< -* Noteworthy changes in release 3.3 (2013-03-24) [stable]
< -
< -** New features
< -
< -  diff accepts a new option, --no-dereference.  With this option, symbolic
< -  links are treated specially: as a separate type of file that can compare
< -  equal only to another symbolic link with the same value.  For example,
< -  with --no-dereference, two symbolic links compare equal when they have
< -  the same value, even when that value does not reference a readable file.
< -
< -  --new-file (-N) and --unidirectional-new-file now allow comparisons to "-".
< -  A standard input that's closed acts like a nonexistent file.
< -
< -  A file name containing spaces, double quotes, backslashes or control
< -  characters is now encoded in a diff header as a double-quoted C string
< -  literal.  The escape sequences \\, \", \a, \b, \f, \n, \r, \t, \v and
< -  \ooo (a three-digit octal number between 0 and 255) are used.
< -
< -** Packaging
< -
< -  diffutils is now designed to build with Cygwin or MinGW rather than DJGPP.
< -  The ms subdirectory has been removed.
< -
< -
< -* Noteworthy changes in release 3.2 (2011-09-02) [stable]
< -
< -** Changes in behavior
< -
< -  --ignore-file-name-case now applies at the top level too.
< -  For example, "diff dir inIt" might compare "dir/Init" to "inIt".
< -
< -** New features
< -
< -  diff and sdiff have a new option --ignore-trailing-space (-Z).
< -
< -** Packaging
< -
< -  The texinfo documentation no longer specifies "front-cover" or "back-cover"
< -  texts, so that it may now be included in Debian's "main" section.
< -
< -
< -* Noteworthy changes in release 3.1 (2011-08-10) [stable]
< -
< -** Bug fixes
< -
< -  diff no longer reports spurious differences merely because two entries
< -  in the same directory have names that compare equal in the current
< -  locale, or compare equal because --ignore-file-name-case was given.
< -
<  * Noteworthy changes in release 3.0 (2010-05-03) [stable]
<  
<  ** Bug fixes
< @@ -156,7 +30,7 @@ GNU diffutils NEWS
<  
<    New diff option --suppress-blank-empty.
<  
< -  Bring back support for 'diff -NUM', where NUM is a number,
< +  Bring back support for `diff -NUM', where NUM is a number,
<    even when conforming to POSIX 1003.1-2001.  This change reverts to
<    the behavior of GNU diff 2.7 and earlier.  This is a change only
<    when conforming to POSIX 1003.1-2001; there is no effect when
< @@ -192,11 +66,11 @@ User-visible changes in version 2.8.6:
<    that 'patch' creates to indicate nonexistent backups) are now
<    treated as nonexistent when they are in the 'backup' file position.
<  
< -* If multiple SKIP values are given to cmp, e.g., 'cmp -i 10 -i 20',
< +* If multiple SKIP values are given to cmp, e.g., `cmp -i 10 -i 20',
<    cmp now uses the maximal value instead of the last one.
<  
<  * diff now omits the ".000000000" on hosts that do not support
< -  fractional timestamps.
< +  fractional time stamps.
<  
<  Version 2.8.5 was not publicly released.
<  
< @@ -232,7 +106,7 @@ User-visible changes in version 2.8:
<  * cmp and diff now conform to POSIX 1003.1-2001 (IEEE Std 1003.1-2001)
<    if the underlying system conforms to POSIX and if the _POSIX2_VERSION
<    environment variable is set to 200112.  Conformance removes support
< -  for 'diff -NUM', where NUM is a number.  Use -C NUM or -U NUM instead.
< +  for `diff -NUM', where NUM is a number.  Use -C NUM or -U NUM instead.
<  * cmp now supports trailing operands SKIP1 and SKIP2, like BSD cmp.
<  * cmp -i or --ignore-initial now accepts SKIP1:SKIP2 option value.
<  * New cmp option: -n or --bytes.
< @@ -241,7 +115,7 @@ User-visible changes in version 2.8:
<  * cmp now outputs "byte" rather than "char" outside the POSIX locale.
<  * cmp -l's index column width now adjusts to fit larger (or smaller) files.
<  * cmp -l -s and cmp -s -l are not allowed.  Use cmp -s or cmp -l instead.
< -* diff uses ISO 8601 style timestamps for output times (e.g. "2001-11-23
< +* diff uses ISO 8601 style time stamps for output times (e.g. "2001-11-23
<    16:44:36.875702460 -0800") unless in the C or POSIX locale and the
<    -c style is specified.
<  * diff's -I and -F options use the regexp syntax of grep, not of Emacs.
< @@ -266,13 +140,13 @@ User-visible changes in version 2.8:
<    category if possible, instead of using native byte comparison.
<  * Recursive diffs now detect and report directory loops.
<  * Diff printf specs can now use the "0" and "'" flags.
< -* The new sdiff interactive command 'ed' precedes each version with a header.
< +* The new sdiff interactive command `ed' precedes each version with a header.
<  * On 64-bit hosts, files larger than 2 GB can be compared.
<  * Some internationalization support has been added, but multibyte locales
<    are still not completely supported yet.
<  * Some diagnostics have been reworded slightly for consistency.
< -  Also, 'diff -D FOO' now outputs '/* ! FOO */' instead of '/* not FOO */'.
< -* The 'patch' part of the manual now describes 'patch' version 2.5.4.
< +  Also, `diff -D FOO' now outputs `/* ! FOO */' instead of `/* not FOO */'.
< +* The `patch' part of the manual now describes `patch' version 2.5.4.
<  * Man pages are now distributed and installed.
<  * There is support for DJGPP; see the 'ms' subdirectory and the files
<    m4/dos.m4 and */setmode.*.
< @@ -310,7 +184,7 @@ User-visible changes in version 2.4:
<        A printf spec followed by one of the following letters
<        causes the integer corresponding to that letter to be
<        printed according to the printf specification.
< -      E.g. '%5df' prints the number of the first line in the
< +      E.g. `%5df' prints the number of the first line in the
<        group in the old file using the "%5d" format.
<  	e: line number just before the group in old file; equals f - 1
<  	f: first line number in group in the old file
< @@ -323,9 +197,9 @@ User-visible changes in version 2.4:
<        constant or a single letter interpreted as above.  T and E are
<        arbitrary format strings.  This format spec is equivalent to T if
<        A's value equals B's; otherwise it is equivalent to E.  For
< -      example, '%(N=0?no:%dN) line%(N=1?:s)' is equivalent to 'no lines'
< +      example, `%(N=0?no:%dN) line%(N=1?:s)' is equivalent to `no lines'
<        if N (the number of lines in the group in the new file) is 0,
< -      to '1 line' if N is 1, and to '%dN lines' otherwise.
< +      to `1 line' if N is 1, and to `%dN lines' otherwise.
<    %c'C'
<        where C is a single character, stands for the character C.  C may not
<        be a backslash or an apostrophe.  E.g. %c':' stands for a colon.
< @@ -335,7 +209,7 @@ User-visible changes in version 2.4:
<  * New diff line format specifications:
<    <PRINTF_SPEC>n
<        The line number, printed with <PRINTF_SPEC>.
< -      E.g. '%5dn' prints the line number with a "%5d" format.
< +      E.g. `%5dn' prints the line number with a "%5d" format.
<    %c'C'
<    %c'\O'
<        The character C, or with octal code O, as above.
< @@ -347,14 +221,14 @@ User-visible changes in version 2.4:
<  * cmp and diff now conform to POSIX 1003.2-1992 (ISO/IEC 9945-2:1993)
<    if the underlying system conforms to POSIX:
<    - Some messages' wordings are changed in minor ways.
< -  - "White space" is now whatever C's 'isspace' says it is.
< -  - When comparing directories, if 'diff' finds a file that is not a regular
< +  - ``White space'' is now whatever C's `isspace' says it is.
< +  - When comparing directories, if `diff' finds a file that is not a regular
<      file or a directory, it reports the file's type instead of diffing it.
<      (As usual, it follows symbolic links first.)
<    - When signaled, sdiff exits with the signal's status, not with status 2.
<  * Now portable to hosts where int, long, pointer, etc. are not all the same
<    size.
< -* 'cmp - -' now works like 'diff - -'.
< +* `cmp - -' now works like `diff - -'.
<  
<  
<  User-visible changes in version 2.3:
< @@ -407,8 +281,8 @@ User-visible changes in version 2.0:
<  
<  
<  
< -Copyright (C) 1993-1994, 1998, 2001-2002, 2004, 2006, 2009-2013, 2015-2017 Free
< -Software Foundation, Inc.
< +Copyright (C) 1993-1994, 1998, 2001-2002, 2004, 2006, 2009-2010 Free Software
< +Foundation, Inc.
<  
<  This file is part of GNU Diffutils.
<  
< Only in diffutils-3.0-patch/po: bg.gmo
< Only in diffutils-3.0-patch/po: bg.po
< Only in diffutils-3.0-patch/po: bg.po~
< Only in diffutils-3.0-patch/po: boldquot.sed
< Only in diffutils-3.0-patch/po: ca.gmo
< Only in diffutils-3.0-patch/po: ca.po
< Only in diffutils-3.0-patch/po: ca.po~
< Only in diffutils-3.0-patch/po: cs.gmo
< Only in diffutils-3.0-patch/po: cs.po
< Only in diffutils-3.0-patch/po: cs.po~
< Only in diffutils-3.0-patch/po: da.gmo
< Only in diffutils-3.0-patch/po: da.po
< Only in diffutils-3.0-patch/po: da.po~
< Only in diffutils-3.0-patch/po: de.gmo
< Only in diffutils-3.0-patch/po: de.po
< Only in diffutils-3.0-patch/po: de.po~
< Only in diffutils-3.0-patch/po: diffutils.pot
< Only in diffutils-3.0-patch/po: el.gmo
< Only in diffutils-3.0-patch/po: el.po
< Only in diffutils-3.0-patch/po: el.po~
< Only in diffutils-3.0-patch/po: en@boldquot.header
< diff -pru diffutils-3.0/po/en.po diffutils-3.0-patch/po/en.po
< --- diffutils-3.0/po/en.po	2020-03-01 22:03:00.436726000 -0800
< +++ diffutils-3.0-patch/po/en.po	2020-03-01 14:57:41.844471000 -0800
< @@ -1,19 +1,26 @@
<  # English messages for GNU diffutils
< -# Copyright 1998, 2001-2003, 2009-2013, 2015-2017 Free Software Foundation,
< -# Inc.
< +# Copyright 1998, 2001-2003, 2009-2010 Free Software Foundation, Inc.
<  # Paul Eggert <eggert@twinsun.com>, 1998
<  #
<  msgid ""
<  msgstr ""
< -"Project-Id-Version: GNU diffutils 3.2\n"
< +"Project-Id-Version: GNU diffutils 2.8.3\n"
<  "POT-Creation-Date: 2002-06-16 23:44-0700\n"
< -"PO-Revision-Date: 2012-01-25 23:11-0700\n"
< -"Last-Translator: Paul Eggert <eggert@cs.ucla.edu>\n"
< +"PO-Revision-Date: 2002-06-17 00:01-0700\n"
< +"Last-Translator: Paul Eggert <eggert@twinsun.com>\n"
<  "Language-Team: English <en@translate.freefriends.org>\n"
<  "MIME-Version: 1.0\n"
<  "Content-Type: text/plain; charset=ISO-8859-1\n"
<  "Content-Transfer-Encoding: 8bit\n"
<  
< +# POSIX requires the word "illegal" in the POSIX locale, but the error
< +# is not really against the law.  This is not the POSIX locale, so fix
< +# the wording.
< +#: lib/getopt.c:800
< +#, c-format
< +msgid "%s: illegal option -- %c\n"
< +msgstr "%s: unrecognized option `-%c'\n"
< +
<  #. TRANSLATORS: Please translate "(C)" to the C-in-a-circle symbol
<  #. (U+00A9, COPYRIGHT SIGN) if possible, as this has some minor
<  #. technical advantages in international copyright law.  If the
< Only in diffutils-3.0-patch/po: en@quot.header
< Only in diffutils-3.0-patch/po: eo.gmo
< Only in diffutils-3.0-patch/po: eo.po
< Only in diffutils-3.0-patch/po: eo.po~
< Only in diffutils-3.0-patch/po: es.gmo
< Only in diffutils-3.0-patch/po: es.po
< Only in diffutils-3.0-patch/po: es.po~
< Only in diffutils-3.0-patch/po: fi.gmo
< Only in diffutils-3.0-patch/po: fi.po
< Only in diffutils-3.0-patch/po: fi.po~
< Only in diffutils-3.0-patch/po: fr.gmo
< Only in diffutils-3.0-patch/po: fr.po
< Only in diffutils-3.0-patch/po: fr.po~
< Only in diffutils-3.0-patch/po: ga.gmo
< Only in diffutils-3.0-patch/po: ga.po
< Only in diffutils-3.0-patch/po: ga.po~
< Only in diffutils-3.0-patch/po: .gitignore
< Only in diffutils-3.0-patch/po: gl.gmo
< Only in diffutils-3.0-patch/po: gl.po
< Only in diffutils-3.0-patch/po: gl.po~
< Only in diffutils-3.0-patch/po: he.gmo
< Only in diffutils-3.0-patch/po: he.po
< Only in diffutils-3.0-patch/po: he.po~
< Only in diffutils-3.0-patch/po: hr.gmo
< Only in diffutils-3.0-patch/po: hr.po
< Only in diffutils-3.0-patch/po: hr.po~
< Only in diffutils-3.0-patch/po: hu.gmo
< Only in diffutils-3.0-patch/po: hu.po
< Only in diffutils-3.0-patch/po: hu.po~
< Only in diffutils-3.0-patch/po: id.gmo
< Only in diffutils-3.0-patch/po: id.po
< Only in diffutils-3.0-patch/po: id.po~
< Only in diffutils-3.0-patch/po: insert-header.sin
< Only in diffutils-3.0-patch/po: it.gmo
< Only in diffutils-3.0-patch/po: it.po
< Only in diffutils-3.0-patch/po: it.po~
< Only in diffutils-3.0-patch/po: ja.gmo
< Only in diffutils-3.0-patch/po: ja.po
< Only in diffutils-3.0-patch/po: ja.po~
< Only in diffutils-3.0-patch/po: LINGUAS
< Only in diffutils-3.0-patch/po: lv.gmo
< Only in diffutils-3.0-patch/po: lv.po
< Only in diffutils-3.0-patch/po: lv.po~
< Only in diffutils-3.0-patch/po: Makefile
< Only in diffutils-3.0-patch/po: Makefile.in
< Only in diffutils-3.0-patch/po: Makefile.in.in
< Only in diffutils-3.0-patch/po: Makevars
< Only in diffutils-3.0-patch/po: Makevars.template
< Only in diffutils-3.0-patch/po: ms.gmo
< Only in diffutils-3.0-patch/po: ms.po
< Only in diffutils-3.0-patch/po: ms.po~
< Only in diffutils-3.0-patch/po: nb.gmo
< Only in diffutils-3.0-patch/po: nb.po
< Only in diffutils-3.0-patch/po: nb.po~
< Only in diffutils-3.0-patch/po: nl.gmo
< Only in diffutils-3.0-patch/po: nl.po
< Only in diffutils-3.0-patch/po: nl.po~
< Only in diffutils-3.0-patch/po: pl.gmo
< Only in diffutils-3.0-patch/po: pl.po
< Only in diffutils-3.0-patch/po: pl.po~
< Only in diffutils-3.0-patch/po: POTFILES
< diff -pru diffutils-3.0/po/POTFILES.in diffutils-3.0-patch/po/POTFILES.in
< --- diffutils-3.0/po/POTFILES.in	2020-03-01 22:03:00.435725000 -0800
< +++ diffutils-3.0-patch/po/POTFILES.in	2020-03-01 14:52:55.560198000 -0800
< @@ -1,6 +1,6 @@
<  # List of files that contain translatable strings.
<  
< -# Copyright (C) 2001-2002, 2009-2013, 2015-2017 Free Software Foundation, Inc.
< +# Copyright (C) 2001-2002, 2009-2010 Free Software Foundation, Inc.
<  
<  # This program is free software: you can redistribute it and/or modify
<  # it under the terms of the GNU General Public License as published by
< @@ -15,7 +15,6 @@
<  # You should have received a copy of the GNU General Public License
<  # along with this program.  If not, see <http://www.gnu.org/licenses/>.
<  
< -lib/argmatch.c
<  lib/c-stack.c
<  lib/error.c
<  lib/file-type.c
< Only in diffutils-3.0-patch/po: pt_BR.gmo
< Only in diffutils-3.0-patch/po: pt_BR.po
< Only in diffutils-3.0-patch/po: pt_BR.po~
< Only in diffutils-3.0-patch/po: pt.gmo
< Only in diffutils-3.0-patch/po: pt.po
< Only in diffutils-3.0-patch/po: pt.po~
< Only in diffutils-3.0-patch/po: quot.sed
< Only in diffutils-3.0-patch/po: .reference
< Only in diffutils-3.0-patch/po: remove-potcdate.sed
< Only in diffutils-3.0-patch/po: remove-potcdate.sin
< Only in diffutils-3.0-patch/po: ro.gmo
< Only in diffutils-3.0-patch/po: ro.po
< Only in diffutils-3.0-patch/po: ro.po~
< Only in diffutils-3.0-patch/po: ru.gmo
< Only in diffutils-3.0-patch/po: Rules-quot
< Only in diffutils-3.0-patch/po: ru.po
< Only in diffutils-3.0-patch/po: ru.po~
< Only in diffutils-3.0-patch/po: sr.gmo
< Only in diffutils-3.0-patch/po: sr.po
< Only in diffutils-3.0-patch/po: sr.po~
< Only in diffutils-3.0-patch/po: stamp-po
< Only in diffutils-3.0-patch/po: sv.gmo
< Only in diffutils-3.0-patch/po: sv.po
< Only in diffutils-3.0-patch/po: sv.po~
< Only in diffutils-3.0-patch/po: tr.gmo
< Only in diffutils-3.0-patch/po: tr.po
< Only in diffutils-3.0-patch/po: tr.po~
< Only in diffutils-3.0-patch/po: uk.gmo
< Only in diffutils-3.0-patch/po: uk.po
< Only in diffutils-3.0-patch/po: uk.po~
< Only in diffutils-3.0-patch/po: vi.gmo
< Only in diffutils-3.0-patch/po: vi.po
< Only in diffutils-3.0-patch/po: vi.po~
< Only in diffutils-3.0-patch/po: zh_CN.gmo
< Only in diffutils-3.0-patch/po: zh_CN.po
< Only in diffutils-3.0-patch/po: zh_CN.po~
< Only in diffutils-3.0-patch/po: zh_TW.gmo
< Only in diffutils-3.0-patch/po: zh_TW.po
< Only in diffutils-3.0-patch/po: zh_TW.po~
< diff -pru diffutils-3.0/.prev-version diffutils-3.0-patch/.prev-version
< --- diffutils-3.0/.prev-version	2020-03-01 22:03:00.295714000 -0800
< +++ diffutils-3.0-patch/.prev-version	2020-03-01 14:52:55.427189000 -0800
< @@ -1 +1 @@
< -3.6
< +2.9
< Only in diffutils-3.0-patch: quote-3.0-patch.txt
< diff -pru diffutils-3.0/README diffutils-3.0-patch/README
< --- diffutils-3.0/README	2020-03-01 22:03:00.306713000 -0800
< +++ diffutils-3.0-patch/README	2020-03-01 14:56:32.250087000 -0800
< @@ -8,10 +8,10 @@ Please see the file COPYING for copying
<  
<  Please see the file doc/version.texi for version information.
<  
< -Please see the file doc/diffutils.texi (or doc/diffutils.info) for
< -documentation that can be printed with TeX, or read with the 'info'
< -program or with Emacs's 'M-x info'.  Brief man pages are in man/*,
< -but they are no substitute for the documentation.
< +Please see the file doc/diff.texi (or doc/diff.info) for documentation
< +that can be printed with TeX, or read with the `info' program or with
< +Emacs's `M-x info'.  Brief man pages are in man/*, but they are no
< +substitute for the documentation.
<  
<  Please see the file ABOUT-NLS for notes about translations.
<  
< @@ -21,7 +21,7 @@ command "./configure --help" lists the s
<  options.
<  
<  If you have a problem with internationalization, you might be able to
< -work around it as described in ABOUT-NLS by invoking './configure
< +work around it as described in ABOUT-NLS by invoking `./configure
<  --disable-nls'.  Many of the problems arise from dynamic linking
<  issues on non-GNU platforms (e.g. with the iconv library).  Such
<  problems tend to be shared by other GNU applications on these
< @@ -44,21 +44,24 @@ this distribution:
<  * help2man 1.33   <ftp://ftp.gnu.org/gnu/help2man/help2man-1.33.1.tar.gz>
<  * Texinfo 4.7     <ftp://ftp.gnu.org/gnu/texinfo/texinfo-4.7.tar.gz>
<  
< -For any copyright year range specified as YYYY-ZZZZ in this package
< -note that the range specifies every single year in that closed interval.
< -
< -Please report bugs to <bug-diffutils@gnu.org>.
< +Please report bugs to <bug-gnu-utils@gnu.org>.
<  
<  -----
<  
< -Copyright (C) 1992, 1998, 2001-2002, 2004, 2009-2013, 2015-2017 Free Software
< -Foundation, Inc.
< +Copyright (C) 1992, 1998, 2001-2002, 2004, 2009-2010 Free Software Foundation,
< +Inc.
<  
<  This file is part of GNU Diffutils.
<  
< -Permission is granted to copy, distribute and/or modify this document
< -under the terms of the GNU Free Documentation License, Version 1.3 or
< -any later version published by the Free Software Foundation; with no
< -Invariant Sections, with no Front-Cover Texts, and with no Back-Cover
< -Texts.  A copy of the license is included in the "GNU Free
< -Documentation License" file as part of this distribution.
< +This program is free software: you can redistribute it and/or modify
< +it under the terms of the GNU General Public License as published by
< +the Free Software Foundation, either version 3 of the License, or
< +(at your option) any later version.
< +
< +This program is distributed in the hope that it will be useful,
< +but WITHOUT ANY WARRANTY; without even the implied warranty of
< +MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
< +GNU General Public License for more details.
< +
< +You should have received a copy of the GNU General Public License
< +along with this program.  If not, see <http://www.gnu.org/licenses/>.
< diff -pru diffutils-3.0/README-hacking diffutils-3.0-patch/README-hacking
< --- diffutils-3.0/README-hacking	2020-03-01 22:03:00.307714000 -0800
< +++ diffutils-3.0-patch/README-hacking	2020-03-01 14:52:55.441187000 -0800
< @@ -2,99 +2,55 @@
<  
<  These notes intend to help people working on the checked-out sources.
<  These requirements do not apply when building from a distribution tarball.
< -See also HACKING for more detailed contribution guidelines.
<  
<  * Requirements
<  
<  We've opted to keep only the highest-level sources in the GIT repository.
<  This eases our maintenance burden, (fewer merges etc.), but imposes more
<  requirements on anyone wishing to build from the just-checked-out sources.
< -Note the requirements to build the released archive are much less and
< -are just the requirements of the standard ./configure && make procedure.
< -Specific development tools and versions will be checked for and listed by
< -the bootstrap script.  See README-prereq for specific notes on obtaining
< -these prerequisite tools.
< +For example, you have to use the latest stable versions of the maintainer
< +tools we depend upon, including:
< +
< +- Automake <http://www.gnu.org/software/automake/>
< +- Autoconf <http://www.gnu.org/software/autoconf/>
< +- Gettext <http://www.gnu.org/software/gettext/>
< +- Gzip <http://www.gnu.org/software/gzip/>
< +- M4 <http://www.gnu.org/software/m4/>
< +- Tar <http://www.gnu.org/software/tar/>
< +- Wget <http://www.gnu.org/software/wget/>
<  
<  Valgrind <http://valgrind.org/> is also highly recommended, if
<  Valgrind supports your architecture.
<  
< -While building from a just-cloned source tree may require installing a
< -few prerequisites, later, a plain 'git pull && make' should be sufficient.
< -
< -* First GIT checkout
< -
< -You can get a copy of the source repository like this:
< -
< -        $ git clone git://git.sv.gnu.org/diffutils
< -        $ cd diffutils
< +Only building the initial full source tree will be a bit painful.
< +Later, a plain `cvs update -dP && make' should be sufficient.
<  
< -As an optional step, if you already have a copy of the gnulib git
< -repository on your hard drive, then you can use it as a reference to
< -reduce download time and disk space requirements:
< +* First checkout
<  
< -        $ export GNULIB_SRCDIR=/path/to/gnulib
< +Obviously, if you are reading these notes, you did manage to check out
< +this package from CVS.  The next step is to get other files needed to
< +build, which are extracted from other source packages:
<  
< -The next step is to get and check other files needed to build,
< -which are extracted from other source packages:
< -
< -        $ ./bootstrap
< -
< -To use the most-recent gnulib (as opposed to the gnulib version that
< -the package last synchronized to), do this next:
< -
< -        $ git submodule foreach git pull origin master
< -        $ git commit -m 'build: update gnulib submodule to latest' gnulib
< +	$ ./bootstrap
<  
<  And there you are!  Just
<  
< -        $ ./configure --quiet #[--enable-gcc-warnings] [*]
< -        $ make
< -        $ make check
< +	$ ./configure
< +	$ make
< +	$ make check
<  
<  At this point, there should be no difference between your local copy,
< -and the GIT master copy:
< +and the master:
<  
< -        $ git diff
< +	$ cvs diff -pu
<  
<  should output no difference.
<  
<  Enjoy!
<  
< -[*] The --enable-gcc-warnings option is useful only with glibc
< -and with a very recent version of gcc.  You'll probably also have
< -to use recent system headers.  If you configure with this option,
< -and spot a problem, please be sure to send the report to the bug
< -reporting address of this package, and not to that of gnulib, even
< -if the problem seems to originate in a gnulib-provided file.
< -
< -* Submitting patches
< -
< -If you develop a fix or a new feature, please send it to the
< -appropriate bug-reporting address as reported by the --help option of
< -each program.  One way to do this is to use vc-dwim
< -<http://www.gnu.org/software/vc-dwim/>), as follows.
< -
< -  Run the command "vc-dwim --help", copy its definition of the
< -  "git-changelog-symlink-init" function into your shell, and then run
< -  this function at the top-level directory of the package.
< -
< -  Edit the (empty) ChangeLog file that this command creates, creating a
< -  properly-formatted entry according to the GNU coding standards
< -  <http://www.gnu.org/prep/standards/html_node/Change-Logs.html>.
< -
< -  Make your changes.
< -
< -  Run the command "vc-dwim" and make sure its output (the diff of all
< -  your changes) looks good.
< -
< -  Run "vc-dwim --commit".
< -
< -  Run the command "git format-patch --stdout -1", and email its output
< -  in, using the output's subject line.
< -
<  -----
<  
< -Copyright (C) 2002-2007, 2009-2013, 2015-2017 Free Software Foundation, Inc.
< +Copyright (C) 2002-2007, 2009-2010 Free Software Foundation, Inc.
<  
<  This program is free software: you can redistribute it and/or modify
<  it under the terms of the GNU General Public License as published by
< Only in diffutils-3.0-patch: README-release
< Only in diffutils-3.0: scripts
< diff -pru diffutils-3.0/src/analyze.c diffutils-3.0-patch/src/analyze.c
< --- diffutils-3.0/src/analyze.c	2020-03-01 22:03:00.445727000 -0800
< +++ diffutils-3.0-patch/src/analyze.c	2020-03-01 15:16:39.712203000 -0800
< @@ -1,7 +1,7 @@
<  /* Analyze file differences for GNU DIFF.
<  
<     Copyright (C) 1988-1989, 1992-1995, 1998, 2001-2002, 2004, 2006-2007,
< -   2009-2013, 2015-2017 Free Software Foundation, Inc.
< +   2009-2010 Free Software Foundation, Inc.
<  
<     This file is part of GNU DIFF.
<  
< @@ -38,7 +38,7 @@
<  
<     A line which is discarded will not be considered by the actual
<     comparison algorithm; it will be as if that line were not in the file.
< -   The file's 'realindexes' table maps virtual line numbers
< +   The file's `realindexes' table maps virtual line numbers
<     (which don't count the discarded lines) into real line numbers;
<     this is how the actual comparison algorithm produces results
<     that are comprehensible when the discarded lines are counted.
< @@ -251,7 +251,7 @@ discard_confusing_lines (struct file_dat
<     We do something when a run of changed lines include a
<     line at one end and have an excluded, identical line at the other.
<     We are free to choose which identical line is included.
< -   'compareseq' usually chooses the one at the beginning,
< +   `compareseq' usually chooses the one at the beginning,
<     but usually it is cleaner to consider the following identical line
<     to be the "change".  */
<  
< @@ -445,16 +445,26 @@ build_script (struct file_data const fil
<    return script;
<  }
<  
< -/* If CHANGES, briefly report that two files differed.  */
< -static void
< +/* If CHANGES, briefly report that two files differed.
< +   Return 2 if trouble, CHANGES otherwise.  */
< +static int
<  briefly_report (int changes, struct file_data const filevec[])
<  {
<    if (changes)
< -    message ((brief
< -	      ? _("Files %s and %s differ\n")
< -	      : _("Binary files %s and %s differ\n")),
< -	     file_label[0] ? file_label[0] : filevec[0].name,
< -	     file_label[1] ? file_label[1] : filevec[1].name);
< +    {
< +      char const *label0 = file_label[0] ? file_label[0] : filevec[0].name;
< +      char const *label1 = file_label[1] ? file_label[1] : filevec[1].name;
< +
< +      if (brief)
< +	message ("Files %s and %s differ\n", label0, label1);
< +      else
< +	{
< +	  message ("Binary files %s and %s differ\n", label0, label1);
< +	  changes = 2;
< +	}
< +    }
< +
< +  return changes;
<  }
<  
<  /* Report the differences of two files.  */
< @@ -477,8 +487,6 @@ diff_2_files (struct comparison *cmp)
<      {
<        /* Files with different lengths must be different.  */
<        if (cmp->file[0].stat.st_size != cmp->file[1].stat.st_size
< -	  && 0 < cmp->file[0].stat.st_size
< -	  && 0 < cmp->file[1].stat.st_size
<  	  && (cmp->file[0].desc < 0 || S_ISREG (cmp->file[0].stat.st_mode))
<  	  && (cmp->file[1].desc < 0 || S_ISREG (cmp->file[1].stat.st_mode)))
<  	changes = 1;
< @@ -528,7 +536,7 @@ diff_2_files (struct comparison *cmp)
<  	    }
<  	}
<  
< -      briefly_report (changes, cmp->file);
< +      changes = briefly_report (changes, cmp->file);
<      }
<    else
<      {
< @@ -566,13 +574,12 @@ diff_2_files (struct comparison *cmp)
<  
<        ctxt.heuristic = speed_large_files;
<  
< -      /* Set TOO_EXPENSIVE to be the approximate square root of the
< -	 input size, bounded below by 4096.  4096 seems to be good for
< -	 circa-2016 CPUs; see Bug#16848 and Bug#24715.  */
< +      /* Set TOO_EXPENSIVE to be approximate square root of input size,
< +	 bounded below by 256.  */
<        too_expensive = 1;
<        for (;  diags != 0;  diags >>= 2)
<  	too_expensive <<= 1;
< -      ctxt.too_expensive = MAX (4096, too_expensive);
< +      ctxt.too_expensive = MAX (256, too_expensive);
<  
<        files[0] = cmp->file[0];
<        files[1] = cmp->file[1];
< @@ -588,7 +595,7 @@ diff_2_files (struct comparison *cmp)
<        shift_boundaries (cmp->file);
<  
<        /* Get the results of comparison in the form of a chain
< -	 of 'struct change's -- an edit script.  */
< +	 of `struct change's -- an edit script.  */
<  
<        if (output_style == OUTPUT_ED)
<  	script = build_reverse_script (cmp->file);
< @@ -628,7 +635,7 @@ diff_2_files (struct comparison *cmp)
<  	changes = (script != 0);
<  
<        if (brief)
< -	briefly_report (changes, cmp->file);
< +	changes = briefly_report (changes, cmp->file);
<        else
<  	{
<  	  if (changes || !no_diff_means_no_output)
< Only in diffutils-3.0-patch/src: analyze.o
< Only in diffutils-3.0-patch/src: cmp
< diff -pru diffutils-3.0/src/cmp.c diffutils-3.0-patch/src/cmp.c
< --- diffutils-3.0/src/cmp.c	2020-03-01 22:03:00.447726000 -0800
< +++ diffutils-3.0-patch/src/cmp.c	2020-03-01 15:27:43.463494000 -0800
< @@ -1,7 +1,7 @@
<  /* cmp - compare two files byte by byte
<  
< -   Copyright (C) 1990-1996, 1998, 2001-2002, 2004, 2006-2007, 2009-2013,
< -   2015-2017 Free Software Foundation, Inc.
< +   Copyright (C) 1990-1996, 1998, 2001-2002, 2004, 2006-2007, 2009-2010 Free
< +   Software Foundation, Inc.
<  
<     This program is free software: you can redistribute it and/or modify
<     it under the terms of the GNU General Public License as published by
< @@ -23,7 +23,6 @@
<  
<  #include <c-stack.h>
<  #include <cmpbuf.h>
< -#include "die.h"
<  #include <error.h>
<  #include <exitfail.h>
<  #include <file-type.h>
< @@ -34,7 +33,7 @@
<  #include <unlocked-io.h>
<  #include <version-etc.h>
<  #include <xalloc.h>
< -#include <binary-io.h>
< +#include <xfreopen.h>
---
> diff --git a/src/cmp.c b/src/cmp.c
> index 2455dc4..57f1476 100644
> --- a/src/cmp.c
> +++ b/src/cmp.c
> @@ -36,7 +36,7 @@
>  #include <xfreopen.h>
3222,3231c9,11
<  /* The official name of this program (e.g., no 'g' prefix).  */
< @@ -52,8 +51,8 @@
<  
<  static int cmp (void);
<  static off_t file_position (int);
< -static size_t block_compare (word const *, word const *) _GL_ATTRIBUTE_PURE;
< -static size_t count_newlines (char *, size_t);
< +static size_t block_compare (word const *, word const *);
< +static size_t block_compare_and_count (word const *, word const *, off_t *);
<  static void sprintc (char *, unsigned char);
---
> -/* The official name of this program (e.g., no `g' prefix).  */
> +/* The official name of this program (e.g., no 'g' prefix).  */
>  #define PROGRAM_NAME "cmp"
3233,3235c13,14
<  /* Filenames of the compared files.  */
< @@ -115,8 +114,9 @@ try_help (char const *reason_msgid, char
<  {
---
>  #define AUTHORS \
> @@ -115,7 +115,7 @@ try_help (char const *reason_msgid, char const *operand)
3238,3253c17,30
< -  die (EXIT_TROUBLE, 0,
< +  error (EXIT_TROUBLE, 0,
<  	 _("Try '%s --help' for more information."), program_name);
< +  abort ();
<  }
<  
<  static char const valid_suffixes[] = "kKMGTPEZY0";
< @@ -152,21 +152,21 @@ static void
<  check_stdout (void)
<  {
<    if (ferror (stdout))
< -    die (EXIT_TROUBLE, 0, "%s", _("write failed"));
< +    error (EXIT_TROUBLE, 0, "%s", _("write failed"));
<    else if (fclose (stdout) != 0)
< -    die (EXIT_TROUBLE, errno, "%s", _("standard output"));
< +    error (EXIT_TROUBLE, errno, "%s", _("standard output"));
---
>    error (EXIT_TROUBLE, 0,
> -	 _("Try `%s --help' for more information."), program_name);
> +	 _("Try '%s --help' for more information."), program_name);
>    abort ();
>  }
>  
> @@ -134,7 +134,7 @@ specify_ignore_initial (int f, char **argptr, char delimiter)
>    if (! (e == LONGINT_OK
>  	 || (e == LONGINT_INVALID_SUFFIX_CHAR && **argptr == delimiter))
>        || TYPE_MAXIMUM (off_t) < val)
> -    try_help ("invalid --ignore-initial value `%s'", arg);
> +    try_help ("invalid --ignore-initial value '%s'", arg);
>    if (ignore_initial[f] < val)
>      ignore_initial[f] = val;
3255,3295c32
<  
<  static char const * const option_help_msgid[] = {
< -  N_("-b, --print-bytes          print differing bytes"),
< -  N_("-i, --ignore-initial=SKIP         skip first SKIP bytes of both inputs"),
< -  N_("-i, --ignore-initial=SKIP1:SKIP2  skip first SKIP1 bytes of FILE1 and\n"
< -     "                                      first SKIP2 bytes of FILE2"),
< -  N_("-l, --verbose              output byte numbers and differing byte values"),
< -  N_("-n, --bytes=LIMIT          compare at most LIMIT bytes"),
< -  N_("-s, --quiet, --silent      suppress all normal output"),
< -  N_("    --help                 display this help and exit"),
< -  N_("-v, --version              output version information and exit"),
< +  N_("-b  --print-bytes  Print differing bytes."),
< +  N_("-i SKIP  --ignore-initial=SKIP  Skip the first SKIP bytes of input."),
< +  N_("-i SKIP1:SKIP2  --ignore-initial=SKIP1:SKIP2"),
< +  N_("  Skip the first SKIP1 bytes of FILE1 and the first SKIP2 bytes of FILE2."),
< +  N_("-l  --verbose  Output byte numbers and values of all differing bytes."),
< +  N_("-n LIMIT  --bytes=LIMIT  Compare at most LIMIT bytes."),
< +  N_("-s  --quiet  --silent  Output nothing; yield exit status only."),
< +  N_("-v  --version  Output version info."),
< +  N_("--help  Output this help."),
<    0
<  };
<  
< @@ -177,17 +177,11 @@ usage (void)
<  
<    printf (_("Usage: %s [OPTION]... FILE1 [FILE2 [SKIP1 [SKIP2]]]\n"),
<  	  program_name);
< -  printf ("%s\n", _("Compare two files byte by byte."));
< -  printf ("\n%s\n\n",
< -_("The optional SKIP1 and SKIP2 specify the number of bytes to skip\n"
< -  "at the beginning of each file (zero by default)."));
< -
< -  fputs (_("\
< -Mandatory arguments to long options are mandatory for short options too.\n\
< -"), stdout);
< +  printf ("%s\n\n", _("Compare two files byte by byte."));
<    for (p = option_help_msgid;  *p;  p++)
<      printf ("  %s\n", _(*p));
< -  printf ("\n%s\n\n%s\n%s\n",
< +  printf ("\n%s\n%s\n\n%s\n%s\n",
< +	  _("SKIP1 and SKIP2 are the number of bytes to skip in each file."),
---
> @@ -185,7 +185,7 @@ usage (void)
3299,4018c36,48
< @@ -248,7 +242,7 @@ main (int argc, char **argv)
<  	break;
<  
<        case 'v':
< -	version_etc (stdout, PROGRAM_NAME, PACKAGE_NAME, Version,
< +	version_etc (stdout, PROGRAM_NAME, PACKAGE_NAME, PACKAGE_VERSION,
<  		     AUTHORS, (char *) NULL);
<  	check_stdout ();
<  	return EXIT_SUCCESS;
< @@ -293,7 +287,7 @@ main (int argc, char **argv)
<  	{
<  	  file_desc[f1] = STDIN_FILENO;
<  	  if (O_BINARY && ! isatty (STDIN_FILENO))
< -	    set_binary_mode (STDIN_FILENO, O_BINARY);
< +	    xfreopen (NULL, "rb", stdin);
<  	}
<        else
<  	file_desc[f1] = open (file[f1], O_RDONLY | O_BINARY, 0);
< @@ -303,7 +297,7 @@ main (int argc, char **argv)
<  	  if (file_desc[f1] < 0 && comparison_type == type_status)
<  	    exit (EXIT_TROUBLE);
<  	  else
< -	    die (EXIT_TROUBLE, errno, "%s", file[f1]);
< +	    error (EXIT_TROUBLE, errno, "%s", file[f1]);
<  	}
<      }
<  
< @@ -363,28 +357,27 @@ main (int argc, char **argv)
<  
<    for (f = 0; f < 2; f++)
<      if (close (file_desc[f]) != 0)
< -      die (EXIT_TROUBLE, errno, "%s", file[f]);
< +      error (EXIT_TROUBLE, errno, "%s", file[f]);
<    if (exit_status != EXIT_SUCCESS && comparison_type < type_no_stdout)
<      check_stdout ();
<    exit (exit_status);
<    return exit_status;
<  }
<  
< -/* Compare the two files already open on 'file_desc[0]' and 'file_desc[1]',
< -   using 'buffer[0]' and 'buffer[1]'.
< +/* Compare the two files already open on `file_desc[0]' and `file_desc[1]',
< +   using `buffer[0]' and `buffer[1]'.
<     Return EXIT_SUCCESS if identical, EXIT_FAILURE if different,
<     >1 if error.  */
<  
<  static int
<  cmp (void)
<  {
< -  bool at_line_start = true;
<    off_t line_number = 1;	/* Line number (1...) of difference. */
<    off_t byte_number = 1;	/* Byte number (1...) of difference. */
<    uintmax_t remaining = bytes;	/* Remaining number of bytes to compare.  */
<    size_t read0, read1;		/* Number of bytes read from each file. */
<    size_t first_diff;		/* Offset (0...) in buffers of 1st diff. */
< -  size_t smaller;		/* The lesser of 'read0' and 'read1'. */
< +  size_t smaller;		/* The lesser of `read0' and `read1'. */
<    word *buffer0 = buffer[0];
<    word *buffer1 = buffer[1];
<    char *buf0 = (char *) buffer0;
< @@ -422,7 +415,7 @@ cmp (void)
<  	      if (r != bytes_to_read)
<  		{
<  		  if (r == SIZE_MAX)
< -		    die (EXIT_TROUBLE, errno, "%s", file[f]);
< +		    error (EXIT_TROUBLE, errno, "%s", file[f]);
<  		  break;
<  		}
<  	      ig -= r;
< @@ -444,31 +437,25 @@ cmp (void)
<  
<        read0 = block_read (file_desc[0], buf0, bytes_to_read);
<        if (read0 == SIZE_MAX)
< -	die (EXIT_TROUBLE, errno, "%s", file[0]);
< +	error (EXIT_TROUBLE, errno, "%s", file[0]);
<        read1 = block_read (file_desc[1], buf1, bytes_to_read);
<        if (read1 == SIZE_MAX)
< -	die (EXIT_TROUBLE, errno, "%s", file[1]);
< +	error (EXIT_TROUBLE, errno, "%s", file[1]);
<  
< -      smaller = MIN (read0, read1);
< +      /* Insert sentinels for the block compare.  */
<  
< -      /* Optimize the common case where the buffers are the same.  */
< -      if (memcmp (buf0, buf1, smaller) == 0)
< -	first_diff = smaller;
< -      else
< -	{
< -	  /* Insert sentinels for the block compare.  */
< -	  buf0[read0] = ~buf1[read0];
< -	  buf1[read1] = ~buf0[read1];
< +      buf0[read0] = ~buf1[read0];
< +      buf1[read1] = ~buf0[read1];
<  
< -	  first_diff = block_compare (buffer0, buffer1);
< -	}
< +      /* If the line number should be written for differing files,
< +	 compare the blocks and count the number of newlines
< +	 simultaneously.  */
< +      first_diff = (comparison_type == type_first_diff
< +		    ? block_compare_and_count (buffer0, buffer1, &line_number)
< +		    : block_compare (buffer0, buffer1));
<  
<        byte_number += first_diff;
< -      if (comparison_type == type_first_diff && first_diff != 0)
< -	{
< -	  line_number += count_newlines (buf0, first_diff);
< -	  at_line_start = buf0[first_diff - 1] == '\n';
< -	}
< +      smaller = MIN (read0, read1);
<  
<        if (first_diff < smaller)
<  	{
< @@ -482,9 +469,9 @@ cmp (void)
<  		char const *line_num = offtostr (line_number, line_buf);
<  		if (!opt_print_bytes)
<  		  {
< -		    /* See POSIX for this format.  This message is
< -		       used only in the POSIX locale, so it need not
< -		       be translated.  */
< +		    /* See POSIX 1003.1-2001 for this format.  This
< +		       message is used only in the POSIX locale, so it
< +		       need not be translated.  */
<  		    static char const char_message[] =
<  		      "%s %s differ: char %s, line %s\n";
<  
< @@ -514,9 +501,9 @@ cmp (void)
<  		    printf (_("%s %s differ: byte %s, line %s is %3o %s %3o %s\n"),
<  			    file[0], file[1], byte_num, line_num,
<  			    c0, s0, c1, s1);
< -		  }
< +		}
<  	      }
< -	      FALLTHROUGH;
< +	      /* Fall through.  */
<  	    case type_status:
<  	      return EXIT_FAILURE;
<  
< @@ -531,7 +518,7 @@ cmp (void)
<  		      char const *byte_num = offtostr (byte_number, byte_buf);
<  		      if (!opt_print_bytes)
<  			{
< -			  /* See POSIX for this format.  */
< +			  /* See POSIX 1003.1-2001 for this format.  */
<  			  printf ("%*s %3o %3o\n",
<  				  offset_width, byte_num, c0, c1);
<  			}
< @@ -562,36 +549,8 @@ cmp (void)
<  	{
<  	  if (differing <= 0 && comparison_type != type_status)
<  	    {
< -	      char const *shorter_file = file[read1 < read0];
< -
< -	      /* POSIX says that each of these format strings must be
< -		 "cmp: EOF on %s", optionally followed by a blank and
< -		 extra text sans newline, then terminated by "\n".  */
< -	      if (byte_number == 1)
< -		fprintf (stderr, _("cmp: EOF on %s which is empty\n"),
< -			 shorter_file);
< -	      else
< -		{
< -		  char byte_buf[INT_BUFSIZE_BOUND (off_t)];
< -		  char const *byte_num = offtostr (byte_number - 1, byte_buf);
< -
< -		  if (comparison_type == type_first_diff)
< -		    {
< -		      char line_buf[INT_BUFSIZE_BOUND (off_t)];
< -		      char const *line_num
< -			= offtostr (line_number - at_line_start, line_buf);
< -		      fprintf (stderr,
< -			       (at_line_start
< -				? _("cmp: EOF on %s after byte %s, line %s\n")
< -				: _("cmp: EOF on %s after byte %s,"
< -				    " in line %s\n")),
< -			       shorter_file, byte_num, line_num);
< -		    }
< -		  else
< -		    fprintf (stderr,
< -			     _("cmp: EOF on %s after byte %s\n"),
< -			     shorter_file, byte_num);
< -		}
< +	      /* See POSIX 1003.1-2001 for this format.  */
< +	      fprintf (stderr, _("cmp: EOF on %s\n"), file[read1 < read0]);
<  	    }
<  
<  	  return EXIT_FAILURE;
< @@ -602,6 +561,54 @@ cmp (void)
<    return differing == 0 ? EXIT_SUCCESS : EXIT_FAILURE;
<  }
<  
< +/* Compare two blocks of memory P0 and P1 until they differ,
< +   and count the number of '\n' occurrences in the common
< +   part of P0 and P1.
< +   If the blocks are not guaranteed to be different, put sentinels at the ends
< +   of the blocks before calling this function.
< +
< +   Return the offset of the first byte that differs.
< +   Increment *COUNT by the count of '\n' occurrences.  */
< +
< +static size_t
< +block_compare_and_count (word const *p0, word const *p1, off_t *count)
< +{
< +  word l;		/* One word from first buffer. */
< +  word const *l0, *l1;	/* Pointers into each buffer. */
< +  char const *c0, *c1;	/* Pointers for finding exact address. */
< +  size_t cnt = 0;	/* Number of '\n' occurrences. */
< +  word nnnn;		/* Newline, sizeof (word) times.  */
< +  int i;
< +
< +  nnnn = 0;
< +  for (i = 0; i < sizeof nnnn; i++)
< +    nnnn = (nnnn << CHAR_BIT) | '\n';
< +
< +  /* Find the rough position of the first difference by reading words,
< +     not bytes.  */
< +
< +  for (l0 = p0, l1 = p1;  (l = *l0) == *l1;  l0++, l1++)
< +    {
< +      l ^= nnnn;
< +      for (i = 0; i < sizeof l; i++)
< +	{
< +	  unsigned char uc = l;
< +	  cnt += ! uc;
< +	  l >>= CHAR_BIT;
< +	}
< +    }
< +
< +  /* Find the exact differing position (endianness independent).  */
< +
< +  for (c0 = (char const *) l0, c1 = (char const *) l1;
< +       *c0 == *c1;
< +       c0++, c1++)
< +    cnt += *c0 == '\n';
< +
< +  *count += cnt;
< +  return c0 - (char const *) p0;
< +}
< +
<  /* Compare two blocks of memory P0 and P1 until they differ.
<     If the blocks are not guaranteed to be different, put sentinels at the ends
<     of the blocks before calling this function.
< @@ -630,21 +637,6 @@ block_compare (word const *p0, word cons
<    return c0 - (char const *) p0;
<  }
<  
< -/* Return the number of newlines in BUF, of size BUFSIZE,
< -   where BUF[NBYTES] is available for use as a sentinel.  */
< -
< -static size_t
< -count_newlines (char *buf, size_t bufsize)
< -{
< -  size_t count = 0;
< -  char *p;
< -  char *lim = buf + bufsize;
< -  *lim = '\n';
< -  for (p = buf; (p = rawmemchr (p, '\n')) != lim; p++)
< -    count++;
< -  return count;
< -}
< -
<  /* Put into BUF the unsigned char C, making unprintable bytes
<     visible by quoting like cat -t does.  */
<  
< Only in diffutils-3.0-patch/src: cmp.o
< diff -pru diffutils-3.0/src/context.c diffutils-3.0-patch/src/context.c
< --- diffutils-3.0/src/context.c	2020-03-01 22:03:00.448729000 -0800
< +++ diffutils-3.0-patch/src/context.c	2020-03-01 15:30:06.157718000 -0800
< @@ -1,7 +1,7 @@
<  /* Context-format output routines for GNU DIFF.
<  
< -   Copyright (C) 1988-1989, 1991-1995, 1998, 2001-2002, 2004, 2006, 2009-2013,
< -   2015-2017 Free Software Foundation, Inc.
< +   Copyright (C) 1988-1989, 1991-1995, 1998, 2001-2002, 2004, 2006, 2009-2010
< +   Free Software Foundation, Inc.
<  
<     This file is part of GNU DIFF.
<  
< @@ -20,6 +20,7 @@
<  
<  #include "diff.h"
<  #include "c-ctype.h"
< +#include <inttostr.h>
<  #include <stat-time.h>
<  #include <strftime.h>
<  
< @@ -40,7 +41,6 @@ static lin find_function_last_match;
<  static void
<  print_context_label (char const *mark,
<  		     struct file_data *inf,
< -		     char const *name,
<  		     char const *label)
<  {
<    if (label)
< @@ -71,27 +71,25 @@ print_context_label (char const *mark,
<  	      sprintf (buf, "%"PRIuMAX".%.9d", sec, nsec);
<  	    }
<  	}
< -      fprintf (outfile, "%s %s\t%s\n", mark, name, buf);
< +      fprintf (outfile, "%s %s\t%s\n", mark, inf->name, buf);
<      }
<  }
<  
<  /* Print a header for a context diff, with the file names and dates.  */
<  
<  void
< -print_context_header (struct file_data inf[], char const *const *names, bool unidiff)
< +print_context_header (struct file_data inf[], bool unidiff)
<  {
< -  set_color_context (HEADER_CONTEXT);
<    if (unidiff)
<      {
< -      print_context_label ("---", &inf[0], names[0], file_label[0]);
< -      print_context_label ("+++", &inf[1], names[1], file_label[1]);
< +      print_context_label ("---", &inf[0], file_label[0]);
< +      print_context_label ("+++", &inf[1], file_label[1]);
<      }
<    else
<      {
< -      print_context_label ("***", &inf[0], names[0], file_label[0]);
< -      print_context_label ("---", &inf[1], names[1], file_label[1]);
< +      print_context_label ("***", &inf[0], file_label[0]);
< +      print_context_label ("---", &inf[1], file_label[1]);
<      }
< -  set_color_context (RESET_CONTEXT);
<  }
<  
<  /* Print an edit script in context format.  */
< @@ -126,7 +124,7 @@ print_context_script (struct change *scr
<  static void
<  print_context_number_range (struct file_data const *file, lin a, lin b)
<  {
< -  printint trans_a, trans_b;
< +  long int trans_a, trans_b;
<    translate_range (file, a, b, &trans_a, &trans_b);
<  
<    /* We can have B <= A in the case of a range of no lines.
< @@ -139,9 +137,9 @@ print_context_number_range (struct file_
<       specification.  */
<  
<    if (trans_b <= trans_a)
< -    fprintf (outfile, "%"pI"d", trans_b);
< +    fprintf (outfile, "%ld", trans_b);
<    else
< -    fprintf (outfile, "%"pI"d,%"pI"d", trans_a, trans_b);
< +    fprintf (outfile, "%ld,%ld", trans_a, trans_b);
<  }
<  
<  /* Print FUNCTION in a context header.  */
< @@ -161,7 +159,7 @@ print_context_function (FILE *out, char
<  
<  /* Print a portion of an edit script in context format.
<     HUNK is the beginning of the portion to be printed.
< -   The end is marked by a 'link' that has been nulled out.
< +   The end is marked by a `link' that has been nulled out.
<  
<     Prints out lines from both files, and precedes each
<     line with the appropriate flag-character.  */
< @@ -207,21 +205,14 @@ pr_context_hunk (struct change *hunk)
<    if (function)
<      print_context_function (out, function);
<  
< -  putc ('\n', out);
< -  set_color_context (LINE_NUMBER_CONTEXT);
< -  fputs ("*** ", out);
< +  fputs ("\n*** ", out);
<    print_context_number_range (&files[0], first0, last0);
< -  fputs (" ****", out);
< -  set_color_context (RESET_CONTEXT);
< -  putc ('\n', out);
< +  fputs (" ****\n", out);
<  
<    if (changes & OLD)
<      {
<        struct change *next = hunk;
<  
< -      if (first0 <= last0)
< -        set_color_context (DELETE_CONTEXT);
< -
<        for (i = first0; i <= last0; i++)
<  	{
<  	  /* Skip past changes that apply (in file 0)
< @@ -234,34 +225,23 @@ pr_context_hunk (struct change *hunk)
<  
<  	  prefix = " ";
<  	  if (next && next->line0 <= i)
< -            {
< -              /* The change NEXT covers this line.
< -                 If lines were inserted here in file 1, this is "changed".
< -                 Otherwise it is "deleted".  */
< -              prefix = (next->inserted > 0 ? "!" : "-");
< -            }
< -	  print_1_line_nl (prefix, &files[0].linbuf[i], true);
< -          if (i == last0)
< -            set_color_context (RESET_CONTEXT);
< -          if (files[0].linbuf[i + 1][-1] == '\n')
< -            putc ('\n', out);
< +	    /* The change NEXT covers this line.
< +	       If lines were inserted here in file 1, this is "changed".
< +	       Otherwise it is "deleted".  */
< +	    prefix = (next->inserted > 0 ? "!" : "-");
< +
< +	  print_1_line (prefix, &files[0].linbuf[i]);
<  	}
<      }
<  
< -  set_color_context (LINE_NUMBER_CONTEXT);
<    fputs ("--- ", out);
<    print_context_number_range (&files[1], first1, last1);
< -  fputs (" ----", out);
< -  set_color_context (RESET_CONTEXT);
< -  putc ('\n', out);
< +  fputs (" ----\n", out);
<  
<    if (changes & NEW)
<      {
<        struct change *next = hunk;
<  
< -      if (first1 <= last1)
< -        set_color_context (ADD_CONTEXT);
< -
<        for (i = first1; i <= last1; i++)
<  	{
<  	  /* Skip past changes that apply (in file 1)
< @@ -274,17 +254,12 @@ pr_context_hunk (struct change *hunk)
<  
<  	  prefix = " ";
<  	  if (next && next->line1 <= i)
< -            {
< -              /* The change NEXT covers this line.
< -                 If lines were deleted here in file 0, this is "changed".
< -                 Otherwise it is "inserted".  */
< -              prefix = (next->deleted > 0 ? "!" : "+");
< -            }
< -	  print_1_line_nl (prefix, &files[1].linbuf[i], true);
< -          if (i == last1)
< -            set_color_context (RESET_CONTEXT);
< -          if (files[1].linbuf[i + 1][-1] == '\n')
< -            putc ('\n', out);
< +	    /* The change NEXT covers this line.
< +	       If lines were deleted here in file 0, this is "changed".
< +	       Otherwise it is "inserted".  */
< +	    prefix = (next->deleted > 0 ? "!" : "+");
< +
< +	  print_1_line (prefix, &files[1].linbuf[i]);
<  	}
<      }
<  }
< @@ -299,7 +274,7 @@ pr_context_hunk (struct change *hunk)
<  static void
<  print_unidiff_number_range (struct file_data const *file, lin a, lin b)
<  {
< -  printint trans_a, trans_b;
< +  long int trans_a, trans_b;
<    translate_range (file, a, b, &trans_a, &trans_b);
<  
<    /* We can have B < A in the case of a range of no lines.
< @@ -307,14 +282,14 @@ print_unidiff_number_range (struct file_
<       which is B.  It would be more logical to print A, but
<       'patch' expects B in order to detect diffs against empty files.  */
<    if (trans_b <= trans_a)
< -    fprintf (outfile, trans_b < trans_a ? "%"pI"d,0" : "%"pI"d", trans_b);
< +    fprintf (outfile, trans_b < trans_a ? "%ld,0" : "%ld", trans_b);
<    else
< -    fprintf (outfile, "%"pI"d,%"pI"d", trans_a, trans_b - trans_a + 1);
< +    fprintf (outfile, "%ld,%ld", trans_a, trans_b - trans_a + 1);
<  }
<  
<  /* Print a portion of an edit script in unidiff format.
<     HUNK is the beginning of the portion to be printed.
< -   The end is marked by a 'link' that has been nulled out.
< +   The end is marked by a `link' that has been nulled out.
<  
<     Prints out lines from both files, and precedes each
<     line with the appropriate flag-character.  */
< @@ -355,13 +330,11 @@ pr_unidiff_hunk (struct change *hunk)
<    begin_output ();
<    out = outfile;
<  
< -  set_color_context (LINE_NUMBER_CONTEXT);
<    fputs ("@@ -", out);
<    print_unidiff_number_range (&files[0], first0, last0);
<    fputs (" +", out);
<    print_unidiff_number_range (&files[1], first1, last1);
<    fputs (" @@", out);
< -  set_color_context (RESET_CONTEXT);
<  
<    if (function)
<      print_context_function (out, function);
< @@ -390,43 +363,25 @@ pr_unidiff_hunk (struct change *hunk)
<  	  /* For each difference, first output the deleted part. */
<  
<  	  k = next->deleted;
< -          if (k)
< -            set_color_context (DELETE_CONTEXT);
< -
<  	  while (k--)
<  	    {
<  	      char const * const *line = &files[0].linbuf[i++];
<  	      putc ('-', out);
<  	      if (initial_tab && ! (suppress_blank_empty && **line == '\n'))
<  		putc ('\t', out);
< -	      print_1_line_nl (NULL, line, true);
< -
< -              if (!k)
< -                set_color_context (RESET_CONTEXT);
< -
< -              if (line[1][-1] == '\n')
< -                putc ('\n', out);
< +	      print_1_line (NULL, line);
<  	    }
<  
<  	  /* Then output the inserted part. */
<  
<  	  k = next->inserted;
< -          if (k)
< -            set_color_context (ADD_CONTEXT);
< -
< -          while (k--)
< +	  while (k--)
<  	    {
<  	      char const * const *line = &files[1].linbuf[j++];
<  	      putc ('+', out);
<  	      if (initial_tab && ! (suppress_blank_empty && **line == '\n'))
<  		putc ('\t', out);
< -	      print_1_line_nl (NULL, line, true);
< -
< -              if (!k)
< -                set_color_context (RESET_CONTEXT);
< -
< -              if (line[1][-1] == '\n')
< -                putc ('\n', out);
< +	      print_1_line (NULL, line);
<  	    }
<  
<  	  /* We're done with this hunk, so on to the next! */
< @@ -438,20 +393,21 @@ pr_unidiff_hunk (struct change *hunk)
<  
<  /* Scan a (forward-ordered) edit script for the first place that more than
<     2*CONTEXT unchanged lines appear, and return a pointer
< -   to the 'struct change' for the last change before those lines.  */
< +   to the `struct change' for the last change before those lines.  */
<  
< -static struct change * _GL_ATTRIBUTE_PURE
< +static struct change *
<  find_hunk (struct change *start)
<  {
<    struct change *prev;
<    lin top0, top1;
<    lin thresh;
<  
< -  /* Threshold distance is CONTEXT if the second change is ignorable,
< -     2 * CONTEXT + 1 otherwise.  Integer overflow can't happen, due
< -     to CONTEXT_LIM.  */
< +  /* Threshold distance is 2 * CONTEXT + 1 between two non-ignorable
< +     changes, but only CONTEXT if one is ignorable.  Watch out for
< +     integer overflow, though.  */
< +  lin non_ignorable_threshold =
< +    (LIN_MAX - 1) / 2 < context ? LIN_MAX : 2 * context + 1;
<    lin ignorable_threshold = context;
< -  lin non_ignorable_threshold = 2 * context + 1;
<  
<    do
<      {
< @@ -460,7 +416,7 @@ find_hunk (struct change *start)
<        top1 = start->line1 + start->inserted;
<        prev = start;
<        start = start->link;
< -      thresh = (start && start->ignore
< +      thresh = (prev->ignore || (start && start->ignore)
<  		? ignorable_threshold
<  		: non_ignorable_threshold);
<        /* It is not supposed to matter which file we check in the end-test.
< @@ -475,7 +431,7 @@ find_hunk (struct change *start)
<    return prev;
<  }
<  
< -/* Set the 'ignore' flag properly in each change in SCRIPT.
< +/* Set the `ignore' flag properly in each change in SCRIPT.
<     It should be 1 if all the lines inserted or deleted in that change
<     are ignorable lines.  */
<  
< @@ -503,7 +459,7 @@ mark_ignorable (struct change *script)
<  }
<  
<  /* Find the last function-header line in LINBUF prior to line number LINENUM.
< -   This is a line containing a match for the regexp in 'function_regexp'.
< +   This is a line containing a match for the regexp in `function_regexp'.
<     Return the address of the text, or NULL if no function-header is found.  */
<  
<  static char const *
< Only in diffutils-3.0-patch/src: context.o
< Only in diffutils-3.0-patch/src: .deps
< Only in diffutils-3.0/src: die.h
< Only in diffutils-3.0-patch/src: diff
< Only in diffutils-3.0-patch/src: diff3
< diff -pru diffutils-3.0/src/diff3.c diffutils-3.0-patch/src/diff3.c
< --- diffutils-3.0/src/diff3.c	2020-03-01 22:03:00.455727000 -0800
< +++ diffutils-3.0-patch/src/diff3.c	2020-03-01 16:18:20.923541000 -0800
< @@ -1,7 +1,7 @@
<  /* diff3 - compare three files line by line
<  
< -   Copyright (C) 1988-1989, 1992-1996, 1998, 2001-2002, 2004, 2006, 2009-2013,
< -   2015-2017 Free Software Foundation, Inc.
< +   Copyright (C) 1988-1989, 1992-1996, 1998, 2001-2002, 2004, 2006, 2009-2010
< +   Free Software Foundation, Inc.
<  
<     This program is free software: you can redistribute it and/or modify
<     it under the terms of the GNU General Public License as published by
< @@ -24,18 +24,18 @@
<  
<  #include <c-stack.h>
<  #include <cmpbuf.h>
< -#include "die.h"
<  #include <error.h>
<  #include <exitfail.h>
<  #include <file-type.h>
<  #include <getopt.h>
< +#include <inttostr.h>
<  #include <progname.h>
< -#include <system-quote.h>
< +#include <sh-quote.h>
<  #include <version-etc.h>
<  #include <xalloc.h>
<  #include <xfreopen.h>
<  
< -/* The official name of this program (e.g., no 'g' prefix).  */
< +/* The official name of this program (e.g., no `g' prefix).  */
<  #define PROGRAM_NAME "diff3"
<  
<  #define AUTHORS \
< @@ -79,9 +79,6 @@ struct diff_block {
<    char **lines[2];		/* The actual lines (may contain nulls) */
<    size_t *lengths[2];		/* Line lengths (including newlines, if any) */
<    struct diff_block *next;
< -#ifdef lint
< -  struct diff_block *n2;	/* Used only when freeing.  */
< -#endif
<  };
<  
<  /* Three way diff */
< @@ -162,7 +159,7 @@ static bool overlap_only;
<  /* If nonzero, show information for DIFF_2ND diffs.  */
<  static bool show_2nd;
<  
< -/* If nonzero, include ':wq' at the end of the script
< +/* If nonzero, include `:wq' at the end of the script
<     to write out the file being edited.   */
<  static bool finalwrite;
<  
< @@ -180,7 +177,7 @@ static struct diff3_block *create_diff3_
<  static struct diff3_block *make_3way_diff (struct diff_block *, struct diff_block *);
<  static struct diff3_block *reverse_diff3_blocklist (struct diff3_block *);
<  static struct diff3_block *using_to_diff3_block (struct diff_block *[2], struct diff_block *[2], int, int, struct diff3_block const *);
< -static struct diff_block *process_diff (char const *, char const *, struct diff_block **, char **);
< +static struct diff_block *process_diff (char const *, char const *, struct diff_block **);
<  static void check_stdout (void);
<  static void fatal (char const *) __attribute__((noreturn));
<  static void output_diff3 (FILE *, struct diff3_block *, int const[3], int const[3]);
< @@ -216,38 +213,6 @@ static struct option const longopts[] =
<    {0, 0, 0, 0}
<  };
<  
< -static void
< -free_diff_block (struct diff_block *p)
< -{
< -#ifndef lint
< -  (void)p;
< -#else
< -  while (p)
< -    {
< -      free (p->lines[0]);
< -      free (p->lines[1]);
< -      free (p->lengths[0]);
< -      free (p->lengths[1]);
< -      struct diff_block *next = p->n2;
< -      free (p);
< -      p = next;
< -    }
< -#endif
< -}
< -
< -/* Copy each next pointer to n2, since make_3way_diff would clobber the former,
< -   yet we will still need something to free these buffers.  */
< -static void
< -next_to_n2 (struct diff_block *p)
< -{
< -#ifndef lint
< -  (void)p;
< -#else
< -  while (p)
< -    p = p->n2 = p->next;
< -#endif
< -}
< -
<  int
<  main (int argc, char **argv)
<  {
< @@ -301,10 +266,10 @@ main (int argc, char **argv)
<  	  break;
<  	case 'X':
<  	  overlap_only = true;
< -	  FALLTHROUGH;
< +	  /* Fall through.  */
<  	case 'E':
<  	  flagging = true;
< -	  FALLTHROUGH;
< +	  /* Fall through.  */
<  	case 'e':
<  	  incompat++;
<  	  break;
< @@ -315,7 +280,7 @@ main (int argc, char **argv)
<  	  strip_trailing_cr = true;
<  	  break;
<  	case 'v':
< -	  version_etc (stdout, PROGRAM_NAME, PACKAGE_NAME, Version,
< +	  version_etc (stdout, PROGRAM_NAME, PACKAGE_NAME, PACKAGE_VERSION,
<  		       AUTHORS, (char *) NULL);
<  	  check_stdout ();
<  	  return EXIT_SUCCESS;
< @@ -339,9 +304,7 @@ main (int argc, char **argv)
---
> -	  _("If a FILE is `-' or missing, read standard input."),
> +	  _("If a FILE is '-' or missing, read standard input."),
>  	  _("Exit status is 0 if inputs are the same, 1 if different, 2 if trouble."));
>    emit_bug_reporting_address ();
>  }
> @@ -231,7 +231,7 @@ main (int argc, char **argv)
>  	{
>  	  uintmax_t n;
>  	  if (xstrtoumax (optarg, 0, 0, &n, valid_suffixes) != LONGINT_OK)
> -	    try_help ("invalid --bytes value `%s'", optarg);
> +	    try_help ("invalid --bytes value '%s'", optarg);
>  	  if (n < bytes)
>  	    bytes = n;
4020,4040c50
<      }
<  
< -  /* -AeExX3 without -m implies ed script.  */
< -  edscript = incompat & ~(int) merge;
< -
< +  edscript = incompat & ~merge;  /* -AeExX3 without -m implies ed script.  */
<    show_2nd |= ~incompat & merge;  /* -m without -AeExX3 implies -A.  */
<    flagging |= ~incompat & merge;
<  
< @@ -399,12 +362,12 @@ main (int argc, char **argv)
<      rev_mapping[mapping[i]] = i;
<  
<    for (i = 0; i < 3; i++)
< -    if (! STREQ (file[i], "-"))
< +    if (strcmp (file[i], "-") != 0)
<        {
<  	if (stat (file[i], &statb) < 0)
<  	  perror_with_exit (file[i]);
<  	else if (S_ISDIR (statb.st_mode))
< -	  die (EXIT_TROUBLE, EISDIR, "%s", file[i]);
< +	  error (EXIT_TROUBLE, EISDIR, "%s", file[i]);
---
> @@ -257,7 +257,7 @@ main (int argc, char **argv)
4043,4067c53,59
<  #ifdef SIGCHLD
< @@ -415,19 +378,10 @@ main (int argc, char **argv)
<    /* Invoke diff twice on two pairs of input files, combine the two
<       diffs, and output them.  */
<  
< -  char *b0, *b1;
<    commonname = file[rev_mapping[FILEC]];
< -  thread1 = process_diff (file[rev_mapping[FILE1]], commonname, &last_block, &b1);
< -  thread0 = process_diff (file[rev_mapping[FILE0]], commonname, &last_block, &b0);
< -
< -  next_to_n2 (thread0);
< -  next_to_n2 (thread1);
< -
< +  thread1 = process_diff (file[rev_mapping[FILE1]], commonname, &last_block);
< +  thread0 = process_diff (file[rev_mapping[FILE0]], commonname, &last_block);
<    diff3 = make_3way_diff (thread0, thread1);
< -
< -  free_diff_block (thread0);
< -  free_diff_block (thread1);
< -
<    if (edscript)
<      conflicts_found
<        = output_diff3_edscript (stdout, diff3, mapping, rev_mapping,
< @@ -447,10 +401,9 @@ main (int argc, char **argv)
<        conflicts_found = false;
---
>    if (optind == argc)
> -    try_help ("missing operand after `%s'", argv[argc - 1]);
> +    try_help ("missing operand after '%s'", argv[argc - 1]);
>  
>    file[0] = argv[optind++];
>    file[1] = optind < argc ? argv[optind++] : "-";
> @@ -269,7 +269,7 @@ main (int argc, char **argv)
4070,4177c62,64
< -  free (b0);
< -  free (b1);
<    check_stdout ();
<    exit (conflicts_found);
< +  return conflicts_found;
<  }
<  
<  static void
< @@ -458,8 +411,9 @@ try_help (char const *reason_msgid, char
<  {
<    if (reason_msgid)
<      error (0, 0, _(reason_msgid), operand);
< -  die (EXIT_TROUBLE, 0,
< +  error (EXIT_TROUBLE, 0,
<  	 _("Try '%s --help' for more information."), program_name);
< +  abort ();
<  }
<  
<  static void
< @@ -472,28 +426,23 @@ check_stdout (void)
<  }
<  
<  static char const * const option_help_msgid[] = {
< -  N_("-A, --show-all              output all changes, bracketing conflicts"),
< -  "",
< -  N_("-e, --ed                    output ed script incorporating changes\n"
< -     "                                from OLDFILE to YOURFILE into MYFILE"),
< -  N_("-E, --show-overlap          like -e, but bracket conflicts"),
< -  N_("-3, --easy-only             like -e, but incorporate only nonoverlapping changes"),
< -  N_("-x, --overlap-only          like -e, but incorporate only overlapping changes"),
< -  N_("-X                          like -x, but bracket conflicts"),
< -  N_("-i                          append 'w' and 'q' commands to ed scripts"),
< -  "",
< -  N_("-m, --merge                 output actual merged file, according to\n"
< -     "                                -A if no other options are given"),
< +  N_("-e  --ed  Output unmerged changes from OLDFILE to YOURFILE into MYFILE."),
< +  N_("-E  --show-overlap  Output unmerged changes, bracketing conflicts."),
< +  N_("-A  --show-all  Output all changes, bracketing conflicts."),
< +  N_("-x  --overlap-only  Output overlapping changes."),
< +  N_("-X  Output overlapping changes, bracketing them."),
< +  N_("-3  --easy-only  Output unmerged nonoverlapping changes."),
<    "",
< -  N_("-a, --text                  treat all files as text"),
< -  N_("    --strip-trailing-cr     strip trailing carriage return on input"),
< -  N_("-T, --initial-tab           make tabs line up by prepending a tab"),
< -  N_("    --diff-program=PROGRAM  use PROGRAM to compare files"),
< -  N_("-L, --label=LABEL           use LABEL instead of file name\n"
< -     "                                (can be repeated up to three times)"),
< +  N_("-m  --merge  Output merged file instead of ed script (default -A)."),
< +  N_("-L LABEL  --label=LABEL  Use LABEL instead of file name."),
< +  N_("-i  Append 'w' and 'q' commands to ed scripts."),
< +  N_("-a  --text  Treat all files as text."),
< +  N_("--strip-trailing-cr  Strip trailing carriage return on input."),
< +  N_("-T  --initial-tab  Make tabs line up by prepending a tab."),
< +  N_("--diff-program=PROGRAM  Use PROGRAM to compare files."),
<    "",
< -  N_("    --help                  display this help and exit"),
< -  N_("-v, --version               output version information and exit"),
< +  N_("-v  --version  Output version info."),
< +  N_("--help  Output this help."),
<    0
<  };
<  
< @@ -505,25 +454,11 @@ usage (void)
<    printf (_("Usage: %s [OPTION]... MYFILE OLDFILE YOURFILE\n"),
<  	  program_name);
<    printf ("%s\n\n", _("Compare three files line by line."));
< -
< -  fputs (_("\
< -Mandatory arguments to long options are mandatory for short options too.\n\
< -"), stdout);
<    for (p = option_help_msgid;  *p;  p++)
<      if (**p)
<        printf ("  %s\n", _(*p));
<      else
<        putchar ('\n');
< -  fputs (_("\n\
< -The default output format is a somewhat human-readable representation of\n\
< -the changes.\n\
< -\n\
< -The -e, -E, -x, -X (and corresponding long) options cause an ed script\n\
< -to be output instead of the default.\n\
< -\n\
< -Finally, the -m (--merge) option causes diff3 to do the merge internally\n\
< -and output the actual merged file.  For unusual input, this is more\n\
< -robust than using ed.\n"), stdout);
<    printf ("\n%s\n%s\n",
<  	  _("If a FILE is '-', read standard input."),
<  	  _("Exit status is 0 if successful, 1 if conflicts, 2 if trouble."));
< @@ -986,8 +921,7 @@ compare_line_list (char * const list1[],
<  static struct diff_block *
<  process_diff (char const *filea,
<  	      char const *fileb,
< -	      struct diff_block **last_block,
< -	      char **buf_to_free)
< +	      struct diff_block **last_block)
<  {
<    char *diff_contents;
<    char *diff_limit;
< @@ -1002,7 +936,6 @@ process_diff (char const *filea,
<  				  sizeof *bptr->lengths[1]));
<  
<    diff_limit = read_diff (filea, fileb, &diff_contents);
< -  *buf_to_free = diff_contents;
<    scan_diff = diff_contents;
<  
<    while (scan_diff < diff_limit)
< @@ -1094,7 +1027,7 @@ process_diff (char const *filea,
---
>    if (optind < argc)
> -    try_help ("extra operand `%s'", argv[optind]);
> +    try_help ("extra operand '%s'", argv[optind]);
4179,4310c66
<  /* Skip tabs and spaces, and return the first character after them.  */
<  
< -static char * _GL_ATTRIBUTE_PURE
< +static char *
<  skipwhite (char *s)
<  {
<    while (*s == ' ' || *s == '\t')
< @@ -1210,15 +1143,13 @@ read_diff (char const *filea,
<    int fd, wstatus, status;
<    int werrno = 0;
<    struct stat pipestat;
< +
< +#if HAVE_WORKING_FORK || HAVE_WORKING_VFORK
< +
<    char const *argv[9];
<    char const **ap;
< -#if HAVE_WORKING_FORK
<    int fds[2];
<    pid_t pid;
< -#else
< -  FILE *fpipe;
< -  char *command;
< -#endif
<  
<    ap = argv;
<    *ap++ = diff_program;
< @@ -1232,12 +1163,10 @@ read_diff (char const *filea,
<    *ap++ = fileb;
<    *ap = 0;
<  
< -#if HAVE_WORKING_FORK
< -
<    if (pipe (fds) != 0)
<      perror_with_exit ("pipe");
<  
< -  pid = fork ();
< +  pid = vfork ();
<    if (pid == 0)
<      {
<        /* Child */
< @@ -1263,7 +1192,32 @@ read_diff (char const *filea,
<  
<  #else
<  
< -  command = system_quote_argv (SCI_SYSTEM, (char **) argv);
< +  FILE *fpipe;
< +  char const args[] = " --horizon-lines=100 -- ";
< +  char *command = xmalloc (shell_quote_length (diff_program)
< +			   + sizeof "-a"
< +			   + sizeof "--strip-trailing-cr"
< +			   + sizeof args - 1
< +			   + shell_quote_length (filea) + 1
< +			   + shell_quote_length (fileb) + 1);
< +  char *p = command;
< +  p = shell_quote_copy (p, diff_program);
< +  if (text)
< +    {
< +      strcpy (p, " -a");
< +      p += 3;
< +    }
< +  if (strip_trailing_cr)
< +    {
< +      strcpy (p, " --strip-trailing-cr");
< +      p += 20;
< +    }
< +  strcpy (p, args);
< +  p += sizeof args - 1;
< +  p = shell_quote_copy (p, filea);
< +  *p++ = ' ';
< +  p = shell_quote_copy (p, fileb);
< +  *p = 0;
<    errno = 0;
<    fpipe = popen (command, "r");
<    if (!fpipe)
< @@ -1301,7 +1255,7 @@ read_diff (char const *filea,
<  
<    *output_placement = diff_result;
<  
< -#if ! HAVE_WORKING_FORK
< +#if ! (HAVE_WORKING_FORK || HAVE_WORKING_VFORK)
<  
<    wstatus = pclose (fpipe);
<    if (wstatus == -1)
< @@ -1319,7 +1273,7 @@ read_diff (char const *filea,
<    status = ! werrno && WIFEXITED (wstatus) ? WEXITSTATUS (wstatus) : INT_MAX;
<  
<    if (EXIT_TROUBLE <= status)
< -    die (EXIT_TROUBLE, werrno,
< +    error (EXIT_TROUBLE, werrno,
<  	   _(status == 126
<  	     ? "subsidiary program '%s' could not be invoked"
<  	     : status == 127
< @@ -1430,20 +1384,20 @@ output_diff3 (FILE *outputfile, struct d
<  	  int realfile = mapping[i];
<  	  lin lowt = D_LOWLINE (ptr, realfile);
<  	  lin hight = D_HIGHLINE (ptr, realfile);
< -	  printint llowt = lowt;
< -	  printint lhight = hight;
< +	  long int llowt = lowt;
< +	  long int lhight = hight;
<  
<  	  fprintf (outputfile, "%d:", i + 1);
<  	  switch (lowt - hight)
<  	    {
<  	    case 1:
< -	      fprintf (outputfile, "%"pI"da\n", llowt - 1);
< +	      fprintf (outputfile, "%lda\n", llowt - 1);
<  	      break;
<  	    case 0:
< -	      fprintf (outputfile, "%"pI"dc\n", llowt);
< +	      fprintf (outputfile, "%ldc\n", llowt);
<  	      break;
<  	    default:
< -	      fprintf (outputfile, "%"pI"d,%"pI"dc\n", llowt, lhight);
< +	      fprintf (outputfile, "%ld,%ldc\n", llowt, lhight);
<  	      break;
<  	    }
<  
< @@ -1497,18 +1451,19 @@ dotlines (FILE *outputfile, struct diff3
<  
<  /* Output to OUTPUTFILE a '.' line.  If LEADING_DOT is true, also
<     output a command that removes initial '.'s starting with line START
< -   and continuing for NUM lines.  */
< +   and continuing for NUM lines.  (START is long int, not lin, for
< +   convenience with printf %ld formats.)  */
<  
<  static void
< -undotlines (FILE *outputfile, bool leading_dot, printint start, printint num)
< +undotlines (FILE *outputfile, bool leading_dot, long int start, lin num)
<  {
<    fputs (".\n", outputfile);
<    if (leading_dot)
---
>    for (f = 0; f < 2; f++)
4312,4598c68,73
<        if (num == 1)
< -	fprintf (outputfile, "%"pI"ds/^\\.//\n", start);
< +	fprintf (outputfile, "%lds/^\\.//\n", start);
<        else
< -	fprintf (outputfile, "%"pI"d,%"pI"ds/^\\.//\n", start, start + num - 1);
< +	fprintf (outputfile, "%ld,%lds/^\\.//\n", start, start + num - 1);
<      }
<  }
<  
< @@ -1520,7 +1475,7 @@ undotlines (FILE *outputfile, bool leadi
<     around the problems involved with changing line numbers in an ed
<     script.
<  
< -   As in 'output_diff3', the variable MAPPING maps from file number
< +   As in `output_diff3', the variable MAPPING maps from file number
<     according to the argument list to file number according to the diff
<     passed.  All files listed below are in terms of the argument list.
<     REV_MAPPING is the inverse of MAPPING.
< @@ -1549,7 +1504,7 @@ output_diff3_edscript (FILE *outputfile,
<  	   ? DIFF_ALL
<  	   : DIFF_1ST + rev_mapping[b->correspond - DIFF_1ST]);
<  
< -      printint low0, high0;
< +      long int low0, high0;
<  
<        /* If we aren't supposed to do this output block, skip it.  */
<        switch (type)
< @@ -1570,7 +1525,7 @@ output_diff3_edscript (FILE *outputfile,
<  
<  	  /* Mark end of conflict.  */
<  
< -	  fprintf (outputfile, "%"pI"da\n", high0);
< +	  fprintf (outputfile, "%lda\n", high0);
<  	  leading_dot = false;
<  	  if (type == DIFF_ALL)
<  	    {
< @@ -1592,7 +1547,7 @@ output_diff3_edscript (FILE *outputfile,
<  
<  	  /* Mark start of conflict.  */
<  
< -	  fprintf (outputfile, "%"pI"da\n<<<<<<< %s\n", low0 - 1,
< +	  fprintf (outputfile, "%lda\n<<<<<<< %s\n", low0 - 1,
<  		   type == DIFF_ALL ? file0 : file1);
<  	  leading_dot = false;
<  	  if (type == DIFF_2ND)
< @@ -1608,9 +1563,9 @@ output_diff3_edscript (FILE *outputfile,
<  	/* Write out a delete */
<  	{
<  	  if (low0 == high0)
< -	    fprintf (outputfile, "%"pI"dd\n", low0);
< +	    fprintf (outputfile, "%ldd\n", low0);
<  	  else
< -	    fprintf (outputfile, "%"pI"d,%"pI"dd\n", low0, high0);
< +	    fprintf (outputfile, "%ld,%ldd\n", low0, high0);
<  	}
<        else
<  	/* Write out an add or change */
< @@ -1618,13 +1573,13 @@ output_diff3_edscript (FILE *outputfile,
<  	  switch (high0 - low0)
<  	    {
<  	    case -1:
< -	      fprintf (outputfile, "%"pI"da\n", high0);
< +	      fprintf (outputfile, "%lda\n", high0);
<  	      break;
<  	    case 0:
< -	      fprintf (outputfile, "%"pI"dc\n", high0);
< +	      fprintf (outputfile, "%ldc\n", high0);
<  	      break;
<  	    default:
< -	      fprintf (outputfile, "%"pI"d,%"pI"dc\n", low0, high0);
< +	      fprintf (outputfile, "%ld,%ldc\n", low0, high0);
<  	      break;
<  	    }
<  
< @@ -1776,15 +1731,17 @@ reverse_diff3_blocklist (struct diff3_bl
<  
<    return prev;
<  }
< -
< +
<  static void
<  fatal (char const *msgid)
<  {
< -  die (EXIT_TROUBLE, 0, "%s", _(msgid));
< +  error (EXIT_TROUBLE, 0, "%s", _(msgid));
< +  abort ();
<  }
<  
<  static void
<  perror_with_exit (char const *string)
<  {
< -  die (EXIT_TROUBLE, errno, "%s", string);
< +  error (EXIT_TROUBLE, errno, "%s", string);
< +  abort ();
<  }
< Only in diffutils-3.0-patch/src: diff3.o
< diff -pru diffutils-3.0/src/diff.c diffutils-3.0-patch/src/diff.c
< --- diffutils-3.0/src/diff.c	2020-03-01 22:03:00.451726000 -0800
< +++ diffutils-3.0-patch/src/diff.c	2020-03-01 16:21:10.675918000 -0800
< @@ -1,7 +1,7 @@
<  /* diff - compare files line by line
<  
<     Copyright (C) 1988-1989, 1992-1994, 1996, 1998, 2001-2002, 2004, 2006-2007,
< -   2009-2013, 2015-2017 Free Software Foundation, Inc.
< +   2009-2010 Free Software Foundation, Inc.
<  
<     This file is part of GNU DIFF.
<  
< @@ -20,7 +20,6 @@
<  
<  #define GDIFF_MAIN
<  #include "diff.h"
< -#include "die.h"
<  #include <assert.h>
<  #include "paths.h"
<  #include <c-stack.h>
< @@ -28,7 +27,6 @@
<  #include <error.h>
<  #include <exclude.h>
<  #include <exitfail.h>
< -#include <filenamecat.h>
<  #include <file-type.h>
<  #include <fnmatch.h>
<  #include <getopt.h>
< @@ -40,10 +38,9 @@
<  #include <timespec.h>
<  #include <version-etc.h>
<  #include <xalloc.h>
< -#include <xreadlink.h>
< -#include <binary-io.h>
< +#include <xfreopen.h>
<  
< -/* The official name of this program (e.g., no 'g' prefix).  */
< +/* The official name of this program (e.g., no `g' prefix).  */
<  #define PROGRAM_NAME "diff"
<  
<  #define AUTHORS \
< @@ -60,9 +57,9 @@
<  struct regexp_list
<  {
<    char *regexps;	/* chars representing disjunction of the regexps */
< -  size_t len;		/* chars used in 'regexps' */
< -  size_t size;		/* size malloc'ed for 'regexps'; 0 if not malloc'ed */
< -  bool multiple_regexps;/* Does 'regexps' represent a disjunction?  */
< +  size_t len;		/* chars used in `regexps' */
< +  size_t size;		/* size malloc'ed for `regexps'; 0 if not malloc'ed */
< +  bool multiple_regexps;/* Does `regexps' represent a disjunction?  */
<    struct re_pattern_buffer *buf;
<  };
<  
< @@ -71,7 +68,6 @@ static void add_regexp (struct regexp_li
<  static void summarize_regexp_list (struct regexp_list *);
<  static void specify_style (enum output_style);
<  static void specify_value (char const **, char const *, char const *);
< -static void specify_colors_style (char const *);
<  static void try_help (char const *, char const *) __attribute__((noreturn));
<  static void check_stdout (void);
<  static void usage (void);
< @@ -94,11 +90,15 @@ static bool binary;
<  enum { binary = true };
<  #endif
<  
< -/* If one file is missing, treat it as present but empty (-N).  */
< +/* When comparing directories, if a file appears only in one
< +   directory, treat it as present but empty in the other (-N).
< +   Then `patch' would create the file with appropriate contents.  */
<  static bool new_file;
<  
< -/* If the first file is missing, treat it as present but empty
< -   (--unidirectional-new-file).  */
< +/* When comparing directories, if a file appears only in the second
< +   directory of the two, treat it as present but empty in the other
< +   (--unidirectional-new-file).
< +   Then `patch' would create the file with appropriate contents.  */
<  static bool unidirectional_new_file;
<  
<  /* Report files compared that are the same (-s).
< @@ -106,7 +106,7 @@ static bool unidirectional_new_file;
<  static bool report_identical_files;
<  
<  static char const shortopts[] =
< -"0123456789abBcC:dD:eEfF:hHiI:lL:nNpPqrsS:tTuU:vwW:x:X:yZ";
< +"0123456789abBcC:dD:eEfF:hHiI:lL:nNpPqrsS:tTuU:vwW:x:X:y";
<  
<  /* Values for long options that do not have single-letter equivalents.  */
<  enum
< @@ -119,7 +119,6 @@ enum
<    INHIBIT_HUNK_MERGE_OPTION,
<    LEFT_COLUMN_OPTION,
<    LINE_FORMAT_OPTION,
< -  NO_DEREFERENCE_OPTION,
<    NO_IGNORE_FILE_NAME_CASE_OPTION,
<    NORMAL_OPTION,
<    SDIFF_MERGE_ASSIST_OPTION,
< @@ -138,12 +137,7 @@ enum
<    UNCHANGED_GROUP_FORMAT_OPTION,
<    OLD_GROUP_FORMAT_OPTION,
<    NEW_GROUP_FORMAT_OPTION,
< -  CHANGED_GROUP_FORMAT_OPTION,
< -
< -  COLOR_OPTION,
< -  COLOR_PALETTE_OPTION,
< -
< -  PRESUME_OUTPUT_TTY_OPTION,
< +  CHANGED_GROUP_FORMAT_OPTION
<  };
<  
<  static char const group_format_option[][sizeof "--unchanged-group-format"] =
< @@ -166,7 +160,6 @@ static struct option const longopts[] =
<    {"binary", 0, 0, BINARY_OPTION},
<    {"brief", 0, 0, 'q'},
<    {"changed-group-format", 1, 0, CHANGED_GROUP_FORMAT_OPTION},
< -  {"color", 2, 0, COLOR_OPTION},
<    {"context", 2, 0, 'C'},
<    {"ed", 0, 0, 'e'},
<    {"exclude", 1, 0, 'x'},
< @@ -184,7 +177,6 @@ static struct option const longopts[] =
<    {"ignore-matching-lines", 1, 0, 'I'},
<    {"ignore-space-change", 0, 0, 'b'},
<    {"ignore-tab-expansion", 0, 0, 'E'},
< -  {"ignore-trailing-space", 0, 0, 'Z'},
<    {"inhibit-hunk-merge", 0, 0, INHIBIT_HUNK_MERGE_OPTION},
<    {"initial-tab", 0, 0, 'T'},
<    {"label", 1, 0, 'L'},
< @@ -194,13 +186,11 @@ static struct option const longopts[] =
<    {"new-file", 0, 0, 'N'},
<    {"new-group-format", 1, 0, NEW_GROUP_FORMAT_OPTION},
<    {"new-line-format", 1, 0, NEW_LINE_FORMAT_OPTION},
< -  {"no-dereference", 0, 0, NO_DEREFERENCE_OPTION},
<    {"no-ignore-file-name-case", 0, 0, NO_IGNORE_FILE_NAME_CASE_OPTION},
<    {"normal", 0, 0, NORMAL_OPTION},
<    {"old-group-format", 1, 0, OLD_GROUP_FORMAT_OPTION},
<    {"old-line-format", 1, 0, OLD_LINE_FORMAT_OPTION},
<    {"paginate", 0, 0, 'l'},
< -  {"palette", 1, 0, COLOR_PALETTE_OPTION},
<    {"rcs", 0, 0, 'n'},
<    {"recursive", 0, 0, 'r'},
<    {"report-identical-files", 0, 0, 's'},
< @@ -222,9 +212,6 @@ static struct option const longopts[] =
<    {"unified", 2, 0, 'U'},
<    {"version", 0, 0, 'v'},
<    {"width", 1, 0, 'W'},
< -
< -  /* This is solely for testing.  Do not document.  */
< -  {"-presume-output-tty", no_argument, NULL, PRESUME_OUTPUT_TTY_OPTION},
<    {0, 0, 0, 0}
<  };
<  
< @@ -296,7 +283,6 @@ main (int argc, char **argv)
<    ignore_regexp_list.buf = &ignore_regexp;
<    re_set_syntax (RE_SYNTAX_GREP | RE_NO_POSIX_BACKTRACKING);
<    excluded = new_exclude ();
< -  presume_output_tty = false;
<  
<    /* Decode the options.  */
<  
< @@ -317,12 +303,11 @@ main (int argc, char **argv)
<  	case '7':
<  	case '8':
<  	case '9':
< -	  ocontext = (! ISDIGIT (prev)
< -		      ? c - '0'
< -		      : (ocontext - (c - '0' <= CONTEXT_MAX % 10)
< -			 < CONTEXT_MAX / 10)
< -		      ? 10 * ocontext + (c - '0')
< -		      : CONTEXT_MAX);
< +	  if (! ISDIGIT (prev))
< +	    ocontext = c - '0';
< +	  else if (LIN_MAX / 10 < ocontext
< +		   || ((ocontext = 10 * ocontext + c - '0') < 0))
< +	    ocontext = LIN_MAX;
<  	  break;
<  
<  	case 'a':
< @@ -334,11 +319,6 @@ main (int argc, char **argv)
<  	    ignore_white_space = IGNORE_SPACE_CHANGE;
<  	  break;
<  
< -	case 'Z':
< -	  if (ignore_white_space < IGNORE_SPACE_CHANGE)
< -	    ignore_white_space |= IGNORE_TRAILING_SPACE;
< -	  break;
< -
<  	case 'B':
<  	  ignore_blank_lines = true;
<  	  break;
< @@ -351,8 +331,8 @@ main (int argc, char **argv)
---
> diff --git a/src/diff.c b/src/diff.c
> index cc1b611..256a984 100644
> --- a/src/diff.c
> +++ b/src/diff.c
> @@ -330,7 +330,7 @@ main (int argc, char **argv)
>  	      {
4601,4605c76,79
<  		  try_help ("invalid context length '%s'", optarg);
< -		if (CONTEXT_MAX < numval)
< -		  numval = CONTEXT_MAX;
< +		if (LIN_MAX < numval)
< +		  numval = LIN_MAX;
---
> -		  try_help ("invalid context length `%s'", optarg);
> +		  try_help ("invalid context length '%s'", optarg);
>  		if (LIN_MAX < numval)
>  		  numval = LIN_MAX;
4607,4647c81,96
<  	    else
<  	      numval = 3;
< @@ -400,8 +380,8 @@ main (int argc, char **argv)
<  	  break;
<  
<  	case 'E':
< -	  if (ignore_white_space < IGNORE_SPACE_CHANGE)
< -	    ignore_white_space |= IGNORE_TAB_EXPANSION;
< +	  if (ignore_white_space < IGNORE_TAB_EXPANSION)
< +	    ignore_white_space = IGNORE_TAB_EXPANSION;
<  	  break;
<  
<  	case 'f':
< @@ -499,7 +479,7 @@ main (int argc, char **argv)
<  	  break;
<  
<  	case 'v':
< -	  version_etc (stdout, PROGRAM_NAME, PACKAGE_NAME, Version,
< +	  version_etc (stdout, PROGRAM_NAME, PACKAGE_NAME, PACKAGE_VERSION,
<  		       AUTHORS, (char *) NULL);
<  	  check_stdout ();
<  	  return EXIT_SUCCESS;
< @@ -538,7 +518,7 @@ main (int argc, char **argv)
<  #if O_BINARY
<  	  binary = true;
<  	  if (! isatty (STDOUT_FILENO))
< -	    set_binary_mode (STDOUT_FILENO, O_BINARY);
< +	    xfreopen (NULL, "wb", stdout);
<  #endif
<  	  break;
<  
< @@ -577,10 +557,6 @@ main (int argc, char **argv)
<  	    specify_value (&line_format[i], optarg, "--line-format");
<  	  break;
<  
< -	case NO_DEREFERENCE_OPTION:
< -	  no_dereference_symlinks = true;
< -	  break;
< -
<  	case NO_IGNORE_FILE_NAME_CASE_OPTION:
<  	  ignore_file_name_case = false;
---
> @@ -505,7 +505,7 @@ main (int argc, char **argv)
>  	case 'W':
>  	  numval = strtoumax (optarg, &numend, 10);
>  	  if (! (0 < numval && numval <= SIZE_MAX) || *numend)
> -	    try_help ("invalid width `%s'", optarg);
> +	    try_help ("invalid width '%s'", optarg);
>  	  if (width != numval)
>  	    {
>  	      if (width)
> @@ -534,7 +534,7 @@ main (int argc, char **argv)
>  	case HORIZON_LINES_OPTION:
>  	  numval = strtoumax (optarg, &numend, 10);
>  	  if (*numend)
> -	    try_help ("invalid horizon length `%s'", optarg);
> +	    try_help ("invalid horizon length '%s'", optarg);
>  	  horizon_lines = MAX (horizon_lines, MIN (numval, LIN_MAX));
4649d97
< @@ -608,8 +584,7 @@ main (int argc, char **argv)
4650a99
> @@ -585,7 +585,7 @@ main (int argc, char **argv)
4653,4656c102,104
< -	  if (! (0 < numval && numval <= SIZE_MAX - GUTTER_WIDTH_MINIMUM)
< -	      || *numend)
< +	  if (! (0 < numval && numval <= SIZE_MAX) || *numend)
<  	    try_help ("invalid tabsize '%s'", optarg);
---
>  	  if (! (0 < numval && numval <= SIZE_MAX) || *numend)
> -	    try_help ("invalid tabsize `%s'", optarg);
> +	    try_help ("invalid tabsize '%s'", optarg);
4659,4711c107,117
< @@ -640,31 +615,12 @@ main (int argc, char **argv)
<  	  specify_value (&group_format[c], optarg, group_format_option[c]);
<  	  break;
<  
< -	case COLOR_OPTION:
< -	  specify_colors_style (optarg);
< -	  break;
< -
< -	case COLOR_PALETTE_OPTION:
< -	  set_color_palette (optarg);
< -	  break;
< -
< -        case PRESUME_OUTPUT_TTY_OPTION:
< -          presume_output_tty = true;
< -          break;
< -
<  	default:
<  	  try_help (NULL, NULL);
<  	}
<        prev = c;
<      }
<  
< -  if (colors_style == AUTO)
< -    {
< -      char const *t = getenv ("TERM");
< -      if (t && STREQ (t, "dumb"))
< -        colors_style = NEVER;
< -    }
< -
<    if (output_style == OUTPUT_UNSPECIFIED)
<      {
<        if (show_c_function)
< @@ -715,14 +671,10 @@ main (int argc, char **argv)
<  		a half line plus a gutter is an integral number of tabs,
<  		so that tabs in the right column line up.  */
<  
< -    size_t t = expand_tabs ? 1 : tabsize;
< -    size_t w = width;
< -    size_t t_plus_g = t + GUTTER_WIDTH_MINIMUM;
< -    size_t unaligned_off = (w >> 1) + (t_plus_g >> 1) + (w & t_plus_g & 1);
< -    size_t off = unaligned_off - unaligned_off % t;
< -    sdiff_half_width = (off <= GUTTER_WIDTH_MINIMUM || w <= off
< -			? 0
< -			: MIN (off - GUTTER_WIDTH_MINIMUM, w - off));
< +    intmax_t t = expand_tabs ? 1 : tabsize;
< +    intmax_t w = width;
< +    intmax_t off = (w + t + GUTTER_WIDTH_MINIMUM) / (2 * t)  *  t;
< +    sdiff_half_width = MAX (0, MIN (off - GUTTER_WIDTH_MINIMUM, w - off)),
<      sdiff_column2_offset = sdiff_half_width ? off : w;
<    }
<  
< @@ -818,7 +770,7 @@ add_regexp (struct regexp_list *reglist,
<    char const *m = re_compile_pattern (pattern, patlen, reglist->buf);
---
>  	      if (tabsize)
> @@ -744,9 +744,9 @@ main (int argc, char **argv)
>  	  if (argc - optind != 2)
>  	    {
>  	      if (argc - optind < 2)
> -		try_help ("missing operand after `%s'", argv[argc - 1]);
> +		try_help ("missing operand after '%s'", argv[argc - 1]);
>  	      else
> -		try_help ("extra operand `%s'", argv[optind + 2]);
> +		try_help ("extra operand '%s'", argv[optind + 2]);
>  	    }
4713,4728c119,120
<    if (m != 0)
< -    error (EXIT_TROUBLE, 0, "%s: %s", pattern, m);
< +    error (0, 0, "%s: %s", pattern, m);
<    else
<      {
<        char *regexps = reglist->regexps;
< @@ -864,7 +816,7 @@ summarize_regexp_list (struct regexp_lis
<  	  char const *m = re_compile_pattern (reglist->regexps, reglist->len,
<  					      reglist->buf);
<  	  if (m)
< -	    die (EXIT_TROUBLE, 0, "%s: %s", reglist->regexps, m);
< +	    error (EXIT_TROUBLE, 0, "%s: %s", reglist->regexps, m);
<  	}
<      }
<  }
< @@ -874,8 +826,9 @@ try_help (char const *reason_msgid, char
---
>  	  exit_status = compare_files (NULL, argv[optind], argv[optind + 1]);
> @@ -826,7 +826,7 @@ try_help (char const *reason_msgid, char const *operand)
4732c124
< -  die (EXIT_TROUBLE, 0, _("Try '%s --help' for more information."),
---
> -  error (EXIT_TROUBLE, 0, _("Try `%s --help' for more information."),
4735,4739c127
< +  abort ();
<  }
<  
<  static void
< @@ -888,65 +841,41 @@ check_stdout (void)
---
>    abort ();
4741,4824c129,133
<  
<  static char const * const option_help_msgid[] = {
< -  N_("    --normal                  output a normal diff (the default)"),
< -  N_("-q, --brief                   report only when files differ"),
< -  N_("-s, --report-identical-files  report when two files are the same"),
< -  N_("-c, -C NUM, --context[=NUM]   output NUM (default 3) lines of copied context"),
< -  N_("-u, -U NUM, --unified[=NUM]   output NUM (default 3) lines of unified context"),
< -  N_("-e, --ed                      output an ed script"),
< -  N_("-n, --rcs                     output an RCS format diff"),
< -  N_("-y, --side-by-side            output in two columns"),
< -  N_("-W, --width=NUM               output at most NUM (default 130) print columns"),
< -  N_("    --left-column             output only the left column of common lines"),
< -  N_("    --suppress-common-lines   do not output common lines"),
< -  "",
< -  N_("-p, --show-c-function         show which C function each change is in"),
< -  N_("-F, --show-function-line=RE   show the most recent line matching RE"),
< -  N_("    --label LABEL             use LABEL instead of file name and timestamp\n"
< -     "                                (can be repeated)"),
< -  "",
< -  N_("-t, --expand-tabs             expand tabs to spaces in output"),
< -  N_("-T, --initial-tab             make tabs line up by prepending a tab"),
< -  N_("    --tabsize=NUM             tab stops every NUM (default 8) print columns"),
< -  N_("    --suppress-blank-empty    suppress space or tab before empty output lines"),
< -  N_("-l, --paginate                pass output through 'pr' to paginate it"),
< -  "",
< -  N_("-r, --recursive                 recursively compare any subdirectories found"),
< -  N_("    --no-dereference            don't follow symbolic links"),
< -  N_("-N, --new-file                  treat absent files as empty"),
< -  N_("    --unidirectional-new-file   treat absent first files as empty"),
< -  N_("    --ignore-file-name-case     ignore case when comparing file names"),
< -  N_("    --no-ignore-file-name-case  consider case when comparing file names"),
< -  N_("-x, --exclude=PAT               exclude files that match PAT"),
< -  N_("-X, --exclude-from=FILE         exclude files that match any pattern in FILE"),
< -  N_("-S, --starting-file=FILE        start with FILE when comparing directories"),
< -  N_("    --from-file=FILE1           compare FILE1 to all operands;\n"
< -     "                                  FILE1 can be a directory"),
< -  N_("    --to-file=FILE2             compare all operands to FILE2;\n"
< -     "                                  FILE2 can be a directory"),
< -  "",
< -  N_("-i, --ignore-case               ignore case differences in file contents"),
< -  N_("-E, --ignore-tab-expansion      ignore changes due to tab expansion"),
< -  N_("-Z, --ignore-trailing-space     ignore white space at line end"),
< -  N_("-b, --ignore-space-change       ignore changes in the amount of white space"),
< -  N_("-w, --ignore-all-space          ignore all white space"),
< -  N_("-B, --ignore-blank-lines        ignore changes where lines are all blank"),
< -  N_("-I, --ignore-matching-lines=RE  ignore changes where all lines match RE"),
< +  N_("Compare files line by line."),
<    "",
< -  N_("-a, --text                      treat all files as text"),
< -  N_("    --strip-trailing-cr         strip trailing carriage return on input"),
< +  N_("-i  --ignore-case  Ignore case differences in file contents."),
< +  N_("--ignore-file-name-case  Ignore case when comparing file names."),
< +  N_("--no-ignore-file-name-case  Consider case when comparing file names."),
< +  N_("-E  --ignore-tab-expansion  Ignore changes due to tab expansion."),
< +  N_("-b  --ignore-space-change  Ignore changes in the amount of white space."),
< +  N_("-w  --ignore-all-space  Ignore all white space."),
< +  N_("-B  --ignore-blank-lines  Ignore changes whose lines are all blank."),
< +  N_("-I RE  --ignore-matching-lines=RE  Ignore changes whose lines all match RE."),
< +  N_("--strip-trailing-cr  Strip trailing carriage return on input."),
<  #if O_BINARY
< -  N_("    --binary                    read and write data in binary mode"),
< +  N_("--binary  Read and write data in binary mode."),
<  #endif
< +  N_("-a  --text  Treat all files as text."),
<    "",
< -  N_("-D, --ifdef=NAME                output merged file with '#ifdef NAME' diffs"),
< -  N_("    --GTYPE-group-format=GFMT   format GTYPE input groups with GFMT"),
< -  N_("    --line-format=LFMT          format all input lines with LFMT"),
< -  N_("    --LTYPE-line-format=LFMT    format LTYPE input lines with LFMT"),
< -  N_("  These format options provide fine-grained control over the output\n"
< -     "    of diff, generalizing -D/--ifdef."),
< +  N_("-c  -C NUM  --context[=NUM]  Output NUM (default 3) lines of copied context.\n\
< +-u  -U NUM  --unified[=NUM]  Output NUM (default 3) lines of unified context.\n\
< +  --label LABEL  Use LABEL instead of file name.\n\
< +  -p  --show-c-function  Show which C function each change is in.\n\
< +  -F RE  --show-function-line=RE  Show the most recent line matching RE."),
< +  N_("-q  --brief  Output only whether files differ."),
< +  N_("-e  --ed  Output an ed script."),
< +  N_("--normal  Output a normal diff."),
< +  N_("-n  --rcs  Output an RCS format diff."),
< +  N_("-y  --side-by-side  Output in two columns.\n\
< +  -W NUM  --width=NUM  Output at most NUM (default 130) print columns.\n\
< +  --left-column  Output only the left column of common lines.\n\
< +  --suppress-common-lines  Do not output common lines."),
---
> @@ -870,11 +870,11 @@ static char const * const option_help_msgid[] = {
>    -W NUM  --width=NUM  Output at most NUM (default 130) print columns.\n\
>    --left-column  Output only the left column of common lines.\n\
>    --suppress-common-lines  Do not output common lines."),
> -  N_("-D NAME  --ifdef=NAME  Output merged file to show `#ifdef NAME' diffs."),
4826,4831c135,140
< +  N_("--GTYPE-group-format=GFMT  Similar, but format GTYPE input groups with GFMT."),
< +  N_("--line-format=LFMT  Similar, but format all input lines with LFMT."),
< +  N_("--LTYPE-line-format=LFMT  Similar, but format LTYPE input lines with LFMT."),
<    N_("  LTYPE is 'old', 'new', or 'unchanged'.  GTYPE is LTYPE or 'changed'."),
< -  N_("  GFMT (only) may contain:\n\
< +  N_("  GFMT may contain:\n\
---
>    N_("--GTYPE-group-format=GFMT  Similar, but format GTYPE input groups with GFMT."),
>    N_("--line-format=LFMT  Similar, but format all input lines with LFMT."),
>    N_("--LTYPE-line-format=LFMT  Similar, but format LTYPE input lines with LFMT."),
> -  N_("  LTYPE is `old', `new', or `unchanged'.  GTYPE is LTYPE or `changed'."),
> +  N_("  LTYPE is 'old', 'new', or 'unchanged'.  GTYPE is LTYPE or 'changed'."),
>    N_("  GFMT may contain:\n\
4834,4849c143
<      %=  lines common to FILE1 and FILE2\n\
< @@ -956,31 +885,41 @@ static char const * const option_help_ms
<          L  last line number\n\
<          N  number of lines = L-F+1\n\
<          E  F-1\n\
< -        M  L+1\n\
< -    %(A=B?T:E)  if A equals B then T else E"),
< -  N_("  LFMT (only) may contain:\n\
< +        M  L+1"),
< +  N_("  LFMT may contain:\n\
<      %L  contents of line\n\
<      %l  contents of line, excluding any trailing newline\n\
<      %[-][WIDTH][.[PREC]]{doxX}n  printf-style spec for input line number"),
< -  N_("  Both GFMT and LFMT may contain:\n\
< +  N_("  Either GFMT or LFMT may contain:\n\
<      %%  %\n\
---
> @@ -895,7 +895,7 @@ static char const * const option_help_msgid[] = {
4851,4853c145
< -    %c'\\OOO'  the character with octal code OOO\n\
< -    C    the character C (other characters represent themselves)"),
< +    %c'\\OOO'  the character with octal code OOO"),
---
>      %c'\\OOO'  the character with octal code OOO"),
4855,4861c147
< -  N_("-d, --minimal            try hard to find a smaller set of changes"),
< -  N_("    --horizon-lines=NUM  keep NUM lines of the common prefix and suffix"),
< -  N_("    --speed-large-files  assume large files and many scattered small changes"),
< -  N_("    --color[=WHEN]       colorize the output; WHEN can be 'never', 'always',\n"
< -     "                           or 'auto' (the default)"),
< -  N_("    --palette=PALETTE    the colors to use when --color is active; PALETTE is\n"
< -     "                           a colon-separated list of terminfo capabilities"),
---
> -  N_("-l  --paginate  Pass the output through `pr' to paginate it."),
4863,4878c149,154
< +  N_("-t  --expand-tabs  Expand tabs to spaces in output."),
< +  N_("-T  --initial-tab  Make tabs line up by prepending a tab."),
< +  N_("--tabsize=NUM  Tab stops are every NUM (default 8) print columns."),
< +  N_("--suppress-blank-empty  Suppress space or tab before empty output lines."),
<    "",
< -  N_("    --help               display this help and exit"),
< -  N_("-v, --version            output version information and exit"),
< +  N_("-r  --recursive  Recursively compare any subdirectories found."),
< +  N_("-N  --new-file  Treat absent files as empty."),
< +  N_("--unidirectional-new-file  Treat absent first files as empty."),
< +  N_("-s  --report-identical-files  Report when two files are the same."),
< +  N_("-x PAT  --exclude=PAT  Exclude files that match PAT."),
< +  N_("-X FILE  --exclude-from=FILE  Exclude files that match any pattern in FILE."),
< +  N_("-S FILE  --starting-file=FILE  Start with FILE when comparing directories."),
< +  N_("--from-file=FILE1  Compare FILE1 to all operands.  FILE1 can be a directory."),
< +  N_("--to-file=FILE2  Compare all operands to FILE2.  FILE2 can be a directory."),
---
>    N_("-t  --expand-tabs  Expand tabs to spaces in output."),
>    N_("-T  --initial-tab  Make tabs line up by prepending a tab."),
>    N_("--tabsize=NUM  Tab stops are every NUM (default 8) print columns."),
> @@ -918,9 +918,9 @@ static char const * const option_help_msgid[] = {
>    N_("-v  --version  Output version info."),
>    N_("--help  Output this help."),
4880,4888c156
< -  N_("FILES are 'FILE1 FILE2' or 'DIR1 DIR2' or 'DIR FILE' or 'FILE DIR'."),
< -  N_("If --from-file or --to-file is given, there are no restrictions on FILE(s)."),
< +  N_("--horizon-lines=NUM  Keep NUM lines of the common prefix and suffix."),
< +  N_("-d  --minimal  Try hard to find a smaller set of changes."),
< +  N_("--speed-large-files  Assume large files and many scattered small changes."),
< +  "",
< +  N_("-v  --version  Output version info."),
< +  N_("--help  Output this help."),
< +  "",
---
> -  N_("FILES are `FILE1 FILE2' or `DIR1 DIR2' or `DIR FILE...' or `FILE... DIR'."),
4890,4891c158,160
< +  N_("If --from-file or --to-file is given, there are no restrictions on FILES."),
<    N_("If a FILE is '-', read standard input."),
---
>    N_("If --from-file or --to-file is given, there are no restrictions on FILES."),
> -  N_("If a FILE is `-', read standard input."),
> +  N_("If a FILE is '-', read standard input."),
4894,4908c163,164
< @@ -992,11 +931,6 @@ usage (void)
<    char const * const *p;
<  
<    printf (_("Usage: %s [OPTION]... FILES\n"), program_name);
< -  printf ("%s\n\n", _("Compare FILES line by line."));
< -
< -  fputs (_("\
< -Mandatory arguments to long options are mandatory for short options too.\n\
< -"), stdout);
<  
<    for (p = option_help_msgid;  *p;  p++)
<      {
< @@ -1024,7 +958,7 @@ Mandatory arguments to long options are
<  static void
<  specify_value (char const **var, char const *value, char const *option)
---
>  };
> @@ -960,7 +960,7 @@ specify_value (char const **var, char const *value, char const *option)
4910,4911c166
< -  if (*var && ! STREQ (*var, value))
< +  if (*var && strcmp (*var, value) != 0)
---
>    if (*var && strcmp (*var, value) != 0)
4913c168,169
<        error (0, 0, _("conflicting %s option value '%s'"), option, value);
---
> -      error (0, 0, _("conflicting %s option value `%s'"), option, value);
> +      error (0, 0, _("conflicting %s option value '%s'"), option, value);
4915,4970d170
< @@ -1043,21 +977,6 @@ specify_style (enum output_style style)
<        output_style = style;
<      }
<  }
< -
< -/* Set the color mode.  */
< -static void
< -specify_colors_style (char const *value)
< -{
< -  if (value == NULL || STREQ (value, "auto"))
< -    colors_style = AUTO;
< -  else if (STREQ (value, "always"))
< -    colors_style = ALWAYS;
< -  else if (STREQ (value, "never"))
< -    colors_style = NEVER;
< -  else
< -    try_help ("invalid color '%s'", value);
< -}
< -
<  
<  /* Set the last-modified time of *ST to be the current time.  */
<  
< @@ -1148,9 +1067,9 @@ compare_files (struct comparison const *
<    else
<      {
<        cmp.file[0].name = free0
< -	= file_name_concat (parent->file[0].name, name0, NULL);
< +	= dir_file_pathname (parent->file[0].name, name0);
<        cmp.file[1].name = free1
< -	= file_name_concat (parent->file[1].name, name1, NULL);
< +	= dir_file_pathname (parent->file[1].name, name1);
<      }
<  
<    /* Stat the files.  */
< @@ -1167,8 +1086,8 @@ compare_files (struct comparison const *
<  	  else if (STREQ (cmp.file[f].name, "-"))
<  	    {
<  	      cmp.file[f].desc = STDIN_FILENO;
< -	      if (binary && ! isatty (STDIN_FILENO))
< -		set_binary_mode (STDIN_FILENO, O_BINARY);
< +	      if (O_BINARY && binary && ! isatty (STDIN_FILENO))
< +		xfreopen (NULL, "rb", stdin);
<  	      if (fstat (STDIN_FILENO, &cmp.file[f].stat) != 0)
<  		cmp.file[f].desc = ERRNO_ENCODE (errno);
<  	      else
< @@ -1188,10 +1107,7 @@ compare_files (struct comparison const *
<  		  set_mtime_to_now (&cmp.file[f].stat);
<  		}
<  	    }
< -	  else if ((no_dereference_symlinks
< -		    ? lstat (cmp.file[f].name, &cmp.file[f].stat)
< -		    : stat (cmp.file[f].name, &cmp.file[f].stat))
< -		   != 0)
< +	  else if (stat (cmp.file[f].name, &cmp.file[f].stat) != 0)
<  	    cmp.file[f].desc = ERRNO_ENCODE (errno);
<  	}
4972,4991c172,174
< @@ -1207,11 +1123,9 @@ compare_files (struct comparison const *
<  	    ? (S_ISREG (cmp.file[f].stat.st_mode)
<  	       && ! (cmp.file[f].stat.st_mode & (S_IRWXU | S_IRWXG | S_IRWXO))
<  	       && cmp.file[f].stat.st_size == 0)
< -	    : ((cmp.file[f].desc == ERRNO_ENCODE (ENOENT)
< -		|| cmp.file[f].desc == ERRNO_ENCODE (EBADF))
< +	    : (cmp.file[f].desc == ERRNO_ENCODE (ENOENT)
<  	       && ! parent
< -	       && (cmp.file[1 - f].desc == UNOPENED
< -		   || cmp.file[1 - f].desc == STDIN_FILENO))))
< +	       && cmp.file[1 - f].desc == UNOPENED)))
<        cmp.file[f].desc = NONEXISTENT;
<  
<    for (f = 0; f < 2; f++)
< @@ -1242,15 +1156,12 @@ compare_files (struct comparison const *
<        char const *fnm = cmp.file[fnm_arg].name;
<        char const *dir = cmp.file[dir_arg].name;
<        char const *filename = cmp.file[dir_arg].name = free0
< -	= find_dir_file_pathname (dir, last_component (fnm));
< +	= dir_file_pathname (dir, last_component (fnm));
---
>    *var = value;
> @@ -1159,7 +1159,7 @@ compare_files (struct comparison const *parent,
>  	= dir_file_pathname (dir, last_component (fnm));
4994,5167c177,178
<  	fatal ("cannot compare '-' to a directory");
<  
< -      if ((no_dereference_symlinks
< -	   ? lstat (filename, &cmp.file[dir_arg].stat)
< -	   : stat (filename, &cmp.file[dir_arg].stat))
< -	  != 0)
< +      if (stat (filename, &cmp.file[dir_arg].stat) != 0)
<  	{
<  	  perror_with_name (filename);
<  	  status = EXIT_TROUBLE;
< @@ -1297,10 +1208,8 @@ compare_files (struct comparison const *
<      }
<    else if ((DIR_P (0) | DIR_P (1))
<  	   || (parent
< -	       && !((S_ISREG (cmp.file[0].stat.st_mode)
< -		     || S_ISLNK (cmp.file[0].stat.st_mode))
< -		    && (S_ISREG (cmp.file[1].stat.st_mode)
< -			|| S_ISLNK  (cmp.file[1].stat.st_mode)))))
< +	       && (! S_ISREG (cmp.file[0].stat.st_mode)
< +		   || ! S_ISREG (cmp.file[1].stat.st_mode))))
<      {
<        if (cmp.file[0].desc == NONEXISTENT || cmp.file[1].desc == NONEXISTENT)
<  	{
< @@ -1341,62 +1250,10 @@ compare_files (struct comparison const *
<  	  status = EXIT_FAILURE;
<  	}
<      }
< -  else if (S_ISLNK (cmp.file[0].stat.st_mode)
< -	   || S_ISLNK (cmp.file[1].stat.st_mode))
< -    {
< -      /* We get here only if we use lstat(), not stat().  */
< -      assert (no_dereference_symlinks);
< -
< -      if (S_ISLNK (cmp.file[0].stat.st_mode)
< -	  && S_ISLNK (cmp.file[1].stat.st_mode))
< -	{
< -	  /* Compare the values of the symbolic links.  */
< -	  char *link_value[2] = { NULL, NULL };
< -
< -	  for (f = 0; f < 2; f++)
< -	    {
< -	      link_value[f] = xreadlink (cmp.file[f].name);
< -	      if (link_value[f] == NULL)
< -		{
< -		  perror_with_name (cmp.file[f].name);
< -		  status = EXIT_TROUBLE;
< -		  break;
< -		}
< -	    }
< -	  if (status == EXIT_SUCCESS)
< -	    {
< -	      if ( ! STREQ (link_value[0], link_value[1]))
< -		{
< -		  message ("Symbolic links %s and %s differ\n",
< -			   cmp.file[0].name, cmp.file[1].name);
< -		  /* This is a difference.  */
< -		  status = EXIT_FAILURE;
< -		}
< -	    }
< -	  for (f = 0; f < 2; f++)
< -	    free (link_value[f]);
< -	}
< -      else
< -	{
< -	  /* We have two files that are not to be compared, because
< -	     one of them is a symbolic link and the other one is not.  */
< -
< -	  message5 ("File %s is a %s while file %s is a %s\n",
< -		    file_label[0] ? file_label[0] : cmp.file[0].name,
< -		    file_type (&cmp.file[0].stat),
< -		    file_label[1] ? file_label[1] : cmp.file[1].name,
< -		    file_type (&cmp.file[1].stat));
< -
< -	  /* This is a difference.  */
< -	  status = EXIT_FAILURE;
< -	}
< -    }
<    else if (files_can_be_treated_as_binary
<  	   && S_ISREG (cmp.file[0].stat.st_mode)
<  	   && S_ISREG (cmp.file[1].stat.st_mode)
< -	   && cmp.file[0].stat.st_size != cmp.file[1].stat.st_size
< -	   && 0 < cmp.file[0].stat.st_size
< -	   && 0 < cmp.file[1].stat.st_size)
< +	   && cmp.file[0].stat.st_size != cmp.file[1].stat.st_size)
<      {
<        message ("Files %s and %s differ\n",
<  	       file_label[0] ? file_label[0] : cmp.file[0].name,
< diff -pru diffutils-3.0/src/diff.h diffutils-3.0-patch/src/diff.h
< --- diffutils-3.0/src/diff.h	2020-03-01 22:03:00.453728000 -0800
< +++ diffutils-3.0-patch/src/diff.h	2020-03-01 15:39:38.533600000 -0800
< @@ -1,7 +1,7 @@
<  /* Shared definitions for GNU DIFF
<  
< -   Copyright (C) 1988-1989, 1991-1995, 1998, 2001-2002, 2004, 2009-2013,
< -   2015-2017 Free Software Foundation, Inc.
< +   Copyright (C) 1988-1989, 1991-1995, 1998, 2001-2002, 2004, 2009-2010 Free
< +   Software Foundation, Inc.
<  
<     This file is part of GNU DIFF.
<  
< @@ -38,19 +38,6 @@ enum changes
<    /* Both deletes and inserts: a hunk containing both old and new lines.  */
<    CHANGED
<  };
< -
< -/* When colors should be used in the output.  */
< -enum colors_style
< -{
< -  /* Never output colors.  */
< -  NEVER,
< -
< -  /* Output colors if the output is a terminal.  */
< -  AUTO,
< -
< -  /* Always output colors.  */
< -  ALWAYS,
< -};
<  
<  /* Variables for command line options */
<  
< @@ -74,7 +61,7 @@ enum output_style
<    /* Output the differences in a unified context diff format (-u).  */
<    OUTPUT_UNIFIED,
<  
< -  /* Output the differences as commands suitable for 'ed' (-e).  */
< +  /* Output the differences as commands suitable for `ed' (-e).  */
<    OUTPUT_ED,
<  
<    /* Output the diff as a forward ed script (-f).  */
< @@ -96,9 +83,6 @@ enum output_style
<  
<  XTERN enum output_style output_style;
<  
< -/* Define the current color context used to print a line.  */
< -XTERN enum colors_style colors_style;
< -
<  /* Nonzero if output cannot be generated for identical files.  */
<  XTERN bool no_diff_means_no_output;
<  
< @@ -114,7 +98,7 @@ XTERN bool text;
<  XTERN lin horizon_lines;
<  
<  /* The significance of white space during comparisons.  */
< -enum DIFF_white_space
< +XTERN enum
<  {
<    /* All white space is significant (the default).  */
<    IGNORE_NO_WHITE_SPACE,
< @@ -122,21 +106,12 @@ enum DIFF_white_space
<    /* Ignore changes due to tab expansion (-E).  */
<    IGNORE_TAB_EXPANSION,
<  
< -  /* Ignore changes in trailing horizontal white space (-Z).  */
< -  IGNORE_TRAILING_SPACE,
< -
< -  /* IGNORE_TAB_EXPANSION and IGNORE_TRAILING_SPACE are a special case
< -     because they are independent and can be ORed together, yielding
< -     IGNORE_TAB_EXPANSION_AND_TRAILING_SPACE.  */
< -  IGNORE_TAB_EXPANSION_AND_TRAILING_SPACE,
< -
<    /* Ignore changes in horizontal white space (-b).  */
<    IGNORE_SPACE_CHANGE,
<  
<    /* Ignore all horizontal white space (-w).  */
<    IGNORE_ALL_SPACE
< -};
< -XTERN enum DIFF_white_space ignore_white_space;
< +} ignore_white_space;
<  
<  /* Ignore changes that affect only blank lines (-B).  */
<  XTERN bool ignore_blank_lines;
< @@ -151,11 +126,7 @@ XTERN bool ignore_case;
<  /* Ignore differences in case of letters in file names.  */
<  XTERN bool ignore_file_name_case;
---
> -	fatal ("cannot compare `-' to a directory");
> +	fatal ("cannot compare '-' to a directory");
5169,5340c180
< -/* Act on symbolic links themselves rather than on their target
< -   (--no-dereference).  */
< -XTERN bool no_dereference_symlinks;
< -
< -/* File labels for '-c' output headers (--label).  */
< +/* File labels for `-c' output headers (--label).  */
<  XTERN char *file_label[2];
<  
<  /* Regexp to identify function-header lines (-F).  */
< @@ -231,8 +202,8 @@ XTERN bool minimal;
<  /* The strftime format to use for time strings.  */
<  XTERN char const *time_format;
<  
< -/* The result of comparison is an "edit script": a chain of 'struct change'.
< -   Each 'struct change' represents one place where some lines are deleted
< +/* The result of comparison is an "edit script": a chain of `struct change'.
< +   Each `struct change' represents one place where some lines are deleted
<     and some are inserted.
<  
<     LINE0 and LINE1 are the first affected lines in the two files (origin 0).
< @@ -345,79 +316,58 @@ XTERN FILE *outfile;
<  /* Declare various functions.  */
<  
<  /* analyze.c */
< -extern int diff_2_files (struct comparison *);
< +int diff_2_files (struct comparison *);
<  
<  /* context.c */
< -extern void print_context_header (struct file_data[], char const * const *, bool);
< -extern void print_context_script (struct change *, bool);
< +void print_context_header (struct file_data[], bool);
< +void print_context_script (struct change *, bool);
<  
<  /* dir.c */
< -extern int diff_dirs (struct comparison const *,
< -                      int (*) (struct comparison const *,
< -                               char const *, char const *));
< -extern char *find_dir_file_pathname (char const *, char const *);
< +int diff_dirs (struct comparison const *, int (*) (struct comparison const *, char const *, char const *));
<  
<  /* ed.c */
< -extern void print_ed_script (struct change *);
< -extern void pr_forward_ed_script (struct change *);
< +void print_ed_script (struct change *);
< +void pr_forward_ed_script (struct change *);
<  
<  /* ifdef.c */
< -extern void print_ifdef_script (struct change *);
< +void print_ifdef_script (struct change *);
<  
<  /* io.c */
< -extern void file_block_read (struct file_data *, size_t);
< -extern bool read_files (struct file_data[], bool);
< +void file_block_read (struct file_data *, size_t);
< +bool read_files (struct file_data[], bool);
<  
<  /* normal.c */
< -extern void print_normal_script (struct change *);
< +void print_normal_script (struct change *);
<  
<  /* rcs.c */
< -extern void print_rcs_script (struct change *);
< +void print_rcs_script (struct change *);
<  
<  /* side.c */
< -extern void print_sdiff_script (struct change *);
< +void print_sdiff_script (struct change *);
<  
<  /* util.c */
<  extern char const change_letter[4];
<  extern char const pr_program[];
< -extern char *concat (char const *, char const *, char const *);
< -extern bool lines_differ (char const *, char const *) _GL_ATTRIBUTE_PURE;
< -extern lin translate_line_number (struct file_data const *, lin);
< -extern struct change *find_change (struct change *);
< -extern struct change *find_reverse_change (struct change *);
< -extern void *zalloc (size_t);
< -extern enum changes analyze_hunk (struct change *, lin *, lin *, lin *, lin *);
< -extern void begin_output (void);
< -extern void debug_script (struct change *);
< -extern void fatal (char const *) __attribute__((noreturn));
< -extern void finish_output (void);
< -extern void message (char const *, char const *, char const *);
< -extern void message5 (char const *, char const *, char const *,
< -                      char const *, char const *);
< -extern void output_1_line (char const *, char const *, char const *,
< -                           char const *);
< -extern void perror_with_name (char const *);
< -extern void pfatal_with_name (char const *) __attribute__((noreturn));
< -extern void print_1_line (char const *, char const * const *);
< -extern void print_1_line_nl (char const *, char const * const *, bool);
< -extern void print_message_queue (void);
< -extern void print_number_range (char, struct file_data *, lin, lin);
< -extern void print_script (struct change *, struct change * (*) (struct change *),
< -                          void (*) (struct change *));
< -extern void setup_output (char const *, char const *, bool);
< -extern void translate_range (struct file_data const *, lin, lin,
< -                             printint *, printint *);
< -
< -enum color_context
< -{
< -  HEADER_CONTEXT,
< -  ADD_CONTEXT,
< -  DELETE_CONTEXT,
< -  RESET_CONTEXT,
< -  LINE_NUMBER_CONTEXT,
< -};
< -
< -XTERN bool presume_output_tty;
< -
< -extern void set_color_context (enum color_context color_context);
< -extern void set_color_palette (char const *palette);
< +char *concat (char const *, char const *, char const *);
< +char *dir_file_pathname (char const *, char const *);
< +bool lines_differ (char const *, char const *);
< +lin translate_line_number (struct file_data const *, lin);
< +struct change *find_change (struct change *);
< +struct change *find_reverse_change (struct change *);
< +void *zalloc (size_t);
< +enum changes analyze_hunk (struct change *, lin *, lin *, lin *, lin *);
< +void begin_output (void);
< +void debug_script (struct change *);
< +void fatal (char const *) __attribute__((noreturn));
< +void finish_output (void);
< +void message (char const *, char const *, char const *);
< +void message5 (char const *, char const *, char const *, char const *, char const *);
< +void output_1_line (char const *, char const *, char const *, char const *);
< +void perror_with_name (char const *);
< +void pfatal_with_name (char const *) __attribute__((noreturn));
< +void print_1_line (char const *, char const * const *);
< +void print_message_queue (void);
< +void print_number_range (char, struct file_data *, lin, lin);
< +void print_script (struct change *, struct change * (*) (struct change *), void (*) (struct change *));
< +void setup_output (char const *, char const *, bool);
< +void translate_range (struct file_data const *, lin, lin, long int *, long int *);
< Only in diffutils-3.0-patch/src: diff.o
< diff -pru diffutils-3.0/src/dir.c diffutils-3.0-patch/src/dir.c
< --- diffutils-3.0/src/dir.c	2020-03-01 22:03:00.457727000 -0800
< +++ diffutils-3.0-patch/src/dir.c	2020-03-01 15:48:41.758479000 -0800
< @@ -1,7 +1,7 @@
<  /* Read, sort and compare two directories.  Used for GNU DIFF.
<  
<     Copyright (C) 1988-1989, 1992-1995, 1998, 2001-2002, 2004, 2006-2007,
< -   2009-2013, 2015-2017 Free Software Foundation, Inc.
< +   2009-2010 Free Software Foundation, Inc.
<  
<     This file is part of GNU DIFF.
<  
< @@ -21,7 +21,6 @@
<  #include "diff.h"
<  #include <error.h>
<  #include <exclude.h>
< -#include <filenamecat.h>
<  #include <setjmp.h>
<  #include <xalloc.h>
<  
< @@ -45,6 +44,7 @@ static bool locale_specific_sorting;
<  static jmp_buf failed_locale_specific_sorting;
<  
<  static bool dir_loop (struct comparison const *, int);
< +static int compare_names_for_qsort (void const *, void const *);
<  
<  
<  /* Read a directory and get its vector of names.  */
< @@ -84,7 +84,7 @@ dir_read (struct file_data const *dir, s
<        dirdata->data = data = xmalloc (data_alloc);
<  
<        /* Read the directory entries, and insert the subfiles
< -	 into the 'data' table.  */
< +	 into the `data' table.  */
<  
<        while ((errno = 0, (next = readdir (reading)) != 0))
---
>        if (stat (filename, &cmp.file[dir_arg].stat) != 0)
5342,5343c182,194
< @@ -125,7 +125,7 @@ dir_read (struct file_data const *dir, s
<  #endif
---
> diff --git a/src/diff3.c b/src/diff3.c
> index 0f11fdc..fbfb28b 100644
> --- a/src/diff3.c
> +++ b/src/diff3.c
> @@ -316,9 +316,9 @@ main (int argc, char **argv)
>    if (argc - optind != 3)
>      {
>        if (argc - optind < 3)
> -	try_help ("missing operand after `%s'", argv[argc - 1]);
> +	try_help ("missing operand after '%s'", argv[argc - 1]);
>        else
> -	try_help ("extra operand `%s'", argv[optind + 3]);
> +	try_help ("extra operand '%s'", argv[optind + 3]);
5346,5398c197,203
< -  /* Create the 'names' table from the 'data' table.  */
< +  /* Create the `names' table from the `data' table.  */
<    if (PTRDIFF_MAX / sizeof *names - 1 <= nnames)
<      xalloc_die ();
<    dirdata->names = names = xmalloc ((nnames + 1) * sizeof *names);
< @@ -139,27 +139,6 @@ dir_read (struct file_data const *dir, s
<    return true;
<  }
<  
< -/* Compare strings in a locale-specific way, returning a value
< -   compatible with strcmp.  */
< -
< -static int
< -compare_collated (char const *name1, char const *name2)
< -{
< -  int r;
< -  errno = 0;
< -  if (ignore_file_name_case)
< -    r = strcasecoll (name1, name2);
< -  else
< -    r = strcoll (name1, name2);
< -  if (errno)
< -    {
< -      error (0, errno, _("cannot compare file names '%s' and '%s'"),
< -	     name1, name2);
< -      longjmp (failed_locale_specific_sorting, 1);
< -    }
< -  return r;
< -}
< -
<  /* Compare file names, returning a value compatible with strcmp.  */
<  
<  static int
< @@ -167,30 +146,34 @@ compare_names (char const *name1, char c
<  {
<    if (locale_specific_sorting)
<      {
< -      int diff = compare_collated (name1, name2);
< -      if (diff || ignore_file_name_case)
< -	return diff;
< +      int r;
< +      errno = 0;
< +      if (ignore_file_name_case)
< +	r = strcasecoll (name1, name2);
< +      else
< +	r = strcoll (name1, name2);
< +      if (errno)
< +	{
< +	  error (0, errno, _("cannot compare file names '%s' and '%s'"),
< +		 name1, name2);
< +	  longjmp (failed_locale_specific_sorting, 1);
< +	}
< +      return r;
---
>    file = &argv[optind];
> @@ -351,7 +351,7 @@ main (int argc, char **argv)
>  	 file instead.  */
>        common = 3 - common;
>        if (STREQ (file[0], "-") || STREQ (file[common], "-"))
> -	fatal ("`-' specified for more than one input file");
> +	fatal ("'-' specified for more than one input file");
5400,5405d204
< -  return file_name_cmp (name1, name2);
< +
< +  return (ignore_file_name_case
< +	  ? strcasecmp (name1, name2)
< +	  : file_name_cmp (name1, name2));
<  }
5407,5425c206,213
< -/* Compare names FILE1 and FILE2 when sorting a directory.
< -   Prefer filtered comparison, breaking ties with file_name_cmp.  */
< +/* A wrapper for compare_names suitable as an argument for qsort.  */
<  
<  static int
<  compare_names_for_qsort (void const *file1, void const *file2)
<  {
<    char const *const *f1 = file1;
<    char const *const *f2 = file2;
< -  char const *name1 = *f1;
< -  char const *name2 = *f2;
< -  if (locale_specific_sorting)
< -    {
< -      int diff = compare_collated (name1, name2);
< -      if (diff)
< -	return diff;
< -    }
< -  return file_name_cmp (name1, name2);
< +  return compare_names (*f1, *f2);
---
>    mapping[0] = 0;
> @@ -412,7 +412,7 @@ try_help (char const *reason_msgid, char const *operand)
>    if (reason_msgid)
>      error (0, 0, _(reason_msgid), operand);
>    error (EXIT_TROUBLE, 0,
> -	 _("Try `%s --help' for more information."), program_name);
> +	 _("Try '%s --help' for more information."), program_name);
>    abort ();
5427,5431d214
<  
<  /* Compare the contents of two directories named in CMP.
< @@ -251,7 +234,7 @@ diff_dirs (struct comparison const *cmp,
<  	qsort (names[i], dirdata[i].nnames, sizeof *dirdata[i].names,
<  	       compare_names_for_qsort);
5433,5491c216,232
< -      /* If '-S name' was given, and this is the topmost level of comparison,
< +      /* If `-S name' was given, and this is the topmost level of comparison,
<  	 ignore all file names less than the specified starting name.  */
<  
<        if (starting_file && ! cmp->parent)
< @@ -270,41 +253,6 @@ diff_dirs (struct comparison const *cmp,
<  	     pretend the "next name" in that dir is very large.  */
<  	  int nameorder = (!*names[0] ? 1 : !*names[1] ? -1
<  			   : compare_names (*names[0], *names[1]));
< -
< -	  /* Prefer a file_name_cmp match if available.  This algorithm is
< -	     O(N**2), where N is the number of names in a directory
< -	     that compare_names says are all equal, but in practice N
< -	     is so small it's not worth tuning.  */
< -	  if (nameorder == 0 && ignore_file_name_case)
< -	    {
< -	      int raw_order = file_name_cmp (*names[0], *names[1]);
< -	      if (raw_order != 0)
< -		{
< -		  int greater_side = raw_order < 0;
< -		  int lesser_side = 1 - greater_side;
< -		  char const **lesser = names[lesser_side];
< -		  char const *greater_name = *names[greater_side];
< -		  char const **p;
< -
< -		  for (p = lesser + 1;
< -		       *p && compare_names (*p, greater_name) == 0;
< -		       p++)
< -		    {
< -		      int c = file_name_cmp (*p, greater_name);
< -		      if (0 <= c)
< -			{
< -			  if (c == 0)
< -			    {
< -			      memmove (lesser + 1, lesser,
< -				       (char *) p - (char *) lesser);
< -			      *lesser = greater_name;
< -			    }
< -			  break;
< -			}
< -		    }
< -		}
< -	    }
< -
<  	  int v1 = (*handle_file) (cmp,
<  				   0 < nameorder ? 0 : *names[0]++,
<  				   nameorder < 0 ? 0 : *names[1]++);
< @@ -324,7 +272,7 @@ diff_dirs (struct comparison const *cmp,
<  
<  /* Return nonzero if CMP is looping recursively in argument I.  */
<  
< -static bool _GL_ATTRIBUTE_PURE
< +static bool
<  dir_loop (struct comparison const *cmp, int i)
<  {
<    struct comparison const *p = cmp;
< @@ -333,53 +281,3 @@ dir_loop (struct comparison const *cmp,
<        return true;
<    return false;
---
> @@ -435,7 +435,7 @@ static char const * const option_help_msgid[] = {
>    "",
>    N_("-m  --merge  Output merged file instead of ed script (default -A)."),
>    N_("-L LABEL  --label=LABEL  Use LABEL instead of file name."),
> -  N_("-i  Append `w' and `q' commands to ed scripts."),
> +  N_("-i  Append 'w' and 'q' commands to ed scripts."),
>    N_("-a  --text  Treat all files as text."),
>    N_("--strip-trailing-cr  Strip trailing carriage return on input."),
>    N_("-T  --initial-tab  Make tabs line up by prepending a tab."),
> @@ -460,7 +460,7 @@ usage (void)
>      else
>        putchar ('\n');
>    printf ("\n%s\n%s\n",
> -	  _("If a FILE is `-', read standard input."),
> +	  _("If a FILE is '-', read standard input."),
>  	  _("Exit status is 0 if successful, 1 if conflicts, 2 if trouble."));
>    emit_bug_reporting_address ();
5493,5685c234,257
< -
< -/* Find a matching filename in a directory.  */
< -
< -char *
< -find_dir_file_pathname (char const *dir, char const *file)
< -{
< -  /* The 'IF_LINT (volatile)' works around what appears to be a bug in
< -     gcc 4.8.0 20120825; see
< -     <http://lists.gnu.org/archive/html/bug-diffutils/2012-08/msg00007.html>.
< -     */
< -  char const * IF_LINT (volatile) match = file;
< -
< -  char *val;
< -  struct dirdata dirdata;
< -  dirdata.names = NULL;
< -  dirdata.data = NULL;
< -
< -  if (ignore_file_name_case)
< -    {
< -      struct file_data filedata;
< -      filedata.name = dir;
< -      filedata.desc = 0;
< -
< -      if (dir_read (&filedata, &dirdata))
< -	{
< -	  locale_specific_sorting = true;
< -	  if (setjmp (failed_locale_specific_sorting))
< -	    match = file; /* longjmp may mess up MATCH.  */
< -	  else
< -	    {
< -	      for (char const **p = dirdata.names; *p; p++)
< -		if (compare_names (*p, file) == 0)
< -		  {
< -		    if (file_name_cmp (*p, file) == 0)
< -		      {
< -			match = *p;
< -			break;
< -		      }
< -		    if (match == file)
< -		      match = *p;
< -		  }
< -	    }
< -	}
< -    }
< -
< -  val = file_name_concat (dir, match, NULL);
< -  free (dirdata.names);
< -  free (dirdata.data);
< -  return val;
< -}
< Only in diffutils-3.0-patch/src: dir.o
< diff -pru diffutils-3.0/src/ed.c diffutils-3.0-patch/src/ed.c
< --- diffutils-3.0/src/ed.c	2020-03-01 22:03:00.458728000 -0800
< +++ diffutils-3.0-patch/src/ed.c	2020-03-01 14:52:55.581199000 -0800
< @@ -1,7 +1,7 @@
<  /* Output routines for ed-script format.
<  
< -   Copyright (C) 1988-1989, 1991-1993, 1995, 1998, 2001, 2004, 2006, 2009-2013,
< -   2015-2017 Free Software Foundation, Inc.
< +   Copyright (C) 1988-1989, 1991-1993, 1995, 1998, 2001, 2004, 2006, 2009-2010
< +   Free Software Foundation, Inc.
<  
<     This file is part of GNU DIFF.
<  
< @@ -144,7 +144,7 @@ static void
<  print_rcs_hunk (struct change *hunk)
<  {
<    lin i, f0, l0, f1, l1;
< -  printint tf0, tl0, tf1, tl1;
< +  long int tf0, tl0, tf1, tl1;
<  
<    /* Determine range of line numbers involved in each file.  */
<    enum changes changes = analyze_hunk (hunk, &f0, &l0, &f1, &l1);
< @@ -159,16 +159,14 @@ print_rcs_hunk (struct change *hunk)
<      {
<        /* For deletion, print just the starting line number from file 0
<  	 and the number of lines deleted.  */
< -      fprintf (outfile, "d%"pI"d %"pI"d\n", tf0,
< -	       tf0 <= tl0 ? tl0 - tf0 + 1 : 1);
< +      fprintf (outfile, "d%ld %ld\n", tf0, tf0 <= tl0 ? tl0 - tf0 + 1 : 1);
<      }
<  
<    if (changes & NEW)
<      {
<        /* Take last-line-number from file 0 and # lines from file 1.  */
<        translate_range (&files[1], f1, l1, &tf1, &tl1);
< -      fprintf (outfile, "a%"pI"d %"pI"d\n", tl0,
< -	       tf1 <= tl1 ? tl1 - tf1 + 1 : 1);
< +      fprintf (outfile, "a%ld %ld\n", tl0, tf1 <= tl1 ? tl1 - tf1 + 1 : 1);
<  
<        /* Print the inserted lines.  */
<        for (i = f1; i <= l1; i++)
< Only in diffutils-3.0-patch/src: ed.o
< diff -pru diffutils-3.0/src/ifdef.c diffutils-3.0-patch/src/ifdef.c
< --- diffutils-3.0/src/ifdef.c	2020-03-01 22:03:00.460727000 -0800
< +++ diffutils-3.0-patch/src/ifdef.c	2020-03-01 15:51:07.139821000 -0800
< @@ -1,7 +1,7 @@
<  /* #ifdef-format output routines for GNU DIFF.
<  
< -   Copyright (C) 1989, 1991-1994, 2001-2002, 2004, 2006, 2009-2013, 2015-2017
< -   Free Software Foundation, Inc.
< +   Copyright (C) 1989, 1991-1994, 2001-2002, 2004, 2006, 2009-2010 Free
< +   Software Foundation, Inc.
<  
<     This file is part of GNU DIFF.
<  
< @@ -132,7 +132,7 @@ format_group (register FILE *out, char c
<  	    break;
<  
<  	  case '(':
< -	    /* Print if-then-else format e.g. '%(n=1?thenpart:elsepart)'.  */
< +	    /* Print if-then-else format e.g. `%(n=1?thenpart:elsepart)'.  */
<  	    {
<  	      int i;
<  	      uintmax_t value[2];
< @@ -357,22 +357,21 @@ do_printf_spec (FILE *out, char const *s
<  
<  	if (out)
<  	  {
< -	    /* For example, if the spec is "%3xn" and pI is "l", use the printf
< +	    /* For example, if the spec is "%3xn", use the printf
<  	       format spec "%3lx".  Here the spec prefix is "%3".  */
< -	    printint print_value = value;
< +	    long int long_value = value;
<  	    size_t spec_prefix_len = f - spec - 2;
< -	    size_t pI_len = sizeof pI - 1;
< -#if 0
< -	    char format[spec_prefix_len + pI_len + 2];
< +#if HAVE_C_VARARRAYS
< +	    char format[spec_prefix_len + 3];
<  #else
< -	    char *format = xmalloc (spec_prefix_len + pI_len + 2);
< +	    char *format = xmalloc (spec_prefix_len + 3);
<  #endif
< -	    char *p = format + spec_prefix_len + pI_len;
< +	    char *p = format + spec_prefix_len;
<  	    memcpy (format, spec, spec_prefix_len);
< -	    memcpy (format + spec_prefix_len, pI, pI_len);
< +	    *p++ = 'l';
<  	    *p++ = c;
<  	    *p = '\0';
< -	    fprintf (out, format, print_value);
< +	    fprintf (out, format, long_value);
<  #if ! HAVE_C_VARARRAYS
<  	    free (format);
<  #endif
< Only in diffutils-3.0-patch/src: ifdef.o
< diff -pru diffutils-3.0/src/io.c diffutils-3.0-patch/src/io.c
< --- diffutils-3.0/src/io.c	2020-03-01 22:03:00.480730000 -0800
< +++ diffutils-3.0-patch/src/io.c	2020-03-01 15:52:08.225425000 -0800
< @@ -1,7 +1,7 @@
<  /* File I/O for GNU DIFF.
<  
< -   Copyright (C) 1988-1989, 1992-1995, 1998, 2001-2002, 2004, 2006, 2009-2013,
< -   2015-2017 Free Software Foundation, Inc.
< +   Copyright (C) 1988-1989, 1992-1995, 1998, 2001-2002, 2004, 2006, 2009-2010
< +   Free Software Foundation, Inc.
<  
<     This file is part of GNU DIFF.
<  
< @@ -19,7 +19,6 @@
<     along with this program.  If not, see <http://www.gnu.org/licenses/>.  */
<  
<  #include "diff.h"
< -#include <binary-io.h>
<  #include <cmpbuf.h>
<  #include <file-type.h>
<  #include <xalloc.h>
< @@ -58,10 +57,10 @@ static size_t nbuckets;
<     The number of an equivalence class is its index in this array.  */
<  static struct equivclass *equivs;
<  
< -/* Index of first free element in the array 'equivs'.  */
< +/* Index of first free element in the array `equivs'.  */
<  static lin equivs_index;
<  
< -/* Number of elements allocated in the array 'equivs'.  */
< +/* Number of elements allocated in the array `equivs'.  */
<  static lin equivs_alloc;
<  
<  /* Read a block of data into a file buffer, checking for EOF and error.  */
< @@ -108,35 +107,15 @@ sip (struct file_data *current, bool ski
<  				     PTRDIFF_MAX - 2 * sizeof (word));
<        current->buffer = xmalloc (current->bufsize);
<  
< -#ifdef __KLIBC__
< -      /* Skip test if seek is not possible */
< -      skip_test = skip_test
< -		  || (lseek (current->desc, 0, SEEK_CUR) < 0
< -		      && errno == ESPIPE);
< -#endif
< -
<        if (! skip_test)
---
> @@ -1275,12 +1275,12 @@ read_diff (char const *filea,
>    if (EXIT_TROUBLE <= status)
>      error (EXIT_TROUBLE, werrno,
>  	   _(status == 126
> -	     ? "subsidiary program `%s' could not be invoked"
> +	     ? "subsidiary program '%s' could not be invoked"
>  	     : status == 127
> -	     ? "subsidiary program `%s' not found"
> +	     ? "subsidiary program '%s' not found"
>  	     : status == INT_MAX
> -	     ? "subsidiary program `%s' failed"
> -	     : "subsidiary program `%s' failed (exit status %d)"),
> +	     ? "subsidiary program '%s' failed"
> +	     : "subsidiary program '%s' failed (exit status %d)"),
>  	   diff_program, status);
>  
>    return diff_result + total;
> diff --git a/src/dir.c b/src/dir.c
> index 5b4eaec..5e08318 100644
> --- a/src/dir.c
> +++ b/src/dir.c
> @@ -154,7 +154,7 @@ compare_names (char const *name1, char const *name2)
>  	r = strcoll (name1, name2);
>        if (errno)
5687,5929c259,262
<  	  /* Check first part of file to see if it's a binary file.  */
<  
< -	  int prev_mode = set_binary_mode (current->desc, O_BINARY);
< -	  off_t buffered;
< -	  file_block_read (current, current->bufsize);
< -	  buffered = current->buffered;
< -
< -	  if (prev_mode != O_BINARY)
< -	    {
< -	      /* Revert to text mode and seek back to the start to reread
< -		 the file.  Use relative seek, since file descriptors
< -		 like stdin might not start at offset zero.  */
< -	      if (lseek (current->desc, - buffered, SEEK_CUR) < 0)
< -		pfatal_with_name (current->name);
< -	      set_binary_mode (current->desc, prev_mode);
< -	      current->buffered = 0;
< -	      current->eof = false;
< -	    }
< +	  /* FIXME: if O_BINARY, this should revert to text mode
< +	     if the file is not binary.  */
<  
< -	  return binary_file_p (current->buffer, buffered);
< +	  file_block_read (current, current->bufsize);
< +	  return binary_file_p (current->buffer, current->buffered);
<  	}
<      }
<  
< @@ -219,7 +198,9 @@ slurp (struct file_data *current)
<  static void
<  find_and_hash_each_line (struct file_data *current)
<  {
< +  hash_value h;
<    char const *p = current->prefix_end;
< +  unsigned char c;
<    lin i, *bucket;
<    size_t length;
<  
< @@ -234,70 +215,122 @@ find_and_hash_each_line (struct file_dat
<    lin eqs_alloc = equivs_alloc;
<    char const *suffix_begin = current->suffix_begin;
<    char const *bufend = FILE_BUFFER (current) + current->buffered;
< -  bool ig_case = ignore_case;
< -  enum DIFF_white_space ig_white_space = ignore_white_space;
<    bool diff_length_compare_anyway =
< -    ig_white_space != IGNORE_NO_WHITE_SPACE;
< +    ignore_white_space != IGNORE_NO_WHITE_SPACE;
<    bool same_length_diff_contents_compare_anyway =
< -    diff_length_compare_anyway | ig_case;
< +    diff_length_compare_anyway | ignore_case;
<  
<    while (p < suffix_begin)
<      {
<        char const *ip = p;
< -      hash_value h = 0;
< -      unsigned char c;
< +
< +      h = 0;
<  
<        /* Hash this line until we find a newline.  */
< -      switch (ig_white_space)
< -	{
< -	case IGNORE_ALL_SPACE:
< -	  while ((c = *p++) != '\n')
< -	    if (! isspace (c))
< -	      h = HASH (h, ig_case ? tolower (c) : c);
< -	  break;
< +      if (ignore_case)
< +	switch (ignore_white_space)
< +	  {
< +	  case IGNORE_ALL_SPACE:
< +	    while ((c = *p++) != '\n')
< +	      if (! isspace (c))
< +		h = HASH (h, tolower (c));
< +	    break;
< +
< +	  case IGNORE_SPACE_CHANGE:
< +	    while ((c = *p++) != '\n')
< +	      {
< +		if (isspace (c))
< +		  {
< +		    do
< +		      if ((c = *p++) == '\n')
< +			goto hashing_done;
< +		    while (isspace (c));
< +
< +		    h = HASH (h, ' ');
< +		  }
<  
< -	case IGNORE_SPACE_CHANGE:
< -	  while ((c = *p++) != '\n')
< +		/* C is now the first non-space.  */
< +		h = HASH (h, tolower (c));
< +	      }
< +	    break;
< +
< +	  case IGNORE_TAB_EXPANSION:
<  	    {
< -	      if (isspace (c))
< +	      size_t column = 0;
< +	      while ((c = *p++) != '\n')
<  		{
< -		  do
< -		    if ((c = *p++) == '\n')
< -		      goto hashing_done;
< -		  while (isspace (c));
< +		  size_t repetitions = 1;
<  
< -		  h = HASH (h, ' ');
< -		}
< +		  switch (c)
< +		    {
< +		    case '\b':
< +		      column -= 0 < column;
< +		      break;
< +
< +		    case '\t':
< +		      c = ' ';
< +		      repetitions = tabsize - column % tabsize;
< +		      column = (column + repetitions < column
< +				? 0
< +				: column + repetitions);
< +		      break;
< +
< +		    case '\r':
< +		      column = 0;
< +		      break;
<  
< -	      /* C is now the first non-space.  */
< -	      h = HASH (h, ig_case ? tolower (c) : c);
< +		    default:
< +		      c = tolower (c);
< +		      column++;
< +		      break;
< +		    }
< +
< +		  do
< +		    h = HASH (h, c);
< +		  while (--repetitions != 0);
< +		}
<  	    }
< -	  break;
< +	    break;
<  
< -	case IGNORE_TAB_EXPANSION:
< -	case IGNORE_TAB_EXPANSION_AND_TRAILING_SPACE:
< -	case IGNORE_TRAILING_SPACE:
< +	  default:
< +	    while ((c = *p++) != '\n')
< +	      h = HASH (h, tolower (c));
< +	    break;
< +	  }
< +      else
< +	switch (ignore_white_space)
<  	  {
< -	    size_t column = 0;
< +	  case IGNORE_ALL_SPACE:
< +	    while ((c = *p++) != '\n')
< +	      if (! isspace (c))
< +		h = HASH (h, c);
< +	    break;
< +
< +	  case IGNORE_SPACE_CHANGE:
<  	    while ((c = *p++) != '\n')
<  	      {
< -		if (ig_white_space & IGNORE_TRAILING_SPACE
< -		    && isspace (c))
< +		if (isspace (c))
<  		  {
< -		    char const *p1 = p;
< -		    unsigned char c1;
<  		    do
< -		      if ((c1 = *p1++) == '\n')
< -			{
< -			  p = p1;
< -			  goto hashing_done;
< -			}
< -		    while (isspace (c1));
< +		      if ((c = *p++) == '\n')
< +			goto hashing_done;
< +		    while (isspace (c));
< +
< +		    h = HASH (h, ' ');
<  		  }
<  
< -		size_t repetitions = 1;
< +		/* C is now the first non-space.  */
< +		h = HASH (h, c);
< +	      }
< +	    break;
< +
< +	  case IGNORE_TAB_EXPANSION:
< +	    {
< +	      size_t column = 0;
< +	      while ((c = *p++) != '\n')
< +		{
< +		  size_t repetitions = 1;
<  
< -		if (ig_white_space & IGNORE_TAB_EXPANSION)
<  		  switch (c)
<  		    {
<  		    case '\b':
< @@ -321,25 +354,18 @@ find_and_hash_each_line (struct file_dat
<  		      break;
<  		    }
<  
< -		if (ig_case)
< -		  c = tolower (c);
< -
< -		do
< -		  h = HASH (h, c);
< -		while (--repetitions != 0);
< -	      }
< -	  }
< -	  break;
< +		  do
< +		    h = HASH (h, c);
< +		  while (--repetitions != 0);
< +		}
< +	    }
< +	    break;
<  
< -	default:
< -	  if (ig_case)
< -	    while ((c = *p++) != '\n')
< -	      h = HASH (h, tolower (c));
< -	  else
< +	  default:
<  	    while ((c = *p++) != '\n')
<  	      h = HASH (h, c);
< -	  break;
< -	}
< +	    break;
< +	  }
<  
<     hashing_done:;
<  
< @@ -355,7 +381,7 @@ find_and_hash_each_line (struct file_dat
<  	     complete line, put it into buckets[-1] so that it can
<  	     compare equal only to the other file's incomplete line
<  	     (if one exists).  */
< -	  if (ig_white_space < IGNORE_TRAILING_SPACE)
< +	  if (ignore_white_space < IGNORE_SPACE_CHANGE)
<  	    bucket = &buckets[-1];
---
> -	  error (0, errno, _("cannot compare file names `%s' and `%s'"),
> +	  error (0, errno, _("cannot compare file names '%s' and '%s'"),
>  		 name1, name2);
>  	  longjmp (failed_locale_specific_sorting, 1);
5931,6251c264,268
<  
< @@ -481,6 +507,7 @@ prepare_text (struct file_data *current)
<  {
<    size_t buffered = current->buffered;
<    char *p = FILE_BUFFER (current);
< +  char *dst;
<  
<    if (buffered == 0 || p[buffered - 1] == '\n')
<      current->missing_newline = false;
< @@ -496,25 +523,16 @@ prepare_text (struct file_data *current)
<    /* Don't use uninitialized storage when planting or using sentinels.  */
<    memset (p + buffered, 0, sizeof (word));
<  
< -  if (strip_trailing_cr)
< +  if (strip_trailing_cr && (dst = memchr (p, '\r', buffered)))
<      {
< -      char *dst;
< -      char *srclim = p + buffered;
< -      *srclim = '\r';
< -      dst = rawmemchr (p, '\r');
< +      char const *src = dst;
< +      char const *srclim = p + buffered;
<  
< -      if (dst != srclim)
< -	{
< -	  char const *src = dst;
< -	  do
< -	    {
< -	      *dst = *src++;
< -	      dst += ! (*dst == '\r' && *src == '\n');
< -	    }
< -	  while (src < srclim);
< +      do
< +	dst += ! ((*dst = *src++) == '\r' && *src == '\n');
< +      while (src < srclim);
<  
< -	  buffered -= src - dst;
< -	}
< +      buffered -= src - dst;
<      }
<  
<    current->buffered = buffered;
< @@ -545,7 +563,6 @@ find_identical_ends (struct file_data fi
<    lin i, lines;
<    size_t n0, n1;
<    lin alloc_lines0, alloc_lines1;
< -  bool prefix_needed;
<    lin buffered_prefix, prefix_count, prefix_mask;
<    lin middle_guess, suffix_guess;
<  
< @@ -695,13 +712,12 @@ find_identical_ends (struct file_data fi
<    prefix_mask = prefix_count - 1;
<    lines = 0;
<    linbuf0 = xmalloc (alloc_lines0 * sizeof *linbuf0);
< -  prefix_needed = ! (no_diff_means_no_output
< -		     && filevec[0].prefix_end == p0
< -		     && filevec[1].prefix_end == p1);
<    p0 = buffer0;
<  
<    /* If the prefix is needed, find the prefix lines.  */
< -  if (prefix_needed)
< +  if (! (no_diff_means_no_output
< +	 && filevec[0].prefix_end == p0
< +	 && filevec[1].prefix_end == p1))
<      {
<        end0 = filevec[0].prefix_end;
<        while (p0 != end0)
< @@ -792,8 +808,7 @@ read_files (struct file_data filevec[],
<      }
<    if (appears_binary)
<      {
< -      set_binary_mode (filevec[0].desc, O_BINARY);
< -      set_binary_mode (filevec[1].desc, O_BINARY);
< +      /* FIXME: If O_BINARY, this should set both files to binary mode.  */
<        return true;
<      }
<  
< Only in diffutils-3.0-patch/src: io.o
< Only in diffutils-3.0-patch/src: Makefile
< diff -pru diffutils-3.0/src/Makefile.am diffutils-3.0-patch/src/Makefile.am
< --- diffutils-3.0/src/Makefile.am	2020-03-01 22:03:00.444726000 -0800
< +++ diffutils-3.0-patch/src/Makefile.am	2020-03-01 14:52:55.563198000 -0800
< @@ -1,7 +1,6 @@
<  # Automakefile for GNU diffutils programs.
<  
< -# Copyright (C) 2001-2002, 2006, 2009-2013, 2015-2017 Free Software Foundation,
< -# Inc.
< +# Copyright (C) 2001-2002, 2006, 2009-2010 Free Software Foundation, Inc.
<  
<  # This program is free software: you can redistribute it and/or modify
<  # it under the terms of the GNU General Public License as published by
< @@ -18,13 +17,14 @@
<  
<  bin_PROGRAMS = cmp diff diff3 sdiff
<  
< +noinst_HEADERS = system.h
< +
<  localedir = $(datadir)/locale
<  
<  AM_CPPFLAGS = -I../lib -I$(top_srcdir)/lib
<  AM_CFLAGS = $(WARN_CFLAGS) $(WERROR_CFLAGS)
<  
<  LDADD = \
< -  libver.a \
<    ../lib/libdiffutils.a \
<    $(LIBCSTACK) \
<    $(LIBINTL) \
< @@ -41,12 +41,8 @@ cmp_SOURCES = cmp.c
<  diff3_SOURCES = diff3.c
<  sdiff_SOURCES = sdiff.c
<  diff_SOURCES = \
< -  analyze.c context.c diff.c dir.c ed.c ifdef.c io.c \
< +  analyze.c context.c diff.c diff.h dir.c ed.c ifdef.c io.c \
<    normal.c side.c util.c
< -noinst_HEADERS =	\
< -  die.h			\
< -  diff.h		\
< -  system.h
<  
<  MOSTLYCLEANFILES = paths.h paths.ht
<  
< @@ -57,24 +53,3 @@ BUILT_SOURCES = paths.h
<  paths.h: Makefile.am
<  	$(AM_V_GEN)(echo '#define DEFAULT_DIFF_PROGRAM "'$(gdiff)'"' && \
<  	  echo '#define LOCALEDIR "$(localedir)"') >$@t && mv $@t $@
< -
< -noinst_LIBRARIES = libver.a
< -nodist_libver_a_SOURCES = version.c version.h
< -
< -BUILT_SOURCES += version.c
< -version.c: Makefile
< -	$(AM_V_GEN)rm -f $@
< -	$(AM_V_at)printf '#include <config.h>\n' > $@t
< -	$(AM_V_at)printf 'char const *Version = "$(PACKAGE_VERSION)";\n' >> $@t
< -	$(AM_V_at)chmod a-w $@t
< -	$(AM_V_at)mv $@t $@
< -
< -BUILT_SOURCES += version.h
< -version.h: Makefile
< -	$(AM_V_GEN)rm -f $@
< -	$(AM_V_at)printf 'extern char const *Version;\n' > $@t
< -	$(AM_V_at)chmod a-w $@t
< -	$(AM_V_at)mv $@t $@
< -
< -DISTCLEANFILES = version.c version.h
< -MAINTAINERCLEANFILES = $(BUILT_SOURCES)
< Only in diffutils-3.0-patch/src: Makefile.in
< diff -pru diffutils-3.0/src/normal.c diffutils-3.0-patch/src/normal.c
< --- diffutils-3.0/src/normal.c	2020-03-01 22:03:00.481730000 -0800
< +++ diffutils-3.0-patch/src/normal.c	2020-03-01 14:52:55.587200000 -0800
< @@ -1,7 +1,7 @@
<  /* Normal-format output routines for GNU DIFF.
<  
< -   Copyright (C) 1988-1989, 1993, 1995, 1998, 2001, 2006, 2009-2013, 2015-2017
< -   Free Software Foundation, Inc.
< +   Copyright (C) 1988-1989, 1993, 1995, 1998, 2001, 2006, 2009-2010 Free
< +   Software Foundation, Inc.
<  
<     This file is part of GNU DIFF.
<  
< @@ -49,43 +49,21 @@ print_normal_hunk (struct change *hunk)
<    begin_output ();
<  
<    /* Print out the line number header for this hunk */
< -  set_color_context (LINE_NUMBER_CONTEXT);
<    print_number_range (',', &files[0], first0, last0);
<    fputc (change_letter[changes], outfile);
<    print_number_range (',', &files[1], first1, last1);
< -  set_color_context (RESET_CONTEXT);
<    fputc ('\n', outfile);
<  
<    /* Print the lines that the first file has.  */
<    if (changes & OLD)
< -    {
< -      if (first0 <= last0)
< -        set_color_context (DELETE_CONTEXT);
< -      for (i = first0; i <= last0; i++)
< -        {
< -          print_1_line_nl ("<", &files[0].linbuf[i], true);
< -          if (i == last0)
< -            set_color_context (RESET_CONTEXT);
< -          if (files[0].linbuf[i + 1][-1] == '\n')
< -            putc ('\n', outfile);
< -        }
< -    }
< +    for (i = first0; i <= last0; i++)
< +      print_1_line ("<", &files[0].linbuf[i]);
<  
<    if (changes == CHANGED)
<      fputs ("---\n", outfile);
<  
<    /* Print the lines that the second file has.  */
<    if (changes & NEW)
< -    {
< -      if (first1 <= last1)
< -        set_color_context (ADD_CONTEXT);
< -      for (i = first1; i <= last1; i++)
< -        {
< -          print_1_line_nl (">", &files[1].linbuf[i], true);
< -          if (i == last1)
< -            set_color_context (RESET_CONTEXT);
< -          if (files[1].linbuf[i + 1][-1] == '\n')
< -            putc ('\n', outfile);
< -        }
< -    }
< +    for (i = first1; i <= last1; i++)
< +      print_1_line (">", &files[1].linbuf[i]);
<  }
< Only in diffutils-3.0-patch/src: normal.o
< Only in diffutils-3.0-patch/src: paths.h
< Only in diffutils-3.0-patch/src: sdiff
< diff -pru diffutils-3.0/src/sdiff.c diffutils-3.0-patch/src/sdiff.c
< --- diffutils-3.0/src/sdiff.c	2020-03-01 22:03:00.483730000 -0800
< +++ diffutils-3.0-patch/src/sdiff.c	2020-03-01 15:56:41.337493000 -0800
< @@ -1,7 +1,7 @@
<  /* sdiff - side-by-side merge of file differences
<  
< -   Copyright (C) 1992-1996, 1998, 2001-2002, 2004, 2006-2007, 2009-2013,
< -   2015-2017 Free Software Foundation, Inc.
< +   Copyright (C) 1992-1996, 1998, 2001-2002, 2004, 2006-2007, 2009-2010 Free
< +   Software Foundation, Inc.
<  
<     This file is part of GNU DIFF.
<  
< @@ -26,17 +26,16 @@
<  
<  #include <c-stack.h>
<  #include <dirname.h>
< -#include "die.h"
<  #include <error.h>
<  #include <exitfail.h>
<  #include <file-type.h>
<  #include <getopt.h>
<  #include <progname.h>
< -#include <system-quote.h>
< +#include <sh-quote.h>
<  #include <version-etc.h>
<  #include <xalloc.h>
<  
< -/* The official name of this program (e.g., no 'g' prefix).  */
< +/* The official name of this program (e.g., no `g' prefix).  */
<  #define PROGRAM_NAME "sdiff"
<  
<  #define AUTHORS \
< @@ -51,7 +50,7 @@ static char const **diffargv;
<  static char * volatile tmpname;
<  static FILE *tmp;
<  
< -#if HAVE_WORKING_FORK
< +#if HAVE_WORKING_FORK || HAVE_WORKING_VFORK
<  static pid_t volatile diffpid;
<  #endif
<  
< @@ -67,6 +66,7 @@ static void perror_fatal (char const *)
<  static void trapsigs (void);
<  static void untrapsig (int);
<  
< +#define NUM_SIGS (sizeof sigs / sizeof *sigs)
<  static int const sigs[] = {
<  #ifdef SIGHUP
<         SIGHUP,
< @@ -85,17 +85,14 @@ static int const sigs[] = {
<  #endif
<  #ifdef SIGPIPE
<         SIGPIPE,
< +# define handler_index_of_SIGPIPE (NUM_SIGS - 2)
<  #endif
<         SIGINT
< +#define handler_index_of_SIGINT (NUM_SIGS - 1)
<  };
< -enum
< -  {
< -    NUM_SIGS = sizeof sigs / sizeof *sigs,
< -    handler_index_of_SIGINT = NUM_SIGS - 1
< -  };
<  
<  #if HAVE_SIGACTION
< -  /* Prefer 'sigaction' if available, since 'signal' can lose signals.  */
< +  /* Prefer `sigaction' if available, since `signal' can lose signals.  */
<    static struct sigaction initial_action[NUM_SIGS];
<  # define initial_handler(i) (initial_action[i].sa_handler)
<    static void signal_handler (int, void (*) (int));
< @@ -105,6 +102,29 @@ enum
<  # define signal_handler(sig, handler) signal (sig, handler)
<  #endif
<  
< +#if ! HAVE_SIGPROCMASK
< +# define sigset_t int
< +# define sigemptyset(s) (*(s) = 0)
< +# ifndef sigmask
< +#  define sigmask(sig) (1 << ((sig) - 1))
< +# endif
< +# define sigaddset(s, sig) (*(s) |= sigmask (sig))
< +# ifndef SIG_BLOCK
< +#  define SIG_BLOCK 0
< +# endif
< +# ifndef SIG_SETMASK
< +#  define SIG_SETMASK (! SIG_BLOCK)
< +# endif
< +# if ! HAVE_SIGBLOCK
< +#  define sigblock(mask) (mask)
< +#  define sigsetmask(mask) (mask)
< +# endif
< +# define sigprocmask(how, n, o) \
< +    ((how) == SIG_BLOCK \
< +     ? ((o) ? (*(sigset_t *) (o) = sigblock (*(n))) : sigblock (*(n))) \
< +     : sigsetmask (*(n)))
< +#endif
< +
<  static bool diraccess (char const *);
<  static int temporary_file (void);
<  
< @@ -136,7 +156,6 @@ static struct option const longopts[] =
<    {"ignore-matching-lines", 1, 0, 'I'},
<    {"ignore-space-change", 0, 0, 'b'},
<    {"ignore-tab-expansion", 0, 0, 'E'},
< -  {"ignore-trailing-space", 0, 0, 'Z'},
<    {"left-column", 0, 0, 'l'},
<    {"minimal", 0, 0, 'd'},
<    {"output", 1, 0, 'o'},
< @@ -156,8 +175,9 @@ try_help (char const *reason_msgid, char
---
> diff --git a/src/sdiff.c b/src/sdiff.c
> index 4344e8d..5bbecd8 100644
> --- a/src/sdiff.c
> +++ b/src/sdiff.c
> @@ -175,7 +175,7 @@ try_help (char const *reason_msgid, char const *operand)
6255c272
< -  die (EXIT_TROUBLE, 0, _("Try '%s --help' for more information."),
---
> -  error (EXIT_TROUBLE, 0, _("Try `%s --help' for more information."),
6258,6948c275
< +  abort ();
<  }
<  
<  static void
< @@ -170,31 +190,30 @@ check_stdout (void)
<  }
<  
<  static char const * const option_help_msgid[] = {
< -  N_("-o, --output=FILE            operate interactively, sending output to FILE"),
< +  N_("-o FILE  --output=FILE  Operate interactively, sending output to FILE."),
<    "",
< -  N_("-i, --ignore-case            consider upper- and lower-case to be the same"),
< -  N_("-E, --ignore-tab-expansion   ignore changes due to tab expansion"),
< -  N_("-Z, --ignore-trailing-space  ignore white space at line end"),
< -  N_("-b, --ignore-space-change    ignore changes in the amount of white space"),
< -  N_("-W, --ignore-all-space       ignore all white space"),
< -  N_("-B, --ignore-blank-lines     ignore changes whose lines are all blank"),
< -  N_("-I, --ignore-matching-lines=RE  ignore changes all whose lines match RE"),
< -  N_("    --strip-trailing-cr      strip trailing carriage return on input"),
< -  N_("-a, --text                   treat all files as text"),
< +  N_("-i  --ignore-case  Consider upper- and lower-case to be the same."),
< +  N_("-E  --ignore-tab-expansion  Ignore changes due to tab expansion."),
< +  N_("-b  --ignore-space-change  Ignore changes in the amount of white space."),
< +  N_("-W  --ignore-all-space  Ignore all white space."),
< +  N_("-B  --ignore-blank-lines  Ignore changes whose lines are all blank."),
< +  N_("-I RE  --ignore-matching-lines=RE  Ignore changes whose lines all match RE."),
< +  N_("--strip-trailing-cr  Strip trailing carriage return on input."),
< +  N_("-a  --text  Treat all files as text."),
<    "",
< -  N_("-w, --width=NUM              output at most NUM (default 130) print columns"),
< -  N_("-l, --left-column            output only the left column of common lines"),
< -  N_("-s, --suppress-common-lines  do not output common lines"),
< +  N_("-w NUM  --width=NUM  Output at most NUM (default 130) print columns."),
< +  N_("-l  --left-column  Output only the left column of common lines."),
< +  N_("-s  --suppress-common-lines  Do not output common lines."),
<    "",
< -  N_("-t, --expand-tabs            expand tabs to spaces in output"),
< -  N_("    --tabsize=NUM            tab stops at every NUM (default 8) print columns"),
< +  N_("-t  --expand-tabs  Expand tabs to spaces in output."),
< +  N_("--tabsize=NUM  Tab stops are every NUM (default 8) print columns."),
<    "",
< -  N_("-d, --minimal                try hard to find a smaller set of changes"),
< -  N_("-H, --speed-large-files      assume large files, many scattered small changes"),
< -  N_("    --diff-program=PROGRAM   use PROGRAM to compare files"),
< +  N_("-d  --minimal  Try hard to find a smaller set of changes."),
< +  N_("-H  --speed-large-files  Assume large files and many scattered small changes."),
< +  N_("--diff-program=PROGRAM  Use PROGRAM to compare files."),
<    "",
< -  N_("    --help                   display this help and exit"),
< -  N_("-v, --version                output version information and exit"),
< +  N_("-v  --version  Output version info."),
< +  N_("--help  Output this help."),
<    0
<  };
<  
< @@ -204,12 +223,7 @@ usage (void)
<    char const * const *p;
<  
<    printf (_("Usage: %s [OPTION]... FILE1 FILE2\n"), program_name);
< -  printf ("%s\n\n",
< -          _("Side-by-side merge of differences between FILE1 and FILE2."));
< -
< -  fputs (_("\
< -Mandatory arguments to long options are mandatory for short options too.\n\
< -"), stdout);
< +  printf ("%s\n\n", _("Side-by-side merge of file differences."));
<    for (p = option_help_msgid;  *p;  p++)
<      if (**p)
<        printf ("  %s\n", _(*p));
< @@ -226,7 +240,7 @@ Mandatory arguments to long options are
<  static void
<  cleanup (int signo __attribute__((unused)))
<  {
< -#if HAVE_WORKING_FORK
< +#if HAVE_WORKING_FORK || HAVE_WORKING_VFORK
<    if (0 < diffpid)
<      kill (diffpid, SIGPIPE);
<  #endif
< @@ -379,8 +393,8 @@ lf_copy (struct line_filter *lf, lin lin
<  
<    while (lines)
<      {
< -      lf->bufpos = rawmemchr (lf->bufpos, '\n');
< -      if (lf->bufpos == lf->buflim)
< +      lf->bufpos = (char *) memchr (lf->bufpos, '\n', lf->buflim - lf->bufpos);
< +      if (! lf->bufpos)
<  	{
<  	  ck_fwrite (start, lf->buflim - start, outfile);
<  	  if (! lf_refill (lf))
< @@ -403,8 +417,8 @@ lf_skip (struct line_filter *lf, lin lin
<  {
<    while (lines)
<      {
< -      lf->bufpos = rawmemchr (lf->bufpos, '\n');
< -      if (lf->bufpos == lf->buflim)
< +      lf->bufpos = (char *) memchr (lf->bufpos, '\n', lf->buflim - lf->bufpos);
< +      if (! lf->bufpos)
<  	{
<  	  if (! lf_refill (lf))
<  	    break;
< @@ -424,7 +438,7 @@ lf_snarf (struct line_filter *lf, char *
<    for (;;)
<      {
<        char *start = lf->bufpos;
< -      char *next = rawmemchr (start, '\n');
< +      char *next = (char *) memchr (start, '\n', lf->buflim + 1 - start);
<        size_t s = next - start;
<        if (bufsize <= s)
<  	return 0;
< @@ -463,7 +477,7 @@ main (int argc, char *argv[])
<    diffarg (DEFAULT_DIFF_PROGRAM);
<  
<    /* parse command line args */
< -  while ((opt = getopt_long (argc, argv, "abBdEHiI:lo:stvw:WZ", longopts, 0))
< +  while ((opt = getopt_long (argc, argv, "abBdEHiI:lo:stvw:W", longopts, 0))
<  	 != -1)
<      {
<        switch (opt)
< @@ -518,7 +532,7 @@ main (int argc, char *argv[])
<  	  break;
<  
<  	case 'v':
< -	  version_etc (stdout, PROGRAM_NAME, PACKAGE_NAME, Version,
< +	  version_etc (stdout, PROGRAM_NAME, PACKAGE_NAME, PACKAGE_VERSION,
<  		       AUTHORS, (char *) NULL);
<  	  check_stdout ();
<  	  return EXIT_SUCCESS;
< @@ -532,10 +546,6 @@ main (int argc, char *argv[])
<  	  diffarg ("-w");
<  	  break;
<  
< -	case 'Z':
< -	  diffarg ("-Z");
< -	  break;
< -
<  	case DIFF_PROGRAM_OPTION:
<  	  diffargv[0] = optarg;
<  	  break;
< @@ -608,9 +618,21 @@ main (int argc, char *argv[])
<  
<        trapsigs ();
<  
< -#if ! HAVE_WORKING_FORK
< +#if ! (HAVE_WORKING_FORK || HAVE_WORKING_VFORK)
<        {
< -	char *command = system_quote_argv (SCI_SYSTEM, (char **) diffargv);
< +	size_t cmdsize = 1;
< +	char *p, *command;
< +	int i;
< +
< +	for (i = 0;  diffargv[i];  i++)
< +	  cmdsize += shell_quote_length (diffargv[i]) + 1;
< +	command = p = xmalloc (cmdsize);
< +	for (i = 0;  diffargv[i];  i++)
< +	  {
< +	    p = shell_quote_copy (p, diffargv[i]);
< +	    *p++ = ' ';
< +	  }
< +	p[-1] = 0;
<  	errno = 0;
<  	diffout = popen (command, "r");
<  	if (! diffout)
< @@ -620,11 +642,22 @@ main (int argc, char *argv[])
<  #else
<        {
<  	int diff_fds[2];
< +# if HAVE_WORKING_VFORK
< +	sigset_t procmask;
< +	sigset_t blocked;
< +# endif
<  
<  	if (pipe (diff_fds) != 0)
<  	  perror_fatal ("pipe");
<  
< -	diffpid = fork ();
< +# if HAVE_WORKING_VFORK
< +	/* Block SIGINT and SIGPIPE.  */
< +	sigemptyset (&blocked);
< +	sigaddset (&blocked, SIGINT);
< +	sigaddset (&blocked, SIGPIPE);
< +	sigprocmask (SIG_BLOCK, &blocked, &procmask);
< +# endif
< +	diffpid = vfork ();
<  	if (diffpid < 0)
<  	  perror_fatal ("fork");
<  	if (! diffpid)
< @@ -636,6 +669,10 @@ main (int argc, char *argv[])
<  	    if (initial_handler (handler_index_of_SIGINT) != SIG_IGN)
<  	      signal_handler (SIGINT, SIG_IGN);
<  	    signal_handler (SIGPIPE, SIG_DFL);
< +# if HAVE_WORKING_VFORK
< +	    /* Stop blocking SIGINT and SIGPIPE in the child.  */
< +	    sigprocmask (SIG_SETMASK, &procmask, 0);
< +# endif
<  	    close (diff_fds[0]);
<  	    if (diff_fds[1] != STDOUT_FILENO)
<  	      {
< @@ -647,6 +684,19 @@ main (int argc, char *argv[])
<  	    _exit (errno == ENOENT ? 127 : 126);
<  	  }
<  
< +# if HAVE_WORKING_VFORK
< +	/* Restore the parent's SIGINT and SIGPIPE behavior.  */
< +	if (initial_handler (handler_index_of_SIGINT) != SIG_IGN)
< +	  signal_handler (SIGINT, catchsig);
< +	if (initial_handler (handler_index_of_SIGPIPE) != SIG_IGN)
< +	  signal_handler (SIGPIPE, catchsig);
< +	else
< +	  signal_handler (SIGPIPE, SIG_IGN);
< +
< +	/* Stop blocking SIGINT and SIGPIPE in the parent.  */
< +	sigprocmask (SIG_SETMASK, &procmask, 0);
< +# endif
< +
<  	close (diff_fds[1]);
<  	diffout = fdopen (diff_fds[0], "r");
<  	if (! diffout)
< @@ -668,7 +718,7 @@ main (int argc, char *argv[])
<  	int wstatus;
<  	int werrno = 0;
<  
< -#if ! HAVE_WORKING_FORK
< +#if ! (HAVE_WORKING_FORK || HAVE_WORKING_VFORK)
<  	wstatus = pclose (diffout);
<  	if (wstatus == -1)
<  	  werrno = errno;
< @@ -697,7 +747,7 @@ main (int argc, char *argv[])
<  	exit (WEXITSTATUS (wstatus));
<        }
<      }
< -  return EXIT_SUCCESS;			/* Fool '-Wall'.  */
< +  return EXIT_SUCCESS;			/* Fool `-Wall'.  */
<  }
<  
<  static void
< @@ -918,10 +968,10 @@ edit (struct line_filter *left, char con
<  		  cmd0 = 'q';
<  		  break;
<  		}
< -	      FALLTHROUGH;
< +	      /* Fall through.  */
<  	    default:
<  	      flush_line ();
< -	      FALLTHROUGH;
< +	      /* Fall through.  */
<  	    case '\n':
<  	      give_help ();
<  	      continue;
< @@ -967,14 +1017,14 @@ edit (struct line_filter *left, char con
<  	      case 'd':
<  		if (llen)
<  		  {
< -		    printint l1 = lline;
< -		    printint l2 = lline + llen - 1;
<  		    if (llen == 1)
< -		      fprintf (tmp, "--- %s %"pI"d\n", lname, l1);
< +		      fprintf (tmp, "--- %s %ld\n", lname, (long int) lline);
<  		    else
< -		      fprintf (tmp, "--- %s %"pI"d,%"pI"d\n", lname, l1, l2);
< +		      fprintf (tmp, "--- %s %ld,%ld\n", lname,
< +			       (long int) lline,
< +			       (long int) (lline + llen - 1));
<  		  }
< -		FALLTHROUGH;
< +		/* Fall through.  */
<  	      case '1': case 'b': case 'l':
<  		lf_copy (left, llen, tmp);
<  		break;
< @@ -989,14 +1039,14 @@ edit (struct line_filter *left, char con
<  	      case 'd':
<  		if (rlen)
<  		  {
< -		    printint l1 = rline;
< -		    printint l2 = rline + rlen - 1;
<  		    if (rlen == 1)
< -		      fprintf (tmp, "+++ %s %"pI"d\n", rname, l1);
< +		      fprintf (tmp, "+++ %s %ld\n", rname, (long int) rline);
<  		    else
< -		      fprintf (tmp, "+++ %s %"pI"d,%"pI"d\n", rname, l1, l2);
< +		      fprintf (tmp, "+++ %s %ld,%ld\n", rname,
< +			       (long int) rline,
< +			       (long int) (rline + rlen - 1));
<  		  }
< -		FALLTHROUGH;
< +		/* Fall through.  */
<  	      case '2': case 'b': case 'r':
<  		lf_copy (right, rlen, tmp);
<  		break;
< @@ -1011,17 +1061,16 @@ edit (struct line_filter *left, char con
<  	    {
<  	      int wstatus;
<  	      int werrno = 0;
< -	      char const *argv[3];
< -
<  	      ignore_SIGINT = true;
<  	      checksigs ();
< -	      argv[0] = editor_program;
< -	      argv[1] = tmpname;
< -	      argv[2] = 0;
<  
<  	      {
< -#if ! HAVE_WORKING_FORK
< -		char *command = system_quote_argv (SCI_SYSTEM, (char **) argv);
< +#if ! (HAVE_WORKING_FORK || HAVE_WORKING_VFORK)
< +		char *command =
< +		  xmalloc (shell_quote_length (editor_program)
< +			   + 1 + strlen (tmpname) + 1);
< +		sprintf (shell_quote_copy (command, editor_program),
< +			 " %s", tmpname);
<  		wstatus = system (command);
<  		if (wstatus == -1)
<  		  werrno = errno;
< @@ -1029,9 +1078,16 @@ edit (struct line_filter *left, char con
<  #else
<  		pid_t pid;
<  
< -		pid = fork ();
< +		pid = vfork ();
<  		if (pid == 0)
<  		  {
< +		    char const *argv[3];
< +		    int i = 0;
< +
< +		    argv[i++] = editor_program;
< +		    argv[i++] = tmpname;
< +		    argv[i] = 0;
< +
<  		    execvp (editor_program, (char **) argv);
<  		    _exit (errno == ENOENT ? 127 : 126);
<  		  }
< @@ -1099,14 +1155,12 @@ interact (struct line_filter *diff,
<  	  uintmax_t val;
<  	  lin llen, rlen, lenmax;
<  	  errno = 0;
< -	  val = strtoumax (diff_help + 1, &numend, 10);
< -	  if (LIN_MAX < val || errno || *numend != ',')
< +	  llen = val = strtoumax (diff_help + 1, &numend, 10);
< +	  if (llen < 0 || llen != val || errno || *numend != ',')
<  	    fatal (diff_help);
< -	  llen = val;
< -	  val = strtoumax (numend + 1, &numend, 10);
< -	  if (LIN_MAX < val || errno || *numend)
< +	  rlen = val = strtoumax (numend + 1, &numend, 10);
< +	  if (rlen < 0 || rlen != val || errno || *numend)
<  	    fatal (diff_help);
< -	  rlen = val;
<  
<  	  lenmax = MAX (llen, rlen);
<  
< @@ -1165,9 +1219,18 @@ temporary_file (void)
<    char const *dir = tmpdir ? tmpdir : P_tmpdir;
<    char *buf = xmalloc (strlen (dir) + 1 + 5 + 6 + 1);
<    int fd;
< +  int e;
< +  sigset_t procmask;
< +  sigset_t blocked;
<    sprintf (buf, "%s/sdiffXXXXXX", dir);
< +  sigemptyset (&blocked);
< +  sigaddset (&blocked, SIGINT);
< +  sigprocmask (SIG_BLOCK, &blocked, &procmask);
<    fd = mkstemp (buf);
< +  e = errno;
<    if (0 <= fd)
<      tmpname = buf;
< +  sigprocmask (SIG_SETMASK, &procmask, 0);
< +  errno = e;
<    return fd;
<  }
< Only in diffutils-3.0-patch/src: sdiff.o
< diff -pru diffutils-3.0/src/side.c diffutils-3.0-patch/src/side.c
< --- diffutils-3.0/src/side.c	2020-03-01 22:03:00.484731000 -0800
< +++ diffutils-3.0-patch/src/side.c	2020-03-01 15:59:22.143254000 -0800
< @@ -1,7 +1,7 @@
<  /* sdiff-format output routines for GNU DIFF.
<  
< -   Copyright (C) 1991-1993, 1998, 2001-2002, 2004, 2009-2013, 2015-2017 Free
< -   Software Foundation, Inc.
< +   Copyright (C) 1991-1993, 1998, 2001-2002, 2004, 2009-2010 Free Software
< +   Foundation, Inc.
<  
<     This file is part of GNU DIFF.
<  
< @@ -150,7 +150,7 @@ print_half_line (char const *const *line
<  		break;
<  	      }
<  	  }
< -	  FALLTHROUGH;
< +	  /* Fall through.  */
<  	case '\f':
<  	case '\v':
<  	  if (in_position < out_bound)
< @@ -206,18 +206,6 @@ print_1sdiff_line (char const *const *le
<    size_t c2o = sdiff_column2_offset;
<    size_t col = 0;
<    bool put_newline = false;
< -  bool color_to_reset = false;
< -
< -  if (sep == '<')
< -    {
< -      set_color_context (DELETE_CONTEXT);
< -      color_to_reset = true;
< -    }
< -  else if (sep == '>')
< -    {
< -      set_color_context (ADD_CONTEXT);
< -      color_to_reset = true;
< -    }
<  
<    if (left)
<      {
< @@ -245,9 +233,6 @@ print_1sdiff_line (char const *const *le
<  
<    if (put_newline)
<      putc ('\n', out);
< -
< -  if (color_to_reset)
< -    set_color_context (RESET_CONTEXT);
<  }
<  
<  /* Print lines common to both files in side-by-side format.  */
< @@ -260,9 +245,9 @@ print_sdiff_common_lines (lin limit0, li
<      {
<        if (sdiff_merge_assist)
<  	{
< -	  printint len0 = limit0 - i0;
< -	  printint len1 = limit1 - i1;
< -	  fprintf (outfile, "i%"pI"d,%"pI"d\n", len0, len1);
< +	  long int len0 = limit0 - i0;
< +	  long int len1 = limit1 - i1;
< +	  fprintf (outfile, "i%ld,%ld\n", len0, len1);
<  	}
<  
<        if (!left_column)
< @@ -302,12 +287,12 @@ print_sdiff_hunk (struct change *hunk)
<  
<    if (sdiff_merge_assist)
<      {
< -      printint len0 = last0 - first0 + 1;
< -      printint len1 = last1 - first1 + 1;
< -      fprintf (outfile, "c%"pI"d,%"pI"d\n", len0, len1);
< +      long int len0 = last0 - first0 + 1;
< +      long int len1 = last1 - first1 + 1;
< +      fprintf (outfile, "c%ld,%ld\n", len0, len1);
<      }
<  
< -  /* Print "xxx  |  xxx " lines.  */
< +  /* Print ``xxx  |  xxx '' lines */
<    if (changes == CHANGED)
<      {
<        for (i = first0, j = first1;  i <= last0 && j <= last1;  i++, j++)
< @@ -317,7 +302,7 @@ print_sdiff_hunk (struct change *hunk)
<        next1 = first1 = j;
<      }
<  
< -  /* Print "     >  xxx " lines.  */
< +  /* Print ``     >  xxx '' lines */
<    if (changes & NEW)
<      {
<        for (j = first1; j <= last1; ++j)
< @@ -325,7 +310,7 @@ print_sdiff_hunk (struct change *hunk)
<        next1 = j;
<      }
<  
< -  /* Print "xxx  <     " lines.  */
< +  /* Print ``xxx  <     '' lines */
<    if (changes & OLD)
<      {
<        for (i = first0; i <= last0; ++i)
< Only in diffutils-3.0-patch/src: side.o
< diff -pru diffutils-3.0/src/system.h diffutils-3.0-patch/src/system.h
< --- diffutils-3.0/src/system.h	2020-03-01 22:03:00.485732000 -0800
< +++ diffutils-3.0-patch/src/system.h	2020-03-01 16:00:19.132481000 -0800
< @@ -1,7 +1,7 @@
<  /* System dependent declarations.
<  
< -   Copyright (C) 1988-1989, 1992-1995, 1998, 2001-2002, 2004, 2006, 2009-2013,
< -   2015-2017 Free Software Foundation, Inc.
< +   Copyright (C) 1988-1989, 1992-1995, 1998, 2001-2002, 2004, 2006, 2009-2010
< +   Free Software Foundation, Inc.
<  
<     This file is part of GNU DIFF.
<  
< @@ -20,14 +20,14 @@
<  
<  #include <config.h>
<  
< -/* Use this to suppress gcc's "...may be used before initialized" warnings. */
< +/* Use this to suppress gcc's `...may be used before initialized' warnings. */
<  #ifdef lint
<  # define IF_LINT(Code) Code
<  #else
<  # define IF_LINT(Code) /* empty */
<  #endif
<  
< -/* Define '__attribute__' and 'volatile' first
< +/* Define `__attribute__' and `volatile' first
<     so that they're used consistently in all system includes.  */
<  #if __GNUC__ < 2 || (__GNUC__ == 2 && __GNUC_MINOR__ < 6) || __STRICT_ANSI__
<  # define __attribute__(x)
< @@ -54,6 +54,12 @@
<  #include <time.h>
<  
<  #include <sys/wait.h>
< +#ifndef WEXITSTATUS
< +# define WEXITSTATUS(stat_val) ((unsigned int) (stat_val) >> 8)
< +#endif
< +#ifndef WIFEXITED
< +# define WIFEXITED(stat_val) (((stat_val) & 255) == 0)
< +#endif
<  
<  #include <dirent.h>
<  #ifndef _D_EXACT_NAMLEN
< @@ -99,12 +105,19 @@ int strcasecmp (char const *, char const
<     - It's typically faster.
<     POSIX 1003.1-2001 says that only '0' through '9' are digits.
<     Prefer ISDIGIT to isdigit unless it's important to use the locale's
< -   definition of 'digit' even when the host does not conform to POSIX.  */
< +   definition of `digit' even when the host does not conform to POSIX.  */
<  #define ISDIGIT(c) ((unsigned int) (c) - '0' <= 9)
<  
<  #include <errno.h>
<  
<  #include <signal.h>
< +#ifndef SA_RESTART
< +# ifdef SA_INTERRUPT /* e.g. SunOS 4.1.x */
< +#  define SA_RESTART SA_INTERRUPT
< +# else
< +#  define SA_RESTART 0
< +# endif
< +#endif
<  #if !defined SIGCHLD && defined SIGCLD
<  # define SIGCHLD SIGCLD
<  #endif
< @@ -115,49 +128,32 @@ int strcasecmp (char const *, char const
<  #define MAX(a, b) ((a) >= (b) ? (a) : (b))
<  
<  #include <stdbool.h>
< +
< +#if HAVE_VFORK_H
< +# include <vfork.h>
< +#endif
< +
< +#if ! HAVE_WORKING_VFORK
< +# define vfork fork
< +#endif
< +
<  #include <intprops.h>
<  #include "propername.h"
< -#include "version.h"
<  
< -/* Type used for fast comparison of several bytes at a time.
< -   This used to be uintmax_t, but changing it to size_t
< -   made plain 'cmp' 90% faster (GCC 4.8.1, x86).  */
< +/* Type used for fast comparison of several bytes at a time.  */
<  
<  #ifndef word
< -# define word size_t
< +# define word uintmax_t
<  #endif
<  
< -/* The signed integer type of a line number.  Since files are read
< -   into main memory, ptrdiff_t should be wide enough.  */
< +/* The integer type of a line number.  Since files are read into main
< +   memory, ptrdiff_t should be wide enough.  */
<  
<  typedef ptrdiff_t lin;
<  #define LIN_MAX PTRDIFF_MAX
< -
< -/* The signed integer type for printing line numbers, and its printf
< -   length modifier.  This is not simply ptrdiff_t, to cater to older
< -   and/or nonstandard C libraries where "l" works but "ll" and "t" do
< -   not, or where 'long' is too narrow and "ll" works but "t" does not.  */
< -
< -#if LIN_MAX <= LONG_MAX
< -typedef long int printint;
< -# define pI "l"
< -#elif LIN_MAX <= LLONG_MAX
< -typedef long long int printint;
< -# define pI "ll"
< -#else
< -typedef ptrdiff_t printint;
< -# define pI "t"
< -#endif
< -
<  verify (TYPE_SIGNED (lin));
< -verify (TYPE_SIGNED (printint));
< -verify (LIN_MAX == TYPE_MAXIMUM (lin));
< -verify (LIN_MAX <= TYPE_MAXIMUM (printint));
< -
< -/* Limit so that 2 * CONTEXT + 1 does not overflow.  */
< -
< -#define CONTEXT_MAX ((LIN_MAX - 1) / 2)
< -
< +verify (sizeof (ptrdiff_t) <= sizeof (lin));
< +verify (sizeof (lin) <= sizeof (long int));
<  
<  /* This section contains POSIX-compliant defaults for macros
<     that are meant to be overridden by hand in config.h as needed.  */
< @@ -176,7 +172,7 @@ verify (LIN_MAX <= TYPE_MAXIMUM (printin
<  
<  /* Do struct stat *S, *T describe the same special file?  */
<  #ifndef same_special_file
< -# if HAVE_STRUCT_STAT_ST_RDEV && defined S_ISBLK && defined S_ISCHR
< +# if HAVE_ST_RDEV && defined S_ISBLK && defined S_ISCHR
<  #  define same_special_file(s, t) \
<       (((S_ISBLK ((s)->st_mode) && S_ISBLK ((t)->st_mode)) \
<         || (S_ISCHR ((s)->st_mode) && S_ISCHR ((t)->st_mode))) \
< @@ -230,11 +226,3 @@ verify (LIN_MAX <= TYPE_MAXIMUM (printin
<  #endif
<  
<  #define STREQ(a, b) (strcmp (a, b) == 0)
< -
< -#ifndef FALLTHROUGH
< -# if __GNUC__ < 7
< -#  define FALLTHROUGH ((void) 0)
< -# else
< -#  define FALLTHROUGH __attribute__ ((__fallthrough__))
< -# endif
< -#endif
< diff -pru diffutils-3.0/src/util.c diffutils-3.0-patch/src/util.c
< --- diffutils-3.0/src/util.c	2020-03-01 22:03:00.487729000 -0800
< +++ diffutils-3.0-patch/src/util.c	2020-03-01 16:04:25.601110000 -0800
< @@ -1,7 +1,7 @@
<  /* Support routines for GNU DIFF.
<  
< -   Copyright (C) 1988-1989, 1992-1995, 1998, 2001-2002, 2004, 2006, 2009-2013,
< -   2015-2017 Free Software Foundation, Inc.
< +   Copyright (C) 1988-1989, 1992-1995, 1998, 2001-2002, 2004, 2006, 2009-2010
< +   Free Software Foundation, Inc.
<  
<     This file is part of GNU DIFF.
<  
< @@ -19,34 +19,15 @@
<     along with this program.  If not, see <http://www.gnu.org/licenses/>.  */
<  
<  #include "diff.h"
< -#include "argmatch.h"
< -#include "die.h"
<  #include <dirname.h>
<  #include <error.h>
< -#include <system-quote.h>
< +#include <sh-quote.h>
<  #include <xalloc.h>
< -#include "xvasprintf.h"
< -#include <signal.h>
< -
< -/* Use SA_NOCLDSTOP as a proxy for whether the sigaction machinery is
< -   present.  */
< -#ifndef SA_NOCLDSTOP
< -# define SA_NOCLDSTOP 0
< -# define sigprocmask(How, Set, Oset) /* empty */
< -# define sigset_t int
< -# if ! HAVE_SIGINTERRUPT
< -#  define siginterrupt(sig, flag) /* empty */
< -# endif
< -#endif
< -
< -#ifndef SA_RESTART
< -# define SA_RESTART 0
< -#endif
<  
<  char const pr_program[] = PR_PROGRAM;
<  
<  /* Queue up one-line messages to be printed at the end,
< -   when -l is specified.  Each message is recorded with a 'struct msg'.  */
< +   when -l is specified.  Each message is recorded with a `struct msg'.  */
<  
<  struct msg
<  {
< @@ -78,7 +59,8 @@ pfatal_with_name (char const *name)
<  {
<    int e = errno;
<    print_message_queue ();
< -  die (EXIT_TROUBLE, e, "%s", name);
< +  error (EXIT_TROUBLE, e, "%s", name);
< +  abort ();
<  }
<  
<  /* Print an error message containing MSGID, then exit.  */
< @@ -87,7 +69,8 @@ void
<  fatal (char const *msgid)
<  {
<    print_message_queue ();
< -  die (EXIT_TROUBLE, 0, "%s", _(msgid));
< +  error (EXIT_TROUBLE, 0, "%s", _(msgid));
< +  abort ();
<  }
<  
<  /* Like printf, except if -l in effect then save the message and print later.
< @@ -138,7 +121,7 @@ message5 (char const *format_msgid, char
<      }
---
>    abort ();
6950,7737c277,311
<  
< -/* Output all the messages that were saved up by calls to 'message'.  */
< +/* Output all the messages that were saved up by calls to `message'.  */
<  
<  void
<  print_message_queue (void)
< @@ -159,574 +142,16 @@ print_message_queue (void)
<      }
<  }
<  
< -/* The set of signals that are caught.  */
< -
< -static sigset_t caught_signals;
< -
< -/* If nonzero, the value of the pending fatal signal.  */
< -
< -static sig_atomic_t volatile interrupt_signal;
< -
< -/* A count of the number of pending stop signals that have been received.  */
< -
< -static sig_atomic_t volatile stop_signal_count;
< -
< -/* An ordinary signal was received; arrange for the program to exit.  */
< -
< -static void
< -sighandler (int sig)
< -{
< -  if (! SA_NOCLDSTOP)
< -    signal (sig, SIG_IGN);
< -  if (! interrupt_signal)
< -    interrupt_signal = sig;
< -}
< -
< -/* A SIGTSTP was received; arrange for the program to suspend itself.  */
< -
< -static void
< -stophandler (int sig)
< -{
< -  if (! SA_NOCLDSTOP)
< -    signal (sig, stophandler);
< -  if (! interrupt_signal)
< -    stop_signal_count++;
< -}
< -/* Process any pending signals.  If signals are caught, this function
< -   should be called periodically.  Ideally there should never be an
< -   unbounded amount of time when signals are not being processed.
< -   Signal handling can restore the default colors, so callers must
< -   immediately change colors after invoking this function.  */
< -
< -static void
< -process_signals (void)
< -{
< -  while (interrupt_signal || stop_signal_count)
< -    {
< -      int sig;
< -      int stops;
< -      sigset_t oldset;
< -
< -      set_color_context (RESET_CONTEXT);
< -      fflush (stdout);
< -
< -      sigprocmask (SIG_BLOCK, &caught_signals, &oldset);
< -
< -      /* Reload interrupt_signal and stop_signal_count, in case a new
< -         signal was handled before sigprocmask took effect.  */
< -      sig = interrupt_signal;
< -      stops = stop_signal_count;
< -
< -      /* SIGTSTP is special, since the application can receive that signal
< -         more than once.  In this case, don't set the signal handler to the
< -         default.  Instead, just raise the uncatchable SIGSTOP.  */
< -      if (stops)
< -        {
< -          stop_signal_count = stops - 1;
< -          sig = SIGSTOP;
< -        }
< -      else
< -        signal (sig, SIG_DFL);
< -
< -      /* Exit or suspend the program.  */
< -      raise (sig);
< -      sigprocmask (SIG_SETMASK, &oldset, NULL);
< -
< -      /* If execution reaches here, then the program has been
< -         continued (after being suspended).  */
< -    }
< -}
< -
< -static void
< -install_signal_handlers (void)
< -{
< -  /* The signals that are trapped, and the number of such signals.  */
< -  static int const sig[] =
< -    {
< -      /* This one is handled specially.  */
< -      SIGTSTP,
< -
< -      /* The usual suspects.  */
< -      SIGALRM, SIGHUP, SIGINT, SIGPIPE, SIGQUIT, SIGTERM,
< -#ifdef SIGPOLL
< -      SIGPOLL,
< -#endif
< -#ifdef SIGPROF
< -      SIGPROF,
< -#endif
< -#ifdef SIGVTALRM
< -      SIGVTALRM,
< -#endif
< -#ifdef SIGXCPU
< -      SIGXCPU,
< -#endif
< -#ifdef SIGXFSZ
< -      SIGXFSZ,
< -#endif
< -    };
< -  enum { nsigs = sizeof (sig) / sizeof *(sig) };
< -
< -#if ! SA_NOCLDSTOP
< -  bool caught_sig[nsigs];
< -#endif
< -  {
< -    int j;
< -#if SA_NOCLDSTOP
< -    struct sigaction act;
< -
< -    sigemptyset (&caught_signals);
< -    for (j = 0; j < nsigs; j++)
< -      {
< -        sigaction (sig[j], NULL, &act);
< -        if (act.sa_handler != SIG_IGN)
< -          sigaddset (&caught_signals, sig[j]);
< -      }
< -
< -    act.sa_mask = caught_signals;
< -    act.sa_flags = SA_RESTART;
< +/* Call before outputting the results of comparing files NAME0 and NAME1
< +   to set up OUTFILE, the stdio stream for the output to go to.
<  
< -    for (j = 0; j < nsigs; j++)
< -      if (sigismember (&caught_signals, sig[j]))
< -        {
< -          act.sa_handler = sig[j] == SIGTSTP ? stophandler : sighandler;
< -          sigaction (sig[j], &act, NULL);
< -        }
< -#else
< -    for (j = 0; j < nsigs; j++)
< -      {
< -        caught_sig[j] = (signal (sig[j], SIG_IGN) != SIG_IGN);
< -        if (caught_sig[j])
< -          {
< -            signal (sig[j], sig[j] == SIGTSTP ? stophandler : sighandler);
< -            siginterrupt (sig[j], 0);
< -          }
< -      }
< -#endif
< -    }
< -}
< +   Usually, OUTFILE is just stdout.  But when -l was specified
< +   we fork off a `pr' and make OUTFILE a pipe to it.
< +   `pr' then outputs to our stdout.  */
<  
<  static char const *current_name0;
<  static char const *current_name1;
<  static bool currently_recursive;
< -static bool colors_enabled;
< -
< -static struct color_ext_type *color_ext_list = NULL;
< -
< -struct bin_str
< -  {
< -    size_t len;			/* Number of bytes */
< -    const char *string;		/* Pointer to the same */
< -  };
< -
< -struct color_ext_type
< -  {
< -    struct bin_str ext;		/* The extension we're looking for */
< -    struct bin_str seq;		/* The sequence to output when we do */
< -    struct color_ext_type *next;	/* Next in list */
< -  };
< -
< -/* Parse a string as part of the --palette argument; this may involve
< -   decoding all kinds of escape characters.  If equals_end is set an
< -   unescaped equal sign ends the string, otherwise only a : or \0
< -   does.  Set *OUTPUT_COUNT to the number of bytes output.  Return
< -   true if successful.
< -
< -   The resulting string is *not* null-terminated, but may contain
< -   embedded nulls.
< -
< -   Note that both dest and src are char **; on return they point to
< -   the first free byte after the array and the character that ended
< -   the input string, respectively.  */
< -
< -static bool
< -get_funky_string (char **dest, const char **src, bool equals_end,
< -                  size_t *output_count)
< -{
< -  char num;			/* For numerical codes */
< -  size_t count;			/* Something to count with */
< -  enum {
< -    ST_GND, ST_BACKSLASH, ST_OCTAL, ST_HEX, ST_CARET, ST_END, ST_ERROR
< -  } state;
< -  const char *p;
< -  char *q;
< -
< -  p = *src;			/* We don't want to double-indirect */
< -  q = *dest;			/* the whole darn time.  */
< -
< -  count = 0;			/* No characters counted in yet.  */
< -  num = 0;
< -
< -  state = ST_GND;		/* Start in ground state.  */
< -  while (state < ST_END)
< -    {
< -      switch (state)
< -        {
< -        case ST_GND:		/* Ground state (no escapes) */
< -          switch (*p)
< -            {
< -            case ':':
< -            case '\0':
< -              state = ST_END;	/* End of string */
< -              break;
< -            case '\\':
< -              state = ST_BACKSLASH; /* Backslash scape sequence */
< -              ++p;
< -              break;
< -            case '^':
< -              state = ST_CARET; /* Caret escape */
< -              ++p;
< -              break;
< -            case '=':
< -              if (equals_end)
< -                {
< -                  state = ST_END; /* End */
< -                  break;
< -                }
< -              FALLTHROUGH;
< -            default:
< -              *(q++) = *(p++);
< -              ++count;
< -              break;
< -            }
< -          break;
< -
< -        case ST_BACKSLASH:	/* Backslash escaped character */
< -          switch (*p)
< -            {
< -            case '0':
< -            case '1':
< -            case '2':
< -            case '3':
< -            case '4':
< -            case '5':
< -            case '6':
< -            case '7':
< -              state = ST_OCTAL;	/* Octal sequence */
< -              num = *p - '0';
< -              break;
< -            case 'x':
< -            case 'X':
< -              state = ST_HEX;	/* Hex sequence */
< -              num = 0;
< -              break;
< -            case 'a':		/* Bell */
< -              num = '\a';
< -              break;
< -            case 'b':		/* Backspace */
< -              num = '\b';
< -              break;
< -            case 'e':		/* Escape */
< -              num = 27;
< -              break;
< -            case 'f':		/* Form feed */
< -              num = '\f';
< -              break;
< -            case 'n':		/* Newline */
< -              num = '\n';
< -              break;
< -            case 'r':		/* Carriage return */
< -              num = '\r';
< -              break;
< -            case 't':		/* Tab */
< -              num = '\t';
< -              break;
< -            case 'v':		/* Vtab */
< -              num = '\v';
< -              break;
< -            case '?':		/* Delete */
< -              num = 127;
< -              break;
< -            case '_':		/* Space */
< -              num = ' ';
< -              break;
< -            case '\0':		/* End of string */
< -              state = ST_ERROR;	/* Error! */
< -              break;
< -            default:		/* Escaped character like \ ^ : = */
< -              num = *p;
< -              break;
< -            }
< -          if (state == ST_BACKSLASH)
< -            {
< -              *(q++) = num;
< -              ++count;
< -              state = ST_GND;
< -            }
< -          ++p;
< -          break;
< -
< -        case ST_OCTAL:		/* Octal sequence */
< -          if (*p < '0' || *p > '7')
< -            {
< -              *(q++) = num;
< -              ++count;
< -              state = ST_GND;
< -            }
< -          else
< -            num = (num << 3) + (*(p++) - '0');
< -          break;
< -
< -        case ST_HEX:		/* Hex sequence */
< -          switch (*p)
< -            {
< -            case '0':
< -            case '1':
< -            case '2':
< -            case '3':
< -            case '4':
< -            case '5':
< -            case '6':
< -            case '7':
< -            case '8':
< -            case '9':
< -              num = (num << 4) + (*(p++) - '0');
< -              break;
< -            case 'a':
< -            case 'b':
< -            case 'c':
< -            case 'd':
< -            case 'e':
< -            case 'f':
< -              num = (num << 4) + (*(p++) - 'a') + 10;
< -              break;
< -            case 'A':
< -            case 'B':
< -            case 'C':
< -            case 'D':
< -            case 'E':
< -            case 'F':
< -              num = (num << 4) + (*(p++) - 'A') + 10;
< -              break;
< -            default:
< -              *(q++) = num;
< -              ++count;
< -              state = ST_GND;
< -              break;
< -            }
< -          break;
< -
< -        case ST_CARET:		/* Caret escape */
< -          state = ST_GND;	/* Should be the next state... */
< -          if (*p >= '@' && *p <= '~')
< -            {
< -              *(q++) = *(p++) & 037;
< -              ++count;
< -            }
< -          else if (*p == '?')
< -            {
< -              *(q++) = 127;
< -              ++count;
< -            }
< -          else
< -            state = ST_ERROR;
< -          break;
< -
< -        default:
< -          abort ();
< -        }
< -    }
< -
< -  *dest = q;
< -  *src = p;
< -  *output_count = count;
< -
< -  return state != ST_ERROR;
< -}
< -
< -enum parse_state
< -  {
< -    PS_START = 1,
< -    PS_2,
< -    PS_3,
< -    PS_4,
< -    PS_DONE,
< -    PS_FAIL
< -  };
< -
< -#define LEN_STR_PAIR(s) sizeof (s) - 1, s
< -
< -static struct bin_str color_indicator[] =
< -  {
< -    { LEN_STR_PAIR ("\033[") },		/* lc: Left of color sequence */
< -    { LEN_STR_PAIR ("m") },		/* rc: Right of color sequence */
< -    { 0, NULL },			/* ec: End color (replaces lc+rs+rc) */
< -    { LEN_STR_PAIR ("0") },		/* rs: Reset to ordinary colors */
< -    { LEN_STR_PAIR ("1") },		/* hd: Header */
< -    { LEN_STR_PAIR ("32") },		/* ad: Add line */
< -    { LEN_STR_PAIR ("31") },		/* de: Delete line */
< -    { LEN_STR_PAIR ("36") },		/* ln: Line number */
< -  };
< -
< -static const char *const indicator_name[] =
< -  {
< -    "lc", "rc", "ec", "rs", "hd", "ad", "de", "ln", NULL
< -  };
< -ARGMATCH_VERIFY (indicator_name, color_indicator);
< -
< -static char const *color_palette;
< -
< -void
< -set_color_palette (char const *palette)
< -{
< -  color_palette = palette;
< -}
< -
< -static void
< -parse_diff_color (void)
< -{
< -  char *color_buf;
< -  const char *p;		/* Pointer to character being parsed */
< -  char *buf;			/* color_buf buffer pointer */
< -  int ind_no;			/* Indicator number */
< -  char label[3];		/* Indicator label */
< -  struct color_ext_type *ext;	/* Extension we are working on */
< -
< -  if ((p = color_palette) == NULL || *p == '\0')
< -    return;
< -
< -  ext = NULL;
< -  strcpy (label, "??");
< -
< -  /* This is an overly conservative estimate, but any possible
< -     --palette string will *not* generate a color_buf longer than
< -     itself, so it is a safe way of allocating a buffer in
< -     advance.  */
< -  buf = color_buf = xstrdup (p);
< -
< -  enum parse_state state = PS_START;
< -  while (true)
< -    {
< -      switch (state)
< -        {
< -        case PS_START:		/* First label character */
< -          switch (*p)
< -            {
< -            case ':':
< -              ++p;
< -              break;
< -
< -            case '*':
< -              /* Allocate new extension block and add to head of
< -                 linked list (this way a later definition will
< -                 override an earlier one, which can be useful for
< -                 having terminal-specific defs override global).  */
< -
< -              ext = xmalloc (sizeof *ext);
< -              ext->next = color_ext_list;
< -              color_ext_list = ext;
< -
< -              ++p;
< -              ext->ext.string = buf;
< -
< -              state = (get_funky_string (&buf, &p, true, &ext->ext.len)
< -                       ? PS_4 : PS_FAIL);
< -              break;
< -
< -            case '\0':
< -              state = PS_DONE;	/* Done! */
< -              goto done;
< -
< -            default:	/* Assume it is file type label */
< -              label[0] = *(p++);
< -              state = PS_2;
< -              break;
< -            }
< -          break;
< -
< -        case PS_2:		/* Second label character */
< -          if (*p)
< -            {
< -              label[1] = *(p++);
< -              state = PS_3;
< -            }
< -          else
< -            state = PS_FAIL;	/* Error */
< -          break;
< -
< -        case PS_3:		/* Equal sign after indicator label */
< -          state = PS_FAIL;	/* Assume failure...  */
< -          if (*(p++) == '=')/* It *should* be...  */
< -            {
< -              for (ind_no = 0; indicator_name[ind_no] != NULL; ++ind_no)
< -                {
< -                  if (STREQ (label, indicator_name[ind_no]))
< -                    {
< -                      color_indicator[ind_no].string = buf;
< -                      state = (get_funky_string (&buf, &p, false,
< -                                                 &color_indicator[ind_no].len)
< -                               ? PS_START : PS_FAIL);
< -                      break;
< -                    }
< -                }
< -              if (state == PS_FAIL)
< -                error (0, 0, _("unrecognized prefix: %s"), label);
< -            }
< -          break;
< -
< -        case PS_4:		/* Equal sign after *.ext */
< -          if (*(p++) == '=')
< -            {
< -              ext->seq.string = buf;
< -              state = (get_funky_string (&buf, &p, false, &ext->seq.len)
< -                       ? PS_START : PS_FAIL);
< -            }
< -          else
< -            state = PS_FAIL;
< -          break;
< -
< -        case PS_FAIL:
< -          goto done;
< -
< -        default:
< -          abort ();
< -        }
< -    }
< - done:
< -
< -  if (state == PS_FAIL)
< -    {
< -      struct color_ext_type *e;
< -      struct color_ext_type *e2;
< -
< -      error (0, 0,
< -             _("unparsable value for --palette"));
< -      free (color_buf);
< -      for (e = color_ext_list; e != NULL; /* empty */)
< -        {
< -          e2 = e;
< -          e = e->next;
< -          free (e2);
< -        }
< -      colors_enabled = false;
< -    }
< -}
< -
< -static void
< -check_color_output (bool is_pipe)
< -{
< -  bool output_is_tty;
< -
< -  if (! outfile || colors_style == NEVER)
< -    return;
< -
< -  output_is_tty = presume_output_tty || (!is_pipe && isatty (fileno (outfile)));
< -
< -  colors_enabled = (colors_style == ALWAYS
< -                    || (colors_style == AUTO && output_is_tty));
< -
< -  if (colors_enabled)
< -    parse_diff_color ();
< -
< -  if (output_is_tty)
< -    install_signal_handlers ();
< -}
< -
< -/* Call before outputting the results of comparing files NAME0 and NAME1
< -   to set up OUTFILE, the stdio stream for the output to go to.
< -
< -   Usually, OUTFILE is just stdout.  But when -l was specified
< -   we fork off a 'pr' and make OUTFILE a pipe to it.
< -   'pr' then outputs to our stdout.  */
<  
<  void
<  setup_output (char const *name0, char const *name1, bool recursive)
< @@ -737,134 +162,43 @@ setup_output (char const *name0, char co
<    outfile = 0;
<  }
<  
< -#if HAVE_WORKING_FORK
< +#if HAVE_WORKING_FORK || HAVE_WORKING_VFORK
<  static pid_t pr_pid;
<  #endif
<  
< -static char c_escape_char (char c)
< -{
< -  switch (c) {
< -    case '\a': return 'a';
< -    case '\b': return 'b';
< -    case '\t': return 't';
< -    case '\n': return 'n';
< -    case '\v': return 'v';
< -    case '\f': return 'f';
< -    case '\r': return 'r';
< -    case '"': return '"';
< -    case '\\': return '\\';
< -    default:
< -      return c < 32;
< -  }
< -}
< -
< -static char *
< -c_escape (char const *str)
< -{
< -  char const *s;
< -  size_t plus = 0;
< -  bool must_quote = false;
< -
< -  for (s = str; *s; s++)
< -    {
< -      char c = *s;
< -
< -      if (c == ' ')
< -	{
< -	  must_quote = true;
< -	  continue;
< -	}
< -      switch (c_escape_char (*s))
< -	{
< -	  case 1:
< -	    plus += 3;
< -	    /* fall through */
< -	  case 0:
< -	    break;
< -	  default:
< -	    plus++;
< -	    break;
< -	}
< -    }
< -
< -  if (must_quote || plus)
< -    {
< -      size_t s_len = s - str;
< -      char *buffer = xmalloc (s_len + plus + 3);
< -      char *b = buffer;
< -
< -      *b++ = '"';
< -      for (s = str; *s; s++)
< -	{
< -	  char c = *s;
< -	  char escape = c_escape_char (c);
< -
< -	  switch (escape)
< -	    {
< -	      case 0:
< -		*b++ = c;
< -		break;
< -	      case 1:
< -		*b++ = '\\';
< -		*b++ = ((c >> 6) & 03) + '0';
< -		*b++ = ((c >> 3) & 07) + '0';
< -		*b++ = ((c >> 0) & 07) + '0';
< -		break;
< -	      default:
< -		*b++ = '\\';
< -		*b++ = escape;
< -		break;
< -	    }
< -	}
< -      *b++ = '"';
< -      *b = 0;
< -      return buffer;
< -    }
< -
< -  return (char *) str;
< -}
< -
<  void
<  begin_output (void)
<  {
< -  char *names[2];
<    char *name;
<  
<    if (outfile != 0)
<      return;
<  
< -  names[0] = c_escape (current_name0);
< -  names[1] = c_escape (current_name1);
< -
<    /* Construct the header of this piece of diff.  */
< +  name = xmalloc (strlen (current_name0) + strlen (current_name1)
< +		  + strlen (switch_string) + 7);
< +
<    /* POSIX 1003.1-2001 specifies this format.  But there are some bugs in
<       the standard: it says that we must print only the last component
<       of the pathnames, and it requires two spaces after "diff" if
<       there are no options.  These requirements are silly and do not
<       match historical practice.  */
< -  name = xasprintf ("diff%s %s %s", switch_string, names[0], names[1]);
< +  sprintf (name, "diff%s %s %s", switch_string, current_name0, current_name1);
<  
<    if (paginate)
<      {
< -      char const *argv[4];
< -
<        if (fflush (stdout) != 0)
<  	pfatal_with_name (_("write failed"));
<  
< -      argv[0] = pr_program;
< -      argv[1] = "-h";
< -      argv[2] = name;
< -      argv[3] = 0;
< -
< -      /* Make OUTFILE a pipe to a subsidiary 'pr'.  */
< +      /* Make OUTFILE a pipe to a subsidiary `pr'.  */
<        {
< -#if HAVE_WORKING_FORK
< +#if HAVE_WORKING_FORK || HAVE_WORKING_VFORK
<  	int pipes[2];
<  
<  	if (pipe (pipes) != 0)
<  	  pfatal_with_name ("pipe");
<  
< -	pr_pid = fork ();
< +	pr_pid = vfork ();
<  	if (pr_pid < 0)
<  	  pfatal_with_name ("fork");
<  
< @@ -878,7 +212,7 @@ begin_output (void)
<  		close (pipes[0]);
<  	      }
<  
< -	    execv (pr_program, (char **) argv);
< +	    execl (pr_program, pr_program, "-h", name, (char *) 0);
<  	    _exit (errno == ENOENT ? 127 : 126);
<  	  }
<  	else
< @@ -887,15 +221,19 @@ begin_output (void)
<  	    outfile = fdopen (pipes[1], "w");
<  	    if (!outfile)
<  	      pfatal_with_name ("fdopen");
< -	    check_color_output (true);
<  	  }
<  #else
< -	char *command = system_quote_argv (SCI_SYSTEM, (char **) argv);
< +	char *command = xmalloc (sizeof pr_program - 1 + 7
< +				 + shell_quote_length (name) + 1);
< +	char *p;
< +	sprintf (command, "%s -f -h ", pr_program);
< +	p = command + sizeof pr_program - 1 + 7;
< +	p = shell_quote_copy (p, name);
< +	*p = 0;
<  	errno = 0;
<  	outfile = popen (command, "w");
<  	if (!outfile)
<  	  pfatal_with_name (command);
< -	check_color_output (true);
<  	free (command);
<  #endif
<        }
< @@ -903,10 +241,9 @@ begin_output (void)
<    else
<      {
<  
< -      /* If -l was not specified, output the diff straight to 'stdout'.  */
< +      /* If -l was not specified, output the diff straight to `stdout'.  */
<  
<        outfile = stdout;
< -      check_color_output (false);
<  
<        /* If handling multiple files (because scanning a directory),
<  	 print which files the following output is about.  */
< @@ -920,25 +257,20 @@ begin_output (void)
<    switch (output_style)
<      {
<      case OUTPUT_CONTEXT:
< -      print_context_header (files, (char const *const *)names, false);
< +      print_context_header (files, false);
<        break;
<  
<      case OUTPUT_UNIFIED:
< -      print_context_header (files, (char const *const *)names, true);
< +      print_context_header (files, true);
<        break;
<  
<      default:
<        break;
---
> @@ -230,7 +230,7 @@ usage (void)
>      else
>        putchar ('\n');
>    printf ("\n%s\n%s\n",
> -	  _("If a FILE is `-', read standard input."),
> +	  _("If a FILE is '-', read standard input."),
>  	  _("Exit status is 0 if inputs are the same, 1 if different, 2 if trouble."));
>    emit_bug_reporting_address ();
>  }
> @@ -286,12 +286,12 @@ check_child_status (int werrno, int wstatus, int max_ok_status,
>      {
>        error (0, werrno,
>  	     _(status == 126
> -	       ? "subsidiary program `%s' could not be invoked"
> +	       ? "subsidiary program '%s' could not be invoked"
>  	       : status == 127
> -	       ? "subsidiary program `%s' not found"
> +	       ? "subsidiary program '%s' not found"
>  	       : status == INT_MAX
> -	       ? "subsidiary program `%s' failed"
> -	       : "subsidiary program `%s' failed (exit status %d)"),
> +	       ? "subsidiary program '%s' failed"
> +	       : "subsidiary program '%s' failed (exit status %d)"),
>  	     subsidiary_program, status);
>        exiterr ();
>      }
> @@ -572,9 +572,9 @@ main (int argc, char *argv[])
>    if (argc - optind != 2)
>      {
>        if (argc - optind < 2)
> -	try_help ("missing operand after `%s'", argv[argc - 1]);
> +	try_help ("missing operand after '%s'", argv[argc - 1]);
>        else
> -	try_help ("extra operand `%s'", argv[optind + 2]);
> +	try_help ("extra operand '%s'", argv[optind + 2]);
7739,7748d312
< -
< -  if (names[0] != current_name0)
< -    free (names[0]);
< -  if (names[1] != current_name1)
< -    free (names[1]);
<  }
<  
<  /* Call after the end of output of diffs for one file.
< -   Close OUTFILE and get rid of the 'pr' subfork.  */
< +   Close OUTFILE and get rid of the `pr' subfork.  */
7750,7763c314,319
<  void
<  finish_output (void)
< @@ -950,7 +282,7 @@ finish_output (void)
<        int werrno = 0;
<        if (ferror (outfile))
<  	fatal ("write failed");
< -#if ! HAVE_WORKING_FORK
< +#if ! (HAVE_WORKING_FORK || HAVE_WORKING_VFORK)
<        wstatus = pclose (outfile);
<        if (wstatus == -1)
<  	werrno = errno;
< @@ -964,7 +296,7 @@ finish_output (void)
<  		? WEXITSTATUS (wstatus)
<  		: INT_MAX);
---
>    if (! output)
> diff --git a/src/util.c b/src/util.c
> index 3be03e9..d18bf38 100644
> --- a/src/util.c
> +++ b/src/util.c
> @@ -298,12 +298,12 @@ finish_output (void)
7765,7766c321
< -	die (EXIT_TROUBLE, werrno,
< +	error (EXIT_TROUBLE, werrno,
---
>  	error (EXIT_TROUBLE, werrno,
7768c323,324
<  		 ? "subsidiary program '%s' could not be invoked"
---
> -		 ? "subsidiary program `%s' could not be invoked"
> +		 ? "subsidiary program '%s' could not be invoked"
7770,8003c326,333
< @@ -1063,33 +395,6 @@ lines_differ (char const *s1, char const
<  
<  	      break;
<  
< -	    case IGNORE_TRAILING_SPACE:
< -	    case IGNORE_TAB_EXPANSION_AND_TRAILING_SPACE:
< -	      if (isspace (c1) && isspace (c2))
< -		{
< -		  unsigned char c;
< -		  if (c1 != '\n')
< -		    {
< -		      char const *p = t1;
< -		      while ((c = *p) != '\n' && isspace (c))
< -			++p;
< -		      if (c != '\n')
< -			break;
< -		    }
< -		  if (c2 != '\n')
< -		    {
< -		      char const *p = t2;
< -		      while ((c = *p) != '\n' && isspace (c))
< -			++p;
< -		      if (c != '\n')
< -			break;
< -		    }
< -		  /* Both lines have nothing but whitespace left.  */
< -		  return false;
< -		}
< -	      if (ignore_white_space == IGNORE_TRAILING_SPACE)
< -		break;
< -	      FALLTHROUGH;
<  	    case IGNORE_TAB_EXPANSION:
<  	      if ((c1 == ' ' && c2 == '\t')
<  		  || (c1 == '\t' && c2 == ' '))
< @@ -1145,13 +450,13 @@ lines_differ (char const *s1, char const
<  /* Find the consecutive changes at the start of the script START.
<     Return the last link before the first gap.  */
<  
< -struct change * _GL_ATTRIBUTE_CONST
< +struct change *
<  find_change (struct change *start)
<  {
<    return start;
<  }
<  
< -struct change * _GL_ATTRIBUTE_CONST
< +struct change *
<  find_reverse_change (struct change *start)
<  {
<    return start;
< @@ -1207,18 +512,6 @@ print_script (struct change *script,
<  void
<  print_1_line (char const *line_flag, char const *const *line)
<  {
< -  print_1_line_nl (line_flag, line, false);
< -}
< -
< -/* Print the text of a single line LINE,
< -   flagging it with the characters in LINE_FLAG (which say whether
< -   the line is inserted, deleted, changed, etc.).  LINE_FLAG must not
< -   end in a blank, unless it is a single blank.  If SKIP_NL is set, then
< -   the final '\n' is not printed.  */
< -
< -void
< -print_1_line_nl (char const *line_flag, char const *const *line, bool skip_nl)
< -{
<    char const *base = line[0], *limit = line[1]; /* Help the compiler.  */
<    FILE *out = outfile; /* Help the compiler some more.  */
<    char const *flag_format = 0;
< @@ -1246,13 +539,10 @@ print_1_line_nl (char const *line_flag,
<        fprintf (out, flag_format_1, line_flag_1);
<      }
<  
< -  output_1_line (base, limit - (skip_nl && limit[-1] == '\n'), flag_format, line_flag);
< +  output_1_line (base, limit, flag_format, line_flag);
<  
<    if ((!line_flag || line_flag[0]) && limit[-1] != '\n')
< -    {
< -      set_color_context (RESET_CONTEXT);
< -      fprintf (out, "\n\\ %s\n", _("No newline at end of file"));
< -    }
< +    fprintf (out, "\n\\ %s\n", _("No newline at end of file"));
<  }
<  
<  /* Output a line from BASE up to LIMIT.
< @@ -1264,21 +554,8 @@ void
<  output_1_line (char const *base, char const *limit, char const *flag_format,
<  	       char const *line_flag)
<  {
< -  const size_t MAX_CHUNK = 1024;
<    if (!expand_tabs)
< -    {
< -      size_t left = limit - base;
< -      while (left)
< -        {
< -          size_t to_write = MIN (left, MAX_CHUNK);
< -          size_t written = fwrite (base, sizeof (char), to_write, outfile);
< -          if (written < to_write)
< -            return;
< -          base += written;
< -          left -= written;
< -          process_signals ();
< -        }
< -    }
< +    fwrite (base, sizeof (char), limit - base, outfile);
<    else
<      {
<        register FILE *out = outfile;
< @@ -1286,104 +563,42 @@ output_1_line (char const *base, char co
<        register char const *t = base;
<        register size_t column = 0;
<        size_t tab_size = tabsize;
< -      size_t counter_proc_signals = 0;
<  
<        while (t < limit)
< -        {
< -          counter_proc_signals++;
< -          if (counter_proc_signals == MAX_CHUNK)
< -            {
< -              process_signals ();
< -              counter_proc_signals = 0;
< -            }
< -
< -          switch ((c = *t++))
< -            {
< -            case '\t':
< -              {
< -                size_t spaces = tab_size - column % tab_size;
< -                column += spaces;
< -                do
< -                  putc (' ', out);
< -                while (--spaces);
< -              }
< -              break;
< -
< -            case '\r':
< -              putc (c, out);
< -              if (flag_format && t < limit && *t != '\n')
< -                fprintf (out, flag_format, line_flag);
< -              column = 0;
< -              break;
< -
< -            case '\b':
< -              if (column == 0)
< -                continue;
< -              column--;
< -              putc (c, out);
< -              break;
< -
< -            default:
< -              column += isprint (c) != 0;
< -              putc (c, out);
< -              break;
< -            }
< -        }
< -    }
< -}
< -
< -enum indicator_no
< -  {
< -    C_LEFT, C_RIGHT, C_END, C_RESET, C_HEADER, C_ADD, C_DELETE, C_LINE
< -  };
< +	switch ((c = *t++))
< +	  {
< +	  case '\t':
< +	    {
< +	      size_t spaces = tab_size - column % tab_size;
< +	      column += spaces;
< +	      do
< +		putc (' ', out);
< +	      while (--spaces);
< +	    }
< +	    break;
<  
< -static void
< -put_indicator (const struct bin_str *ind)
< -{
< -  fwrite (ind->string, ind->len, 1, outfile);
< -}
< +	  case '\r':
< +	    putc (c, out);
< +	    if (flag_format && t < limit && *t != '\n')
< +	      fprintf (out, flag_format, line_flag);
< +	    column = 0;
< +	    break;
<  
< -static enum color_context last_context = RESET_CONTEXT;
< +	  case '\b':
< +	    if (column == 0)
< +	      continue;
< +	    column--;
< +	    putc (c, out);
< +	    break;
<  
< -void
< -set_color_context (enum color_context color_context)
< -{
< -  if (color_context != RESET_CONTEXT)
< -    process_signals ();
< -  if (colors_enabled && last_context != color_context)
< -    {
< -      put_indicator (&color_indicator[C_LEFT]);
< -      switch (color_context)
< -        {
< -        case HEADER_CONTEXT:
< -          put_indicator (&color_indicator[C_HEADER]);
< -          break;
< -
< -        case LINE_NUMBER_CONTEXT:
< -          put_indicator (&color_indicator[C_LINE]);
< -          break;
< -
< -        case ADD_CONTEXT:
< -          put_indicator (&color_indicator[C_ADD]);
< -          break;
< -
< -        case DELETE_CONTEXT:
< -          put_indicator (&color_indicator[C_DELETE]);
< -          break;
< -
< -        case RESET_CONTEXT:
< -          put_indicator (&color_indicator[C_RESET]);
< -          break;
< -
< -        default:
< -          abort ();
< -        }
< -      put_indicator (&color_indicator[C_RIGHT]);
< -      last_context = color_context;
< +	  default:
< +	    column += isprint (c) != 0;
< +	    putc (c, out);
< +	    break;
< +	  }
---
> -		 ? "subsidiary program `%s' not found"
> +		 ? "subsidiary program '%s' not found"
>  		 : status == INT_MAX
> -		 ? "subsidiary program `%s' failed"
> -		 : "subsidiary program `%s' failed (exit status %d)"),
> +		 ? "subsidiary program '%s' failed"
> +		 : "subsidiary program '%s' failed (exit status %d)"),
>  	       pr_program, status);
8005,9150d334
<  }
<  
< -
<  char const change_letter[] = { 0, 'd', 'a', 'c' };
<  
<  /* Translate an internal line number (an index into diff's table of lines)
< @@ -1393,20 +608,20 @@ char const change_letter[] = { 0, 'd', '
<     Internal line numbers count from 0 starting after the prefix.
<     Actual line numbers count from 1 within the entire file.  */
<  
< -lin _GL_ATTRIBUTE_PURE
< +lin
<  translate_line_number (struct file_data const *file, lin i)
<  {
<    return i + file->prefix_lines + 1;
<  }
<  
<  /* Translate a line number range.  This is always done for printing,
< -   so for convenience translate to printint rather than lin, so that the
< -   caller can use printf with "%"pI"d" without casting.  */
< +   so for convenience translate to long int rather than lin, so that the
< +   caller can use printf with "%ld" without casting.  */
<  
<  void
<  translate_range (struct file_data const *file,
<  		 lin a, lin b,
< -		 printint *aptr, printint *bptr)
< +		 long int *aptr, long int *bptr)
<  {
<    *aptr = translate_line_number (file, a - 1) + 1;
<    *bptr = translate_line_number (file, b + 1) - 1;
< @@ -1421,21 +636,21 @@ translate_range (struct file_data const
<  void
<  print_number_range (char sepchar, struct file_data *file, lin a, lin b)
<  {
< -  printint trans_a, trans_b;
< +  long int trans_a, trans_b;
<    translate_range (file, a, b, &trans_a, &trans_b);
<  
<    /* Note: we can have B < A in the case of a range of no lines.
<       In this case, we should print the line number before the range,
<       which is B.  */
<    if (trans_b > trans_a)
< -    fprintf (outfile, "%"pI"d%c%"pI"d", trans_a, sepchar, trans_b);
< +    fprintf (outfile, "%ld%c%ld", trans_a, sepchar, trans_b);
<    else
< -    fprintf (outfile, "%"pI"d", trans_b);
< +    fprintf (outfile, "%ld", trans_b);
<  }
<  
<  /* Look at a hunk of edit script and report the range of lines in each file
<     that it applies to.  HUNK is the start of the hunk, which is a chain
< -   of 'struct change'.  The first and last line numbers of file 0 are stored in
< +   of `struct change'.  The first and last line numbers of file 0 are stored in
<     *FIRST0 and *LAST0, and likewise for file 1 in *FIRST1 and *LAST1.
<     Note that these are internal line numbers that count from 0.
<  
< @@ -1459,11 +674,8 @@ analyze_hunk (struct change *hunk,
<    size_t trivial_length = ignore_blank_lines - 1;
<      /* If 0, ignore zero-length lines;
<         if SIZE_MAX, do not ignore lines just because of their length.  */
< -
< -  bool skip_white_space =
< -    ignore_blank_lines && IGNORE_TRAILING_SPACE <= ignore_white_space;
<    bool skip_leading_white_space =
< -    skip_white_space && IGNORE_SPACE_CHANGE <= ignore_white_space;
< +    (ignore_blank_lines && IGNORE_SPACE_CHANGE <= ignore_white_space);
<  
<    char const * const *linbuf0 = files[0].linbuf;  /* Help the compiler.  */
<    char const * const *linbuf1 = files[1].linbuf;
< @@ -1484,18 +696,12 @@ analyze_hunk (struct change *hunk,
<        for (i = next->line0; i <= l0 && trivial; i++)
<  	{
<  	  char const *line = linbuf0[i];
< -	  char const *lastbyte = linbuf0[i + 1] - 1;
< -	  char const *newline = lastbyte + (*lastbyte != '\n');
< +	  char const *newline = linbuf0[i + 1] - 1;
<  	  size_t len = newline - line;
<  	  char const *p = line;
< -	  if (skip_white_space)
< -	    for (; *p != '\n'; p++)
< -	      if (! isspace ((unsigned char) *p))
< -		{
< -		  if (! skip_leading_white_space)
< -		    p = line;
< -		  break;
< -		}
< +	  if (skip_leading_white_space)
< +	    while (isspace ((unsigned char) *p) && *p != '\n')
< +	      p++;
<  	  if (newline - p != trivial_length
<  	      && (! ignore_regexp.fastmap
<  		  || re_search (&ignore_regexp, line, len, 0, len, 0) < 0))
< @@ -1505,18 +711,12 @@ analyze_hunk (struct change *hunk,
<        for (i = next->line1; i <= l1 && trivial; i++)
<  	{
<  	  char const *line = linbuf1[i];
< -	  char const *lastbyte = linbuf1[i + 1] - 1;
< -	  char const *newline = lastbyte + (*lastbyte != '\n');
< +	  char const *newline = linbuf1[i + 1] - 1;
<  	  size_t len = newline - line;
<  	  char const *p = line;
< -	  if (skip_white_space)
< -	    for (; *p != '\n'; p++)
< -	      if (! isspace ((unsigned char) *p))
< -		{
< -		  if (! skip_leading_white_space)
< -		    p = line;
< -		  break;
< -		}
< +	  if (skip_leading_white_space)
< +	    while (isspace ((unsigned char) *p) && *p != '\n')
< +	      p++;
<  	  if (newline - p != trivial_length
<  	      && (! ignore_regexp.fastmap
<  		  || re_search (&ignore_regexp, line, len, 0, len, 0) < 0))
< @@ -1556,6 +756,18 @@ zalloc (size_t size)
<    memset (p, 0, size);
<    return p;
<  }
< +
< +/* Yield the newly malloc'd pathname
< +   of the file in DIR whose filename is FILE.  */
< +
< +char *
< +dir_file_pathname (char const *dir, char const *file)
< +{
< +  char const *base = last_component (dir);
< +  size_t baselen = base_len (base);
< +  bool omit_slash = baselen == 0 || base[baselen - 1] == '/';
< +  return concat (dir, "/" + omit_slash, file);
< +}
<  
<  void
<  debug_script (struct change *sp)
< @@ -1564,11 +776,11 @@ debug_script (struct change *sp)
<  
<    for (; sp; sp = sp->link)
<      {
< -      printint line0 = sp->line0;
< -      printint line1 = sp->line1;
< -      printint deleted = sp->deleted;
< -      printint inserted = sp->inserted;
< -      fprintf (stderr, "%3"pI"d %3"pI"d delete %"pI"d insert %"pI"d\n",
< +      long int line0 = sp->line0;
< +      long int line1 = sp->line1;
< +      long int deleted = sp->deleted;
< +      long int inserted = sp->inserted;
< +      fprintf (stderr, "%3ld %3ld delete %ld insert %ld\n",
<  	       line0, line1, deleted, inserted);
<      }
<  
< Only in diffutils-3.0-patch/src: util.o
< diff -pru diffutils-3.0/tests/basic diffutils-3.0-patch/tests/basic
< --- diffutils-3.0/tests/basic	2020-03-01 22:03:00.509734000 -0800
< +++ diffutils-3.0-patch/tests/basic	2020-03-01 14:52:55.598202000 -0800
< @@ -1,7 +1,8 @@
<  #!/bin/sh
<  # small examples
<  
< -. "${srcdir=.}/init.sh"; path_prepend_ ../src
< +: ${srcdir=.}
< +. "$srcdir/init.sh"; path_prepend_ ../src
<  
<  fail=0
<  
< @@ -33,10 +34,10 @@ EOF
<  echo a > a
<  echo b > b
<  for opt in '' -u -c; do
< -  returns_ 1 diff $opt a b > out 2> err || fail=1
< +  diff $opt a b > out 2> err; test $? = 1 || fail=1
<    # Remove date and time.
<    sed -e 's/^\([-+*][-+*][-+*] [^	]*\)	.*/\1/' out > k; mv k out
< -  compare exp-$(echo $opt|tr ' ' _) out || fail=1
< +  compare out exp-$(echo $opt|tr ' ' _) || fail=1
<  done
<  
<  Exit $fail
< Only in diffutils-3.0/tests: bignum
< diff -pru diffutils-3.0/tests/binary diffutils-3.0-patch/tests/binary
< --- diffutils-3.0/tests/binary	2020-03-01 22:03:00.511735000 -0800
< +++ diffutils-3.0-patch/tests/binary	2020-03-01 14:52:55.599205000 -0800
< @@ -1,15 +1,18 @@
<  #!/bin/sh
<  # small examples
<  
< -. "${srcdir=.}/init.sh"; path_prepend_ ../src
< +: ${srcdir=.}
< +. "$srcdir/init.sh"; path_prepend_ ../src
<  
<  printf 'Binary files - and /dev/null differ\n' > out-exp || fail_ setup
<  
<  fail=0
<  
< -# diff must exit with status 1, stdout as above, and no stderr.
< -printf '\0'| returns_ 1 diff - /dev/null > out 2> err || fail=1
< -compare out-exp out || fail=1
< -compare /dev/null err || fail=1
< +printf '\0'|diff - /dev/null > out 2> err
< +
< +# diff must exit with status 2, stdout as above, and no stderr.
< +test $? = 2 || fail=1
< +compare out out-exp || fail=1
< +compare err /dev/null || fail=1
<  
<  Exit $fail
< Only in diffutils-3.0/tests: brief-vs-stat-zero-kernel-lies
< Only in diffutils-3.0/tests: cmp
< Only in diffutils-3.0/tests: colliding-file-names
< Only in diffutils-3.0/tests: colors
< Only in diffutils-3.0/tests: diff3
< Only in diffutils-3.0/tests: envvar-check
< Only in diffutils-3.0/tests: excess-slash
< Only in diffutils-3.0/tests: filename-quoting
< diff -pru diffutils-3.0/tests/function-line-vs-leading-space diffutils-3.0-patch/tests/function-line-vs-leading-space
< --- diffutils-3.0/tests/function-line-vs-leading-space	2020-03-01 22:03:00.523735000 -0800
< +++ diffutils-3.0-patch/tests/function-line-vs-leading-space	2020-03-01 14:52:55.601202000 -0800
< @@ -1,7 +1,8 @@
<  #!/bin/sh
<  # Demonstrate how -F RE behavior changed after diff-2.9.
<  
< -. "${srcdir=.}/init.sh"; path_prepend_ ../src
< +: ${srcdir=.}
< +. "$srcdir/init.sh"; path_prepend_ ../src
<  
<  cat <<EOF > in || fail_ "failed to create temporary file"
<  procedure AdaCode is
< @@ -52,14 +53,14 @@ EOF
<  
<  fail=0
<  
< -returns_ 1 diff -u -F '^[[:space:]]*\(function\|procedure\)' in in2 \
< -  > out 2> err || fail=1
< +diff -u -F '^[[:space:]]*\(function\|procedure\)' in in2 > out 2> err
< +test $? = 1 || fail=1
<  
< -sed -n '3,$p' out > k && mv k out || fail=1
< +tail -n+3 out > k && mv k out || fail=1
<  
< -compare exp out || fail=1
< +compare out exp || fail=1
<  
<  # expect empty stderr
< -compare /dev/null err || fail=1
< +compare err /dev/null || fail=1
<  
<  Exit $fail
< diff -pru diffutils-3.0/tests/help-version diffutils-3.0-patch/tests/help-version
< --- diffutils-3.0/tests/help-version	2020-03-01 22:03:00.525733000 -0800
< +++ diffutils-3.0-patch/tests/help-version	2020-03-01 14:57:56.843848000 -0800
< @@ -2,7 +2,7 @@
<  # Make sure all these programs work properly
<  # when invoked with --help or --version.
<  
< -# Copyright (C) 2000-2013, 2015-2017 Free Software Foundation, Inc.
< +# Copyright (C) 2000-2010 Free Software Foundation, Inc.
<  
<  # This program is free software: you can redistribute it and/or modify
<  # it under the terms of the GNU General Public License as published by
< @@ -23,7 +23,8 @@
<  test "x$SHELL" = x && SHELL=/bin/sh
<  export SHELL
<  
< -. "${srcdir=.}/init.sh"; path_prepend_ ../src
< +: ${srcdir=.}
< +. "$srcdir/init.sh"; path_prepend_ ../src
<  
<  expected_failure_status_chroot=125
<  expected_failure_status_env=125
< @@ -74,7 +75,7 @@ test "x$v" = "x$VERSION" \
<  for lang in C fr da; do
<    for i in $built_programs; do
<  
< -    # Skip 'test'; it doesn't accept --help or --version.
< +    # Skip `test'; it doesn't accept --help or --version.
<      test $i = test && continue;
<  
<      # false fails even when invoked with --help or --version.
< @@ -84,7 +85,7 @@ for lang in C fr da; do
<        continue
<      fi
<  
< -    # The just-built install executable is always named 'ginstall'.
< +    # The just-built install executable is always named `ginstall'.
<      test $i = install && i=ginstall
<  
<      # Make sure they exit successfully, under normal conditions.
< @@ -95,7 +96,7 @@ for lang in C fr da; do
<      grep "$PACKAGE_BUGREPORT" h-$i > /dev/null || fail=1
<      rm -f h-$i
<  
< -    # Make sure they fail upon 'disk full' error.
< +    # Make sure they fail upon `disk full' error.
<      if test -w /dev/full && test -c /dev/full; then
<        env $i --help    >/dev/full 2>/dev/null && fail=1
<        env $i --version >/dev/full 2>/dev/null && fail=1
< @@ -107,7 +108,7 @@ for lang in C fr da; do
<          : # ok
<        else
<          fail=1
< -        echo "*** $i: bad exit status '$status' (expected $expected)," 1>&2
< +        echo "*** $i: bad exit status \`$status' (expected $expected)," 1>&2
<          echo "  with --help or --version output redirected to /dev/full" 1>&2
<        fi
<      fi
< @@ -139,7 +140,7 @@ chown_setup () { args=--version; }
<  mkfifo_setup () { args=--version; }
<  mknod_setup () { args=--version; }
<  # Punt on uptime, since it fails (e.g., failing to get boot time)
< -# on some systems, and we shouldn't let that stop 'make check'.
< +# on some systems, and we shouldn't let that stop `make check'.
<  uptime_setup () { args=--version; }
<  
<  # Create a file in the current directory, not in $TMPDIR.
< @@ -187,7 +188,7 @@ basename_setup () { args=$tmp_in; }
<  dirname_setup () { args=$tmp_in; }
<  expr_setup () { args=foo; }
<  
< -# Punt, in case GNU 'id' hasn't been installed yet.
< +# Punt, in case GNU `id' hasn't been installed yet.
<  groups_setup () { args=--version; }
<  
<  pathchk_setup () { args=$tmp_in; }
< Only in diffutils-3.0/tests: ignore-matching-lines
< diff -pru diffutils-3.0/tests/init.sh diffutils-3.0-patch/tests/init.sh
< --- diffutils-3.0/tests/init.sh	2020-03-01 22:03:00.528734000 -0800
< +++ diffutils-3.0-patch/tests/init.sh	2020-03-01 14:52:55.605202000 -0800
< @@ -1,6 +1,6 @@
<  # source this file; set up for tests
<  
< -# Copyright (C) 2009-2017 Free Software Foundation, Inc.
< +# Copyright (C) 2009, 2010 Free Software Foundation, Inc.
<  
<  # This program is free software: you can redistribute it and/or modify
<  # it under the terms of the GNU General Public License as published by
< @@ -21,16 +21,11 @@
<  # The typical skeleton of a test looks like this:
<  #
<  #   #!/bin/sh
< -#   . "${srcdir=.}/init.sh"; path_prepend_ .
< +#   : ${srcdir=.}
< +#   . "$srcdir/init.sh"; path_prepend_ .
<  #   Execute some commands.
<  #   Note that these commands are executed in a subdirectory, therefore you
<  #   need to prepend "../" to relative filenames in the build directory.
< -#   Note that the "path_prepend_ ." is useful only if the body of your
< -#   test invokes programs residing in the initial directory.
< -#   For example, if the programs you want to test are in src/, and this test
< -#   script is named tests/test-1, then you would use "path_prepend_ ../src",
< -#   or perhaps export PATH='$(abs_top_builddir)/src$(PATH_SEPARATOR)'"$$PATH"
< -#   to all tests via automake's TESTS_ENVIRONMENT.
<  #   Set the exit code 0 for success, 77 for skipped, or 1 or other for failure.
<  #   Use the skip_ and fail_ functions to print a diagnostic and then exit
<  #   with the corresponding exit code.
< @@ -45,9 +40,6 @@
<  # Running a single test, with verbose output:
<  #   $ make check TESTS=test-foo.sh VERBOSE=yes
<  #
< -# Running a single test, keeping the temporary directory:
< -#   $ make check TESTS=test-foo.sh KEEP=yes
< -#
<  # Running a single test, with single-stepping:
<  #   1. Go into a sub-shell:
<  #   $ bash
< @@ -60,307 +52,90 @@
<  #   4. Finally
<  #   $ exit
<  
< -ME_=`expr "./$0" : '.*/\(.*\)$'`
< -
< -# We use a trap below for cleanup.  This requires us to go through
< -# hoops to get the right exit status transported through the handler.
< -# So use 'Exit STATUS' instead of 'exit STATUS' inside of the tests.
< -# Turn off errexit here so that we don't trip the bug with OSF1/Tru64
< -# sh inside this function.
< -Exit () { set +e; (exit $1); exit $1; }
< -
< -# Print warnings (e.g., about skipped and failed tests) to this file number.
< -# Override by defining to say, 9, in init.cfg, and putting say,
< -#   export ...ENVVAR_SETTINGS...; $(SHELL) 9>&2
< -# in the definition of TESTS_ENVIRONMENT in your tests/Makefile.am file.
< -# This is useful when using automake's parallel tests mode, to print
< -# the reason for skip/failure to console, rather than to the .log files.
< -: ${stderr_fileno_=2}
< -
< -# Note that correct expansion of "$*" depends on IFS starting with ' '.
< -# Always write the full diagnostic to stderr.
< -# When stderr_fileno_ is not 2, also emit the first line of the
< -# diagnostic to that file descriptor.
< -warn_ ()
< -{
< -  # If IFS does not start with ' ', set it and emit the warning in a subshell.
< -  case $IFS in
< -    ' '*) printf '%s\n' "$*" >&2
< -          test $stderr_fileno_ = 2 \
< -            || { printf '%s\n' "$*" | sed 1q >&$stderr_fileno_ ; } ;;
< -    *) (IFS=' '; warn_ "$@");;
< -  esac
< -}
< -fail_ () { warn_ "$ME_: failed test: $@"; Exit 1; }
< -skip_ () { warn_ "$ME_: skipped test: $@"; Exit 77; }
< -fatal_ () { warn_ "$ME_: hard error: $@"; Exit 99; }
< -framework_failure_ () { warn_ "$ME_: set-up failure: $@"; Exit 99; }
< -
< -# This is used to simplify checking of the return value
< -# which is useful when ensuring a command fails as desired.
< -# I.e., just doing `command ... &&fail=1` will not catch
< -# a segfault in command for example.  With this helper you
< -# instead check an explicit exit code like
< -#   returns_ 1 command ... || fail
< -returns_ () {
< -  # Disable tracing so it doesn't interfere with stderr of the wrapped command
< -  { set +x; } 2>/dev/null
< -
< -  local exp_exit="$1"
< -  shift
< -  "$@"
< -  test $? -eq $exp_exit && ret_=0 || ret_=1
< -
< -  if test "$VERBOSE" = yes && test "$gl_set_x_corrupts_stderr_" = false; then
< -    set -x
< -  fi
< -  { return $ret_; } 2>/dev/null
< -}
< -
< -# Sanitize this shell to POSIX mode, if possible.
< -DUALCASE=1; export DUALCASE
< -if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
< -  emulate sh
< -  NULLCMD=:
< -  alias -g '${1+"$@"}'='"$@"'
< -  setopt NO_GLOB_SUBST
< -else
< -  case `(set -o) 2>/dev/null` in
< -    *posix*) set -o posix ;;
< -  esac
< -fi
< -
<  # We require $(...) support unconditionally.
< -# We require non-surprising "local" semantics (this eliminates dash).
< -# This takes the admittedly draconian step of eliminating dash, because the
< -# assignment tab=$(printf '\t') works fine, yet preceding it with "local "
< -# transforms it into an assignment that sets the variable to the empty string.
< -# That is too counter-intuitive, and can lead to subtle run-time malfunction.
< -# The example below is less subtle in that with dash, it evokes the run-time
< -# exception "dash: 1: local: 1: bad variable name".
<  # We require a few additional shell features only when $EXEEXT is nonempty,
<  # in order to support automatic $EXEEXT emulation:
<  # - hyphen-containing alias names
<  # - we prefer to use ${var#...} substitution, rather than having
<  #   to work around lack of support for that feature.
< -# The following code attempts to find a shell with support for these features.
< -# If the current shell passes the test, we're done.  Otherwise, test other
< -# shells until we find one that passes.  If one is found, re-exec it.
< -# If no acceptable shell is found, skip the current test.
< -#
< -# The "...set -x; P=1 true 2>err..." test is to disqualify any shell that
< -# emits "P=1" into err, as /bin/sh from SunOS 5.11 and OpenBSD 4.7 do.
< -#
< -# Use "9" to indicate success (rather than 0), in case some shell acts
< -# like Solaris 10's /bin/sh but exits successfully instead of with status 2.
< +# The following code attempts to find a shell with support for these features
< +# and re-exec's it.  If not, it skips the current test.
<  
< -# Eval this code in a subshell to determine a shell's suitability.
< -# 10 - passes all tests; ok to use
< -#  9 - ok, but enabling "set -x" corrupts app stderr; prefer higher score
< -#  ? - not ok
<  gl_shell_test_script_='
<  test $(echo y) = y || exit 1
< -f_local_() { local v=1; }; f_local_ || exit 1
< -f_dash_local_fail_() { local t=$(printf " 1"); }; f_dash_local_fail_
< -score_=10
< -if test "$VERBOSE" = yes; then
< -  test -n "$( (exec 3>&1; set -x; P=1 true 2>&3) 2> /dev/null)" && score_=9
< -fi
< -test -z "$EXEEXT" && exit $score_
< +test -z "$EXEEXT" && exit 0
<  shopt -s expand_aliases
<  alias a-b="echo zoo"
<  v=abx
<       test ${v%x} = ab \
<    && test ${v#a} = bx \
< -  && test $(a-b) = zoo \
< -  && exit $score_
< +  && test $(a-b) = zoo
<  '
<  
<  if test "x$1" = "x--no-reexec"; then
<    shift
<  else
< -  # Assume a working shell.  Export to subshells (setup_ needs this).
< -  gl_set_x_corrupts_stderr_=false
< -  export gl_set_x_corrupts_stderr_
< -
< -  # Record the first marginally acceptable shell.
< -  marginal_=
< -
< -  # Search for a shell that meets our requirements.
< -  for re_shell_ in __current__ "${CONFIG_SHELL:-no_shell}" \
< -      /bin/sh bash dash zsh pdksh fail
< +  for re_shell_ in "${CONFIG_SHELL:-no_shell}" /bin/sh bash dash zsh pdksh fail
<    do
<      test "$re_shell_" = no_shell && continue
< -
< -    # If we've made it all the way to the sentinel, "fail" without
< -    # finding even a marginal shell, skip this test.
< -    if test "$re_shell_" = fail; then
< -      test -z "$marginal_" && skip_ failed to find an adequate shell
< -      re_shell_=$marginal_
< -      break
< -    fi
< -
< -    # When testing the current shell, simply "eval" the test code.
< -    # Otherwise, run it via $re_shell_ -c ...
< -    if test "$re_shell_" = __current__; then
< -      # 'eval'ing this code makes Solaris 10's /bin/sh exit with
< -      # $? set to 2.  It does not evaluate any of the code after the
< -      # "unexpected" first '('.  Thus, we must run it in a subshell.
< -      ( eval "$gl_shell_test_script_" ) > /dev/null 2>&1
< -    else
< -      "$re_shell_" -c "$gl_shell_test_script_" 2>/dev/null
< -    fi
< -
< -    st_=$?
< -
< -    # $re_shell_ works just fine.  Use it.
< -    if test $st_ = 10; then
< -      gl_set_x_corrupts_stderr_=false
< -      break
< -    fi
< -
< -    # If this is our first marginally acceptable shell, remember it.
< -    if test "$st_:$marginal_" = 9: ; then
< -      marginal_="$re_shell_"
< -      gl_set_x_corrupts_stderr_=true
< +    test "$re_shell_" = fail && skip_ failed to find an adequate shell
< +    if "$re_shell_" -c "$gl_shell_test_script_" 2>/dev/null; then
< +      exec "$re_shell_" "$0" --no-reexec "$@"
< +      echo "$ME_: exec failed" 1>&2
< +      exit 127
<      fi
<    done
< -
< -  if test "$re_shell_" != __current__; then
< -    # Found a usable shell.  Preserve -v and -x.
< -    case $- in
< -      *v*x* | *x*v*) opts_=-vx ;;
< -      *v*) opts_=-v ;;
< -      *x*) opts_=-x ;;
< -      *) opts_= ;;
< -    esac
< -    re_shell=$re_shell_
< -    export re_shell
< -    exec "$re_shell_" $opts_ "$0" --no-reexec "$@"
< -    echo "$ME_: exec failed" 1>&2
< -    exit 127
< -  fi
<  fi
<  
< -# If this is bash, turn off all aliases.
< -test -n "$BASH_VERSION" && unalias -a
< -
< -# Note that when supporting $EXEEXT (transparently mapping from PROG_NAME to
< -# PROG_NAME.exe), we want to support hyphen-containing names like test-acos.
< -# That is part of the shell-selection test above.  Why use aliases rather
< -# than functions?  Because support for hyphen-containing aliases is more
< -# widespread than that for hyphen-containing function names.
<  test -n "$EXEEXT" && shopt -s expand_aliases
<  
< -# Enable glibc's malloc-perturbing option.
< -# This is useful for exposing code that depends on the fact that
< -# malloc-related functions often return memory that is mostly zeroed.
< -# If you have the time and cycles, use valgrind to do an even better job.
< -: ${MALLOC_PERTURB_=87}
< -export MALLOC_PERTURB_
< +# We use a trap below for cleanup.  This requires us to go through
< +# hoops to get the right exit status transported through the handler.
< +# So use `Exit STATUS' instead of `exit STATUS' inside of the tests.
< +# Turn off errexit here so that we don't trip the bug with OSF1/Tru64
< +# sh inside this function.
< +Exit () { set +e; (exit $1); exit $1; }
< +
< +# Print warnings (e.g., about skipped and failed tests) to this file number.
< +# Override by defining to say, 9, in init.cfg, and putting say,
< +# "export ...ENVVAR_SETTINGS...; exec 9>&2; $(SHELL)" in the definition
< +# of TESTS_ENVIRONMENT in your tests/Makefile.am file.
< +# This is useful when using automake's parallel tests mode, to print
< +# the reason for skip/failure to console, rather than to the .log files.
< +: ${stderr_fileno_=2}
< +
< +warn_() { echo "$@" 1>&$stderr_fileno_; }
< +fail_() { warn_ "$ME_: failed test: $@"; Exit 1; }
< +skip_() { warn_ "$ME_: skipped test: $@"; Exit 77; }
< +framework_failure_() { warn_ "$ME_: set-up failure: $@"; Exit 1; }
<  
<  # This is a stub function that is run upon trap (upon regular exit and
<  # interrupt).  Override it with a per-test function, e.g., to unmount
<  # a partition, or to undo any other global state changes.
< -cleanup_ () { :; }
< -
< -# Emit a header similar to that from diff -u;  Print the simulated "diff"
< -# command so that the order of arguments is clear.  Don't bother with @@ lines.
< -emit_diff_u_header_ ()
< -{
< -  printf '%s\n' "diff -u $*" \
< -    "--- $1	1970-01-01" \
< -    "+++ $2	1970-01-01"
< -}
< +cleanup_() { :; }
<  
< -# Arrange not to let diff or cmp operate on /dev/null,
< -# since on some systems (at least OSF/1 5.1), that doesn't work.
< -# When there are not two arguments, or no argument is /dev/null, return 2.
< -# When one argument is /dev/null and the other is not empty,
< -# cat the nonempty file to stderr and return 1.
< -# Otherwise, return 0.
< -compare_dev_null_ ()
< -{
< -  test $# = 2 || return 2
< -
< -  if test "x$1" = x/dev/null; then
< -    test -s "$2" || return 0
< -    emit_diff_u_header_ "$@"; sed 's/^/+/' "$2"
< -    return 1
< -  fi
< -
< -  if test "x$2" = x/dev/null; then
< -    test -s "$1" || return 0
< -    emit_diff_u_header_ "$@"; sed 's/^/-/' "$1"
< -    return 1
< -  fi
< -
< -  return 2
< -}
< -
< -for diff_opt_ in -u -U3 -c '' no; do
< -  test "$diff_opt_" != no &&
< -    diff_out_=`exec 2>/dev/null; diff $diff_opt_ "$0" "$0" < /dev/null` &&
< -    break
< -done
< -if test "$diff_opt_" != no; then
< -  if test -z "$diff_out_"; then
< -    compare_ () { diff $diff_opt_ "$@"; }
< -  else
< -    compare_ ()
< -    {
< -      # If no differences were found, AIX and HP-UX 'diff' produce output
< -      # like "No differences encountered".  Hide this output.
< -      diff $diff_opt_ "$@" > diff.out
< -      diff_status_=$?
< -      test $diff_status_ -eq 0 || cat diff.out || diff_status_=2
< -      rm -f diff.out || diff_status_=2
< -      return $diff_status_
< -    }
< -  fi
< -elif cmp -s /dev/null /dev/null 2>/dev/null; then
< -  compare_ () { cmp -s "$@"; }
< +if ( diff --version < /dev/null 2>&1 | grep GNU ) 2>&1 > /dev/null; then
< +  compare() { diff -u "$@"; }
< +elif ( cmp --version < /dev/null 2>&1 | grep GNU ) 2>&1 > /dev/null; then
< +  compare() { cmp -s "$@"; }
<  else
< -  compare_ () { cmp "$@"; }
< +  compare() { cmp "$@"; }
<  fi
<  
< -# Usage: compare EXPECTED ACTUAL
< -#
< -# Given compare_dev_null_'s preprocessing, defer to compare_ if 2 or more.
< -# Otherwise, propagate $? to caller: any diffs have already been printed.
< -compare ()
< -{
< -  # This looks like it can be factored to use a simple "case $?"
< -  # after unchecked compare_dev_null_ invocation, but that would
< -  # fail in a "set -e" environment.
< -  if compare_dev_null_ "$@"; then
< -    return 0
< -  else
< -    case $? in
< -      1) return 1;;
< -      *) compare_ "$@";;
< -    esac
< -  fi
< -}
< -
<  # An arbitrary prefix to help distinguish test directories.
< -testdir_prefix_ () { printf gt; }
< +testdir_prefix_() { printf gt; }
<  
<  # Run the user-overridable cleanup_ function, remove the temporary
<  # directory and exit with the incoming value of $?.
< -remove_tmp_ ()
< +remove_tmp_()
<  {
<    __st=$?
<    cleanup_
< -  if test "$KEEP" = yes; then
< -    echo "Not removing temporary directory $test_dir_"
< -  else
< -    # cd out of the directory we're about to remove
< -    cd "$initial_cwd_" || cd / || cd /tmp
< -    chmod -R u+rwx "$test_dir_"
< -    # If removal fails and exit status was to be 0, then change it to 1.
< -    rm -rf "$test_dir_" || { test $__st = 0 && __st=1; }
< -  fi
< +  # cd out of the directory we're about to remove
< +  cd "$initial_cwd_" || cd / || cd /tmp
< +  chmod -R u+rwx "$test_dir_"
< +  # If removal fails and exit status was to be 0, then change it to 1.
< +  rm -rf "$test_dir_" || { test $__st = 0 && __st=1; }
<    exit $__st
<  }
<  
< @@ -368,21 +143,13 @@ remove_tmp_ ()
<  # contains only the specified bytes (see the case stmt below), then print
<  # a space-separated list of those names and return 0.  Otherwise, don't
<  # print anything and return 1.  Naming constraints apply also to DIR.
< -find_exe_basenames_ ()
< +find_exe_basenames_()
<  {
<    feb_dir_=$1
<    feb_fail_=0
<    feb_result_=
<    feb_sp_=
<    for feb_file_ in $feb_dir_/*.exe; do
< -    # If there was no *.exe file, or there existed a file named "*.exe" that
< -    # was deleted between the above glob expansion and the existence test
< -    # below, just skip it.
< -    test "x$feb_file_" = "x$feb_dir_/*.exe" && test ! -f "$feb_file_" \
< -      && continue
< -    # Exempt [.exe, since we can't create a function by that name, yet
< -    # we can't invoke [ by PATH search anyways due to shell builtins.
< -    test "x$feb_file_" = "x$feb_dir_/[.exe" && continue
<      case $feb_file_ in
<        *[!-a-zA-Z/0-9_.+]*) feb_fail_=1; break;;
<        *) # Remove leading file name components as well as the .exe suffix.
< @@ -400,8 +167,8 @@ find_exe_basenames_ ()
<  # For each file name of the form PROG.exe, create an alias named
<  # PROG that simply invokes PROG.exe, then return 0.  If any selected
<  # file name or the directory name, $1, contains an unexpected character,
< -# define no alias and return 1.
< -create_exe_shims_ ()
< +# define no function and return 1.
< +create_exe_shims_()
<  {
<    case $EXEEXT in
<      '') return 0 ;;
< @@ -410,7 +177,7 @@ create_exe_shims_ ()
<    esac
<  
<    base_names_=`find_exe_basenames_ $1` \
< -    || { echo "$0 (exe_shim): skipping directory: $1" 1>&2; return 0; }
< +    || { echo "$0 (exe_shim): skipping directory: $1" 1>&2; return 1; }
<  
<    if test -n "$base_names_"; then
<      for base_ in $base_names_; do
< @@ -423,14 +190,15 @@ create_exe_shims_ ()
<  
<  # Use this function to prepend to PATH an absolute name for each
<  # specified, possibly-$initial_cwd_-relative, directory.
< -path_prepend_ ()
< +path_prepend_()
<  {
<    while test $# != 0; do
<      path_dir_=$1
<      case $path_dir_ in
<        '') fail_ "invalid path dir: '$1'";;
<        /*) abs_path_dir_=$path_dir_;;
< -      *) abs_path_dir_=$initial_cwd_/$path_dir_;;
< +      *) abs_path_dir_=`cd "$initial_cwd_/$path_dir_" && echo "$PWD"` \
< +           || fail_ "invalid path dir: $path_dir_";;
<      esac
<      case $abs_path_dir_ in
<        *:*) fail_ "invalid path dir: '$abs_path_dir_'";;
< @@ -445,37 +213,21 @@ path_prepend_ ()
<    export PATH
<  }
<  
< -setup_ ()
< +setup_()
<  {
< -  if test "$VERBOSE" = yes; then
< -    # Test whether set -x may cause the selected shell to corrupt an
< -    # application's stderr.  Many do, including zsh-4.3.10 and the /bin/sh
< -    # from SunOS 5.11, OpenBSD 4.7 and Irix 5.x and 6.5.
< -    # If enabling verbose output this way would cause trouble, simply
< -    # issue a warning and refrain.
< -    if $gl_set_x_corrupts_stderr_; then
< -      warn_ "using SHELL=$SHELL with 'set -x' corrupts stderr"
< -    else
< -      set -x
< -    fi
< -  fi
< +  test "$VERBOSE" = yes && set -x
<  
<    initial_cwd_=$PWD
< +  ME_=`expr "./$0" : '.*/\(.*\)$'`
<  
<    pfx_=`testdir_prefix_`
<    test_dir_=`mktempd_ "$initial_cwd_" "$pfx_-$ME_.XXXX"` \
<      || fail_ "failed to create temporary directory in $initial_cwd_"
< -  cd "$test_dir_" || fail_ "failed to cd to temporary directory"
< +  cd "$test_dir_"
<  
< -  # As autoconf-generated configure scripts do, ensure that IFS
< -  # is defined initially, so that saving and restoring $IFS works.
< -  gl_init_sh_nl_='
< -'
< -  IFS=" ""	$gl_init_sh_nl_"
< -
< -  # This trap statement, along with a trap on 0 below, ensure that the
< -  # temporary directory, $test_dir_, is removed upon exit as well as
< -  # upon receipt of any of the listed signals.
< +  # These trap statements ensure that the temporary directory, $test_dir_,
< +  # is removed upon exit as well as upon receipt of any of the listed signals.
< +  trap remove_tmp_ 0
<    for sig_ in 1 2 3 13 15; do
<      eval "trap 'Exit $(expr $sig_ + 128)' $sig_"
<    done
< @@ -497,7 +249,7 @@ setup_ ()
<  #  - make only $MAX_TRIES_ attempts
<  
<  # Helper function.  Print $N pseudo-random bytes from a-zA-Z0-9.
< -rand_bytes_ ()
< +rand_bytes_()
<  {
<    n_=$1
<  
< @@ -529,11 +281,11 @@ rand_bytes_ ()
<      | LC_ALL=C tr -c $chars_ 01234567$chars_$chars_$chars_
<  }
<  
< -mktempd_ ()
< +mktempd_()
<  {
<    case $# in
<    2);;
< -  *) fail_ "Usage: mktempd_ DIR TEMPLATE";;
< +  *) fail_ "Usage: $ME DIR TEMPLATE";;
<    esac
<  
<    destdir_=$1
< @@ -544,29 +296,32 @@ mktempd_ ()
<    # Disallow any trailing slash on specified destdir:
<    # it would subvert the post-mktemp "case"-based destdir test.
<    case $destdir_ in
< -  / | //) destdir_slash_=$destdir;;
< +  /) ;;
<    */) fail_ "invalid destination dir: remove trailing slash(es)";;
< -  *) destdir_slash_=$destdir_/;;
<    esac
<  
<    case $template_ in
<    *XXXX) ;;
< -  *) fail_ \
< -       "invalid template: $template_ (must have a suffix of at least 4 X's)";;
< +  *) fail_ "invalid template: $template_ (must have a suffix of at least 4 X's)";;
<    esac
<  
< +  fail=0
< +
<    # First, try to use mktemp.
< -  d=`unset TMPDIR; { mktemp -d -t -p "$destdir_" "$template_"; } 2>/dev/null` &&
< +  d=`unset TMPDIR; mktemp -d -t -p "$destdir_" "$template_" 2>/dev/null` \
< +    || fail=1
<  
<    # The resulting name must be in the specified directory.
< -  case $d in "$destdir_slash_"*) :;; *) false;; esac &&
< +  case $d in "$destdir_"*);; *) fail=1;; esac
<  
<    # It must have created the directory.
< -  test -d "$d" &&
< +  test -d "$d" || fail=1
<  
<    # It must have 0700 permissions.  Handle sticky "S" bits.
< -  perms=`ls -dgo "$d" 2>/dev/null` &&
< -  case $perms in drwx--[-S]---*) :;; *) false;; esac && {
< +  perms=`ls -dgo "$d" 2>/dev/null|tr S -` || fail=1
< +  case $perms in drwx------*) ;; *) fail=1;; esac
< +
< +  test $fail = 0 && {
<      echo "$d"
<      return
<    }
< @@ -585,7 +340,7 @@ mktempd_ ()
<    i_=1
<    while :; do
<      X_=`rand_bytes_ $nx_`
< -    candidate_dir_="$destdir_slash_$base_template_$X_"
< +    candidate_dir_="$destdir_/$base_template_$X_"
<      err_=`mkdir -m 0700 "$candidate_dir_" 2>&1` \
<        && { echo "$candidate_dir_"; return; }
<      test $MAX_TRIES_ -le $i_ && break;
< @@ -600,6 +355,3 @@ test -f "$srcdir/init.cfg" \
<    && . "$srcdir/init.cfg"
<  
<  setup_ "$@"
< -# This trap is here, rather than in the setup_ function, because some
< -# shells run the exit trap at shell function exit, rather than script exit.
< -trap remove_tmp_ 0
< Only in diffutils-3.0/tests: invalid-re
< diff -pru diffutils-3.0/tests/label-vs-func diffutils-3.0-patch/tests/label-vs-func
< --- diffutils-3.0/tests/label-vs-func	2020-03-01 22:03:00.530734000 -0800
< +++ diffutils-3.0-patch/tests/label-vs-func	2020-03-01 14:52:55.606203000 -0800
< @@ -1,7 +1,8 @@
<  #!/bin/sh
<  # Show how diff's -p option can mistakenly match a label: in column 1.
<  
< -. "${srcdir=.}/init.sh"; path_prepend_ ../src
< +: ${srcdir=.}
< +. "$srcdir/init.sh"; path_prepend_ ../src
<  
<  fail=0
<  cat <<EOF > exp || fail=1
< @@ -19,13 +20,13 @@ label:
<  EOF
<  
<  sed s/1/2/ a > b || fail=1
< -returns_ 1 diff -p -u0 a b > out 2> err || fail=1
< +diff -p -u0 a b > out 2> err; test $? = 1 || fail=1
<  
<  tail -3 out > k && mv k out || fail=1
<  
< -compare exp out || fail=1
< +compare out exp || fail=1
<  
<  # expect empty stderr
< -compare /dev/null err || fail=1
< +compare err /dev/null || fail=1
<  
<  Exit $fail
< Only in diffutils-3.0-patch/tests: Makefile
< diff -pru diffutils-3.0/tests/Makefile.am diffutils-3.0-patch/tests/Makefile.am
< --- diffutils-3.0/tests/Makefile.am	2020-03-01 22:03:00.508733000 -0800
< +++ diffutils-3.0-patch/tests/Makefile.am	2020-03-01 14:52:55.597200000 -0800
< @@ -1,92 +1,61 @@
< -# tests for GNU diff
< -
<  TESTS = \
<    basic \
< -  bignum \
<    binary \
< -  brief-vs-stat-zero-kernel-lies \
< -  cmp \
< -  colliding-file-names \
< -  diff3 \
< -  excess-slash \
<    help-version	\
< -  invalid-re	\
<    function-line-vs-leading-space \
< -  ignore-matching-lines \
<    label-vs-func	\
< -  new-file \
< -  no-dereference \
<    no-newline-at-eof \
< -  stdin \
< -  strcoll-0-names \
< -  filename-quoting \
< -  colors
< +  stdin
<  
<  EXTRA_DIST = \
< -  $(TESTS) init.sh t-local.sh envvar-check
< +  $(TESTS) init.sh t-local.sh
<  
<  # Note that the first lines are statements.  They ensure that environment
<  # variables that can perturb tests are unset or set to expected values.
<  # The rest are envvar settings that propagate build-related Makefile
<  # variables to test scripts.
< -TESTS_ENVIRONMENT =					\
< -  tmp__=$${TMPDIR-/tmp};				\
< -  test -d "$$tmp__" && test -w "$$tmp__" || tmp__=.;	\
< -  . $(srcdir)/envvar-check;				\
< -  TMPDIR=$$tmp__; export TMPDIR;			\
< -							\
< -  if test -n "$$BASH_VERSION" || (eval "export v=x") 2>/dev/null; then \
< -    export_with_values () { export "$$@"; };		\
< -  else							\
< -    export_with_values ()				\
< -    {							\
< -      sed_extract_var='s/=.*//';			\
< -      sed_quote_value="s/'/'\\\\''/g;s/=\\(.*\\)/='\\1'/";\
< -      for arg in "$$@"; do				\
< -        var=`echo "$$arg" | sed "$$sed_extract_var"`;	\
< -        arg=`echo "$$arg" | sed "$$sed_quote_value"`;	\
< -        eval "$$arg";					\
< -        export "$$var";					\
< -      done;						\
< -    };							\
< -  fi;							\
< -							\
< -  export_with_values					\
< -  VERSION='$(VERSION)'					\
< -  LOCALE_FR='$(LOCALE_FR)'				\
< -  LOCALE_FR_UTF8='$(LOCALE_FR_UTF8)'			\
< -  AWK=$(AWK)						\
< -  GREP_OPTIONS=''					\
< -  LC_ALL=C						\
< -  abs_top_builddir='$(abs_top_builddir)'		\
< -  abs_top_srcdir='$(abs_top_srcdir)'			\
< -  abs_srcdir='$(abs_srcdir)'				\
< -  built_programs="`$(built_programs)`"			\
< -  srcdir='$(srcdir)'					\
< -  top_srcdir='$(top_srcdir)'				\
< -  CC='$(CC)'						\
< -  DIFFUTILS_TEST_NAME=`echo $$tst|sed 's,^\./,,;s,/,-,g'` \
< -  MAKE=$(MAKE)						\
< -  MALLOC_PERTURB_=$(MALLOC_PERTURB_)			\
< -  PACKAGE_BUGREPORT='$(PACKAGE_BUGREPORT)'		\
< -  PACKAGE_VERSION=$(PACKAGE_VERSION)			\
< -  PERL='$(PERL)'					\
< -  SHELL='$(SHELL)'					\
< -  PREFERABLY_POSIX_SHELL='$(PREFERABLY_POSIX_SHELL)'	\
< -  REPLACE_GETCWD=$(REPLACE_GETCWD)			\
< -  PATH='$(abs_top_builddir)/src$(PATH_SEPARATOR)'"$$PATH"	\
< -  stderr_fileno_=9					\
< -  ; 9>&2
< -
< -LOG_COMPILER= $(SHELL)
< +TESTS_ENVIRONMENT =				\
< +  tmp__=$$TMPDIR; test -d "$$tmp__" || tmp__=.;	\
< +  TMPDIR=$$tmp__; export TMPDIR;		\
< +  exec 9>&2;					\
< +  shell_or_perl_() {				\
< +    if grep '^\#!/usr/bin/perl' "$$1" > /dev/null; then			\
< +      if $(PERL) -e 'use warnings' > /dev/null 2>&1; then		\
< +	grep '^\#!/usr/bin/perl -T' "$$1" > /dev/null && T_=T || T_=;	\
< +        $(PERL) -w$$T_ -I$(srcdir) -MCoreutils				\
< +	      -M"CuTmpdir qw($$f)" -- "$$1";	\
< +      else					\
< +	echo 1>&2 "$$tst: configure did not find a usable version of Perl," \
< +	  "so skipping this test";		\
< +	(exit 77);				\
< +      fi;					\
< +    else					\
< +      $(SHELL) "$$1";				\
< +    fi;						\
< +  };						\
< +  export					\
< +  VERSION='$(VERSION)'				\
< +  abs_top_builddir='$(abs_top_builddir)'	\
< +  abs_top_srcdir='$(abs_top_srcdir)'		\
< +  abs_srcdir='$(abs_srcdir)'			\
< +  built_programs="`$(built_programs)`"		\
< +  srcdir='$(srcdir)'				\
< +  top_srcdir='$(top_srcdir)'			\
< +  CC='$(CC)'					\
< +  MAKE=$(MAKE)					\
< +  PACKAGE_BUGREPORT='$(PACKAGE_BUGREPORT)'	\
< +  PACKAGE_VERSION=$(PACKAGE_VERSION)		\
< +  CONFIG_HEADER='$(abs_top_builddir)/lib/config.h' \
< +  ENABLE_DEVICE_MAPPER=$(ENABLE_DEVICE_MAPPER)	\
< +  PERL='$(PERL)'				\
< +  PREFERABLY_POSIX_SHELL='$(PREFERABLY_POSIX_SHELL)' \
< +  REPLACE_GETCWD=$(REPLACE_GETCWD)		\
< +  PATH='$(abs_top_builddir)/src$(PATH_SEPARATOR)'"$$PATH" \
< +  ; shell_or_perl_
<  
<  built_programs =							\
<    echo 'spy:;@echo $$(PROGRAMS)'					\
< -    | { (cd ../src && MAKEFLAGS= $(MAKE) -s -f Makefile -f - spy)	\
< -          | tr ' ' '\n'							\
< -          | sed '/^$$/d; s,$(EXEEXT)$$,,'				\
< -          | sort -u							\
< -          | tr '\n' ' '; echo; }					\
< -    | sed 's/ $$//'
< +    | MAKEFLAGS= $(MAKE) -s -C $(builddir)/../src -f Makefile -f - spy	\
< +    | fmt -1 | sed 's,$(EXEEXT)$$,,' | sort -u
<  
<  VERBOSE = yes
< Only in diffutils-3.0-patch/tests: Makefile.in
< Only in diffutils-3.0/tests: new-file
< Only in diffutils-3.0/tests: no-dereference
< diff -pru diffutils-3.0/tests/no-newline-at-eof diffutils-3.0-patch/tests/no-newline-at-eof
< --- diffutils-3.0/tests/no-newline-at-eof	2020-03-01 22:03:00.551739000 -0800
< +++ diffutils-3.0-patch/tests/no-newline-at-eof	2020-03-01 14:52:55.607207000 -0800
< @@ -3,7 +3,8 @@
<  # Before the April 2010 fix, the "\ No newline at end of file"
<  # line would not be printed.
<  
< -. "${srcdir=.}/init.sh"; path_prepend_ ../src
< +: ${srcdir=.}
< +. "$srcdir/init.sh"; path_prepend_ ../src
<  
<  printf '\n1'      > a || framework_failure_
<  printf '\n0\n\n1' > b || framework_failure_
< @@ -31,26 +32,23 @@ fail=0
<  # So we don't have to record trailing blanks in expected output above.
<  opt=--suppress-blank-empty
<  
< -returns_ 1 diff $opt -U1 a b > out 2> err || fail=1
< +diff $opt -U1 a b > out 2> err
< +test $? = 1 || fail=1
<  
<  sed -n '/^@@/,$p' out > k && mv k out || fail=1
< -compare exp out || fail=1
< +compare out exp || fail=1
<  # expect empty stderr
< -compare /dev/null err || fail=1
< +compare err /dev/null || fail=1
<  
<  # Repeat, but with a newline at the end of "a".
<  echo >> a
<  
< -returns_ 1 diff $opt -U1 a b > out 2> err || fail=1
< +diff $opt -U1 a b > out 2> err
< +test $? = 1 || fail=1
<  
<  sed -n '/^@@/,$p' out > k && mv k out || fail=1
< -compare exp2 out || fail=1
< +compare out exp2 || fail=1
<  # expect empty stderr
< -compare /dev/null err || fail=1
< -
< -# Test for Bug#18402.
< -printf a > a
< -printf b > b
< -returns_ 1 diff -B a b > out 2>err || fail=1
< +compare err /dev/null || fail=1
<  
<  Exit $fail
< diff -pru diffutils-3.0/tests/stdin diffutils-3.0-patch/tests/stdin
< --- diffutils-3.0/tests/stdin	2020-03-01 22:03:00.552739000 -0800
< +++ diffutils-3.0-patch/tests/stdin	2020-03-01 14:52:55.609205000 -0800
< @@ -1,7 +1,8 @@
<  #!/bin/sh
<  # Ensure that "-" means "standard input".
<  
< -. "${srcdir=.}/init.sh"; path_prepend_ ../src
< +: ${srcdir=.}
< +. "$srcdir/init.sh"; path_prepend_ ../src
<  
<  fail=0
<  
< @@ -16,9 +17,9 @@ EOF
<  echo a > a
<  echo b > b
<  
< -returns_ 1 diff -u - b < a > out 2> err || fail=1
< +diff -u - b < a > out 2> err; test $? = 1 || fail=1
<  # Remove date and time.
<  sed -e 's/^\([-+*][-+*][-+*] [^	]*\)	.*/\1/' out > k; mv k out
< -compare exp out || fail=1
< +compare out exp || fail=1
9152,9163d335
<  Exit $fail
< Only in diffutils-3.0/tests: strcoll-0-names
< diff -pru diffutils-3.0/TODO diffutils-3.0-patch/TODO
< --- diffutils-3.0/TODO	2020-03-01 22:03:00.309713000 -0800
< +++ diffutils-3.0-patch/TODO	2020-03-01 14:56:44.985253000 -0800
< @@ -6,4 +6,4 @@ http://www.pkix.net/~chuck/sdiff2.diff
<  Propagate stderr from subprocess so that diff3 does
<  a better job of explaining _why_:
<    > $ diff3 /bin/sh /bin/false /bin/mv
< -  > diff3: subsidiary program 'diff' failed (exit status 2)
< +  > diff3: subsidiary program `diff' failed (exit status 2)
< Only in diffutils-3.0-patch: .x-sc_space_tab
